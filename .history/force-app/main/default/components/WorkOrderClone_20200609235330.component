<apex:component id="wrkOrdr" controller="WorkOrderControllerClone">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen.jquery.min.js" type="text/javascript"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.1.0/chosen.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    
    <style>
        .isa_error {
        color: #D8000C;
        background-color: #FFBABA;
        margin: 10px 0px;
        padding: 12px;
        }
        .dataTables_wrapper .dataTables_filter input { 
        height: 34px;
        border-radius: 5px;
        border: 1px solid rgb(169, 169, 169);
        padding: 10px;
        }
        .dataTables_length select{ 
        height: 34px;
        border-radius: 5px;
        border: 1px solid rgb(169, 169, 169); 
        }
        /* The Modal (background) */ 
        .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        padding-top: 60px;
        }
        
        /* Modal Content/Box */
        .modal-content {
        background-color: #fefefe;
        margin: 1% auto 15% auto; /* 5% from the top, 15% from the bottom and centered */
        border: 10px solid #888;
        }
        
        .tooltip {
        position: relative;
        /*display: inline-block;
        border-bottom: 1px dotted black;*/
        }
        
        .tooltip .tooltiptext {
        visibility: hidden;
        width: auto;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 45%;
        margin-left: -76px;
        opacity: 0;
        transition: opacity 1s;
        }
        
        .tooltip .tooltiptext::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #555 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
        }
        textarea {
        resize: none;
        }
        .popup{
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0,0,0,0.5);
        display: none;
        z-index: 999;
        }
        
        .popupText {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
        display: none;
        }
        
        .popup.active {
        background-color: rgba(0,0,0,0.5);
        display:block;
        }
        .popup img { 
        margin: 15% auto;
        }
        .textAreaPopup {
        margin: 0px 15.3281px 0px 0px;
        width: 42%;
        height: 54%;
        position: fixed;
        left: 30%;
        top: 22%;
        padding: 10px;
        border-radius: .25rem;
        }
    </style>
    
    <input type="hidden" id="caseHiddenId" />
    <input type="hidden" id="caseHiddenName" />
    <input type="hidden" id="caseHiddenTotalAmtDue" />
    <input type="hidden" id="caseHiddenType" />
    <input type="hidden" id="salestaxHidden" />
    
    <input type="hidden" id="salestaxOnPartHidden" />
    <input type="hidden" id="salestaxOnLaborHidden" />
    <input type="hidden" id="salestaxOnSSHidden" />
    <input type="hidden" id="salestaxOnMISCHidden" /> 
    <div style="position: fixed; top: 0; bottom: 0; left: 0; right: 0; z-index: 999999; background: #00000091; display: none;" id="jobTechlookupId">
    	<input type="hidden" id="divNumLkUp" value=""/>
    	<div style="background: #fff; position: absolute; width: 400px; height: 18%; padding: 1%; left: 36%; top: 28%; border-radius: .25em; border: 2px solid #000000ad;">
    		<a class="slds-button slds-button_icon" onclick="closeLookUp();" style="position: relative; left: 94%;">[X]</a>
    		<br/>
<!--     		<apex:inputField value="{!objJob.Technician__c}" styleClass="slds-input"  id="jobTechLookupIF" /> -->
    		<apex:selectList size="1" value="{!selectedTech}" id="jobTechLookupIF" style="height: 34px;" styleClass="slds-select">
                <apex:selectOptions value="{!techList}"/>
            </apex:selectList>
    		<br/> 
    		<br/> 
    		<a class="slds-button slds-button--brand" style="position: relative; left: 90%;" onclick="addTechToJob();">OK</a>
    	</div>
    </div>
    <script>
    	function closeLookUp() {
    		$("#jobTechlookupId").fadeOut();
    		$("#jobTechlookupId").fadeOut(); 
   			$("#divNumLkUp").val("");
   			//document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:jobTechLookupIF_lkid").value = '000000000000000';
   			document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:jobTechLookupIF").value = '0';
    	}
    	function addTechnician(divNum) { 
    		$("#divNumLkUp").val(divNum);
    		$("#jobTechlookupId").fadeIn();
    		var jid = $("#jbTechId"+divNum).val();
    		var jName = $("#techName"+divNum).html();
    		//document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:jobTechLookupIF_lkid").value = jid;
    		if(jid != '') {
    			document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:jobTechLookupIF").value = jid;
   			} else {
   				document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:jobTechLookupIF").value = '0';
   			}
    	}
    	
    	function addTechToJob() {
    		var divId = $("#divNumLkUp").val();
    		var techId = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:jobTechLookupIF").value;
    		if(techId != '0') {
	    		BOATBUILDING.WorkOrderControllerClone.getUserInfo(techId, function(result, event) {
	    			
	    			var objUser = result;
	    			console.log(objUser);
	    			$("#jbTechId"+divId).val(objUser.Id);
	    			$("#techName"+divId).html(objUser.Name);
	    			$("#jobTechlookupId").fadeOut(); 
	    			$("#divNumLkUp").val("");
	    			//document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:jobTechLookupIF_lkid").value = '000000000000000';
	    			document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:jobTechLookupIF").value = '0'; 
	    		});
    		}
    	}
    	
    </script>
    <div id="popupTextArea" class="popupText"> 
        <input type="hidden" value="" id="hiddenInpPopup"/> 
        <input type="hidden" value="" id="tyForCmnt"/> 
        <a style="position: fixed; left: 70.8%; top: 19%;" onclick="document.getElementById('popupTextArea').style.display='none';document.getElementById('taCommnt').value='';document.getElementById('addCmntBttn').style.display='block';">[X]</a>
        <textarea id="taCommnt" class="textAreaPopup"/>
        <a id="addCmntBttn" style="position: fixed; left: 65.4%; top: 77%;" class="slds-button slds-button--neutral slds-button--brand">Add Comment</a>
    </div>
    <div  class="popup">
        <apex:image id="WOtheImage2" value="{!$Resource.Process}" style="display:block;" width="40" height="40"/>    
    </div>
    <div id="workOrderListViewDiv"> 
        <div class="slds-grid slds-wrap slds-col--padded slds-m-top--medium slds-align--absolute-center">
            <div class="slds-col slds-size--1-of-1">
                <a id="createWrkOrdrOnLstDiv" style="margin-left: 45%;" class="slds-button slds-button--brand">Create Work Order</a>
            </div>
        </div>
        <div class="slds-grid slds-wrap slds-col--padded slds-m-top--medium slds-align--absolute-center">
            <div class="slds-col slds-size--1-of-1">
                <span id="tableSpan">
                </span>
            </div>
        </div> 
        
        <!-- -- for Payment Add--- -->       
        <div id="id03" class="modal" >
            <div class="modal-content animate" style="height: 90%; width: 80%;overflow: auto;">
                <div class="slds-grid slds-wrap slds-col--padded slds-m-top--medium slds-align--absolute-center">
                    <div class="slds-col slds-size--1-of-1">
                        <a id="createPaymentBtnWO" style="margin-left: 45%;" class="slds-button slds-button--brand">Create Payment</a>
                    </div>
                </div>
                
                <a style="position: absolute;left: 86.8%;" id="closeSignWO"><i class="fa fa-times fa-lg __web-inspector-hide-shortcut__" aria-hidden="true"></i></a>
                <section style="padding: 2%;">
                    <div class="slds-col slds-size--1-of-1">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Total Amount Due</label>
                                    <div class="slds-form-element__control">
                                        <input type="text" class="slds-input" id="TotalAmountDue" disabled="disabled"/>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Balance</label>
                                    <div class="slds-form-element__control">
                                        <input type="text" class="slds-input" id="paymentBalance" disabled="disabled"/>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Related Work Order</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!objPayment.Work_Warranty_Order__c}" styleClass="slds-input" id="RelatedworkOrder" />
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Amount</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!objPayment.Amount__c}" styleClass="slds-input" id="PaymentAmount" />
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Payment Type</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!objPayment.Payment_Type__c}" styleClass="slds-select" id="PaymentType"/>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Check Number</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!objPayment.Check_Number__c}" styleClass="slds-input" id="CheckNumber" />
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Credit Card Type</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!objPayment.Credit_Card_Type__c}" styleClass="slds-select" id="CreditCardType" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <script>
        function getWOWholeListTable() {
            BOATBUILDING.WorkOrderControllerClone.getWOWholeList(function(result, event) {
                //console.log(result); 
                if(result != null && result.length > 0) {
                    var htmlTable = '<table id="wolstId" class="show slds-table slds-table--bordered slds-no-row-hover slds-table--cell-buffer slds-m-top--x-large Table1 slds-card"> <thead> <tr> <th>Work Order Number</th> <th>Contact Name</th> <th>Boat Name</th> <th>Status</th> <th>Case Age</th> <th>Update Customer Flag</th> <th>Schedule</th> </tr> </thead> <tbody>';
                    for(var i = 0; i < result.length; i++) {
                        var woId = '', woName = '', woBalance = '0.00', woStatus = '', woContactName = '', woHinNum = '', woCaseAge = '', WOUpdtCustFlag = '';
                        woId = result[i].Id;
                        woName = result[i].Name;
                        if(result[i].BOATBUILDING__Balance__c != undefined) {
                            woBalance = result[i].BOATBUILDING__Balance__c;
                        }
                        
                        if(result[i].BOATBUILDING__Status__c != undefined) {
                            woStatus = result[i].BOATBUILDING__Status__c;
                        }
                        
                        if(result[i].BOATBUILDING__Contact__c != undefined) {
                            woContactName = result[i].BOATBUILDING__Contact__r.Name; 
                        }
                        
                        if(result[i].BOATBUILDING__Boat__c != undefined ) { //&& result[i].BOATBUILDING__Boat__r.BOATBUILDING__Boat_HIN_No__c != undefined
                            woHinNum = result[i].BOATBUILDING__Boat__r.Name;
                        } 
                        
                        if(result[i].BOATBUILDING__Case_Age__c != undefined) {
                            woCaseAge = result[i].BOATBUILDING__Case_Age__c;
                        }
                        
                        if(woStatus == 'Closed' || woStatus == 'closed' || woStatus == 'Closed Internal') {
                            WOUpdtCustFlag = '/resource/BOATBUILDING__flag_blue';
                        } else {
                            if(result[i].BOATBUILDING__Backend_Customer_Flag_Count__c != undefined) {
                                if(parseInt(result[i].BOATBUILDING__Backend_Customer_Flag_Count__c) < parseInt('{!countCF}')) {
                                    WOUpdtCustFlag = '/resource/BOATBUILDING__flag_green';
                                } else {
                                    WOUpdtCustFlag = '/resource/BOATBUILDING__flag_red';
                                }
                            }
                        }
                        
                        if(woStatus != 'Closed') {
                            htmlTable += '<tr> <td> <a href="javascript:void(0);" onclick="fetchWorkOrder(this,\''+woId+'\',\''+woName+'\',\''+woBalance+'\',\''+woStatus+'\');" > ' + woName + ' </a> &nbsp; <a href="/apex/BOATBUILDING__ServicePage?type=WO&WOId='+woName+'" target="blank"><img src="https://image.flaticon.com/icons/png/512/376/376007.png" style="height: 10px; width: 10px;"/></a> </td> <td> ' + woContactName + ' </td> <td> ' + woHinNum + ' </td> <td> ' + woStatus + ' </td> <td> ' + woCaseAge + ' </td> <td> <img style="max-width: 10%;" src="' + WOUpdtCustFlag + '"/> </td> <td> <a onclick="redirectToScedule(\''+woId+'\', \''+woName+'\');">Schedule</a> </td> </tr>';
                        } else {
                            htmlTable += '<tr> <td> <a href="javascript:void(0);" onclick="fetchWorkOrder(this,\''+woId+'\',\''+woName+'\',\''+woBalance+'\',\''+woStatus+'\');" > ' + woName + ' </a> &nbsp; <a href="/apex/BOATBUILDING__ServicePage?type=WO&WOId='+woName+'" target="blank"><img src="https://image.flaticon.com/icons/png/512/376/376007.png" style="height: 10px; width: 10px;"/></a> </td> <td> ' + woContactName + ' </td> <td> ' + woHinNum + ' </td> <td> ' + woStatus + ' </td> <td> ' + woCaseAge + ' </td> <td> <img style="max-width: 10%;" src="' + WOUpdtCustFlag + '"/>  </td> <td> &nbsp; </td> </tr>';
                        } 
                    }
                    htmlTable += '</tbody> </table>';
                    //console.log(htmlTable);
                    $("#tableSpan").html(htmlTable); 
                    $("#wolstId").delay(1000).DataTable( {
                        "pageLength": 25, 
                        "lengthMenu": [[25, 50, -1], [25, 50, "All"]],
                        "order": [[ 0, "desc" ]]
                    } );    
                }
            });
        }
        $(document).ready(function() {
            getWOWholeListTable();
        });
        
        var woId;
        function addPayment(obj, objWorkOrderId, objWorkOrderName, objWorkOrderTotalAmtDue){
            document.getElementById('id03').style.display="block";
            woId = objWorkOrderId;
            document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:RelatedworkOrder").value = objWorkOrderName;
            document.getElementById("TotalAmountDue").value = objWorkOrderTotalAmtDue;
        }
        
        var objPaymentData = new Object();
        $("#createPaymentBtnWO").click(function() {
            objPaymentData["PaymentType"] = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentType").value;
            objPaymentData["Amount"] = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentAmount").value;
            objPaymentData["CheckNumber"] = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:CheckNumber").value;
            objPaymentData["CreditCardType"] = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:CreditCardType").value;
            
            BOATBUILDING.WorkOrderControllerClone.addPayment(objPaymentData, woId, function(result, event) {
                if(event.status) {
                    if(result != ''){
                        //alert('insidepayemtvivek');
                        //window.open("https://www.w3schools.com");
                        $('#id03').fadeOut();
                        
                    } 
                }
            });
        });
        
        var modal = document.getElementById('id03');
        window.onclick = function(event) {
            if (event.target == modal) {
                $('#id03').fadeOut();
            }
        }
        $("#closeSignWO").click(function() {
            $('#id03').fadeOut();
        });
        
        $(document).ready(function() {
            
        });
        
        </script>
        <!-- ---Script for Payment Add-- -->
    </div> 
    
    <div id="workOrderFormDiv" style="display: none;">
        <div class="isa_error" id="woerrorDiv" style="display: none;">
            <i class="fa fa-times-circle"></i>
            <span id="woerrSnap"></span> 
        </div>
        <div class="slds-grid slds-wrap slds-col--padded">
            <!-- work order section user details -->
            <div class="slds-col slds-size--1-of-1">
                <div class="slds-grid slds-wrap" id="TestToHide">
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Customer Name<span style="color: red;">*</span></label>
                            <div class="slds-form-element__control">
                                <apex:inputField value="{!objCase.Contact__c}" styleClass="slds-input" OnChange="fetchRelatedContactWo(this)" id="conWrkId2" />
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Address</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoAddressId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">City</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoCityId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Zip</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoZipId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Phone Number</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoPhoneId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Email</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoEmailId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Boat<span style="color: red;">*</span></label>
                            <div class="slds-form-element__control">
                                <apex:inputField value="{!objCase.Boat__c}" styleClass="slds-input" id="boatLookId" onchange="fetchBoatFromItemWo(this);"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Created Date</label>
                            <div class="slds-form-element__control">
                                <!--<apex:inputField value="{!objCase.CreatedDate__c}" styleClass="slds-input" id="CreatedDateId" />-->
                                <input type="date" class="slds-input" id="CreatedDateId"/>
                            </div>
                        </div>
                    </div>
                    
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Boat Hin</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoHinId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Engine SN</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoEngSnId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Engine 1 Serial Number</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoEngSnId1" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Engine 2 Serial Number</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoEngSnId2" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Engine 3 Serial Number</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoEngSnId3" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Engine 4 Serial Number</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoEngSnId4" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Trailer Vin</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoTvinId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Drive#</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="wODriveId"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Hrs</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="wOHoursId"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Work Order Number</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" value="Will show in classic" id="WONameEdit" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <!--<div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
<div class="slds-form-element">
<label class="slds-form-element__label">Date Created</label>
<div class="slds-form-element__control">
<input class="slds-input" type="text" id="WoDateCrtedId" disabled="disabled"/>
</div>
</div>
</div>-->
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Boat Make</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoMakeId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Boat Model</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoModelId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Boat Year</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoYearId" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Boat Registration Number</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoBRN" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Status<span style="color: red;">*</span></label>
                            <div class="slds-form-element__control">
                                <apex:inputField value="{!objCase.Status__c}" styleClass="slds-input" id="WoStatus" />
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Sales Tax</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="WoSalesTax" disabled="disabled"/>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Customer Type</label>
                            <div class="slds-form-element__control">
                                <input class="slds-input" type="text" id="custType" disabled="disabled"/>
                                
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Store Location<span style="color: red;">*</span></label>
                            <div class="slds-form-element__control">
                                <apex:inputField value="{!objCase.Store_Location__c}" onchange="sLocationST(this.value);"  styleClass="slds-select" id="WostoreLocation" />
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Customer Boat Status</label>
                            <div class="slds-form-element__control">
                                <apex:inputField value="{!objCase.Customer_Boat_Status__c}"  styleClass="slds-select" id="WoCBS" />
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-small-size--1-of-2 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Available Promocode</label>
                            <div class="slds-form-element__control">
                                <select class="slds-select" id="woPromocode" onchange="promoChange();">
                                    <option value="0">--None--</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <!--                 <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded"> -->
                    <!--                     <div class="slds-form-element"> -->
                    <!--                         <label class="slds-form-element__label">&nbsp;</label> -->
                    <!--                         <div class="slds-form-element__control"> -->
                    <!--                             &nbsp; -->
                    <!--                         </div> -->
                    <!--                     </div> -->
                    <!--                 </div> -->
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--3-of-4 slds-col--padded">
                        
                    </div>        
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">&nbsp;</label>
                            <div class="slds-form-element__control">
                                <a id="frmBtn"  class="slds-button slds-button_icon" style="background-color: #29abe2; background-color: #29abe2; width: 100%;" title= "Inspection Form">
                                    <apex:image id="frmBtnIcn" value="{!URLFOR($Resource.Form)}"  width="20" height="20" />&nbsp;Inspection Form
                                </a>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="slds-grid slds-wrap slds-col--padded slds-m-top--medium">
            <div class="slds-col slds-size--1-of-1 slds-medium-size--3-of-4 slds-col--padded">
                <div class="slds-card">
                    <div class="slds-card__body" style="overflow: unset;">
                    	<div style="padding: 1%;">
                    		<a class="slds-button slds-button--brand" id="addCannedJobBtn">Add Canned Job</a>
                    		<a class="slds-button slds-button--brand" id="addNewJobBtn">Add new Job</a>
                    	</div>
                    	
                   		<a id="addpayment2" onclick="addPayment2(this,'{!objCase.Id}');" class="slds-button slds-button_icon" style="position: fixed; z-index: 99; left: 96%; top: 14%;background-color: #29abe2;" title= "Add Payment">
                           <apex:image id="addPaymentIcon" value="{!URLFOR($Resource.AddPayment)}" width="40" height="40" />
                       </a>
                       <a id="updatecusnotification" onclick="updatecusnotificationWOBtn(this,'{!objCase.Id}');" class="slds-button slds-button_icon" style="position: fixed; z-index: 99; left: 96%; top: 38%;background-color: #29abe2;" title= "Update Customer">
                           <apex:image id="updateCustomerIcon" value="{!URLFOR($Resource.UpdateCustomer)}" width="40" height="40" />
                       </a>
                       <a id="scheduleWOO" class="slds-button slds-button_icon" style="position: fixed; z-index: 99; left: 96%; top: 44%;background-color: #29abe2;" title= "Schedule WO">
                           <apex:image id="scheduleWOOIcon" value="{!URLFOR($Resource.ScheduleClock)}" width="40" height="40" />
                       </a>
                       <a id="prntWO" onclick="printWO(this);" class="slds-button slds-button_icon" style="position: fixed; z-index: 99; left: 96%; top: 20%;background-color: #29abe2;" title= "Print">
                           <apex:image id="printIcon" value="{!URLFOR($Resource.Print)}" width="40" height="40" />
                       </a> 
                       <a id="sndWO" onclick="sndWO(this);" class="slds-button slds-button_icon" style="position: fixed; z-index: 99; left: 96%; top: 26%;background-color: #29abe2;" title= "Send">
                           <apex:image id="sendIcon" value="{!URLFOR($Resource.Send)}" width="40" height="40" />
                       </a>
                       <a id="backToList" onclick="backtolist();" class="slds-button slds-button_icon" style="position: fixed; z-index: 99; left: 96%; top: 32%;background-color: #29abe2;" title= "Back To List">
                           <apex:image id="BackToListIcon" value="{!URLFOR($Resource.BackToList)}" width="40" height="40" />
                       </a> 
                       <a id="refereshBtnWO" class="slds-button slds-button_icon" style="position: fixed; z-index: 99; left: 96%; top: 50%;background-color: #29abe2;" title= "Referesh">
                           <apex:image id="refereshBtnWOICN" value="{!URLFOR($Resource.RefreshIcon)}" width="40" height="40" />
                       </a>
                       <a id="WO_TWO" class="slds-button slds-button_icon" style="position: fixed; z-index: 99; left: 96%; top: 58%;background-color: #29abe2; " title= "Tech Work Order">
                           <img src="https://cdn.iconscout.com/icon/premium/png-256-thumb/technician-2-197670.png"/>
                       </a>
                    	
                        <div id="ExistingJobPanel" style="display: none;">
                            <div class="slds-grid slds-wrap">
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">Existing/Canned Jobs</label>
                                        <div class="slds-form-element__control">
                                            <apex:selectList size="1" value="{!selectedJob}" label="Existing Jobs: " id="sl1" styleClass="slds-select chosenWO" onchange="getJobParameters(this);">
                                                <apex:selectOptions value="{!lstJobs}" id="so1"/>
                                            </apex:selectList>  
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">Work Requested</label>
                                        <div class="slds-form-element__control">
                                            <input id="WoWrkRequested" class="slds-input" type="text" disabled="disabled"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">Work Type</label>
                                        <div class="slds-form-element__control">
                                            <input id="WoWrkType" class="slds-input" type="text" disabled="disabled"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">Type</label>
                                        <div class="slds-form-element__control">
                                            <input id="WoJobType" class="slds-input" type="text" disabled="disabled"/>
                                        </div>
                                    </div>
                                </div>
                            </div>  
                            <script>
                            function backtolist() {
                                //window.top.location = '/apex/ ?type=WO';
                                
                                
                                if( (typeof sforce != 'undefined') && sforce && (!!sforce.one) ) {
                                    // Salesforce app navigation
                                    sforce.one.navigateToURL('/apex/BOATBUILDING__ServicePage?type=WO'); 
                                }
                                else {
                                    // Set the window's URL using a Visualforce expression
                                    parent.window.location = '/apex/BOATBUILDING__ServicePage?type=WO'; 
                                }
                                
                            }
                            
                            
                            </script>                                                              
                            <div class="slds-grid slds-wrap" style="padding-bottom:10px;">
                                
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">&nbsp;</label>
                                        <div class="slds-form-element__control">
                                            <a class="slds-button slds-button--brand" id="Addjob">Add Canned Job</a>
<!--                                             <label id="orLb">OR</label>  -->
<!--                                             <a class="slds-button slds-button--brand" id="Addnewjob">Add New Job</a> -->
                                            
                                            
                                        </div>
                                    </div>
                                </div>
                                
                                <script>
                                $("#frmBtn").click(function() {
                                    var woId = $("#caseHiddenId").val();
                                    window.open('/apex/BOATBUILDING__ServiceInspectionForm?woId='+woId);
                                });
                                $("#refereshBtnWO").click(function() {
                                    $("#WoAddressId").val("");
                                    $("#WoCityId").val("");
                                    $("#WoZipId").val("");
                                    $("#WoPhoneId").val("");
                                    $("#WoEmailId").val("");
                                    $("#CreatedDateId").val("");
                                    $("#WoHinId").val("");
                                    $("#WoEngSnId").val("");
                                    document.getElementById("WoEngSnId1").value = "";
	                                document.getElementById("WoEngSnId2").value = "";
	                                document.getElementById("WoEngSnId3").value = "";
	                                document.getElementById("WoEngSnId4").value = "";
                                    $("#WoTvinId").val("");
                                    $("#wODriveId").val("");
                                    $("#wOHoursId").val("");
                                    $("#WoSalesTax").val("");
                                    $("#custType").val("");
                                    
                                    var woId = $("#caseHiddenId").val();
                                    var woName = $("#WONameEdit").val();
                                    var woStatus = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WoStatus").value;
                                    var woBalance = document.getElementById("grandtotal_balance").value;
                                    console.log(woId);
                                    console.log(woName);
                                    console.log(woStatus);
                                    console.log(woBalance);
                                    $("#AddDivForJob").html("");
                                    lstjob = [];
                                    document.getElementById("DivValue").value = '0';
                                    fetchWorkOrder(this, woId, woName,  woBalance, woStatus);
                                });
                                $("#WO_TWO").click(function() {
                                    $('.popup').addClass('active');
                                    var woId = $("#caseHiddenId").val();
                                    var woName = $("#WONameEdit").val();
                                    //var woId = $("#hiddenId").val();
                                    //var woName = $("#hiddenName").val(); 
                                    //var woBal = $("#hiddenBal").val();
                                    openCity(event, 'workReq');
                                    document.getElementById("tab-default-10__item").click();
                                    document.getElementById("pge:frm:tchWrkOrderCompCall:tchWrkOrdr:existingWorkOrdersId_lkid").value = woId;    
                                    document.getElementById("pge:frm:tchWrkOrderCompCall:tchWrkOrdr:existingWorkOrdersId").value  = woName;
                                    fetchWorkOrderParameters(this);
                                });
                                </script>
                                
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="showaddjobPanel" style="display:none;"> 
                        &nbsp;&nbsp;&nbsp;&nbsp;<label class="slds-form-element__label">Add New Job</label>     
                            <div class="slds-grid slds-wrap">
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">Job Name</label>
                                        <div class="slds-form-element__control">
                                            <input class="slds-input" type="text" id="newjobNameId"/>
                                        </div>
                                    </div>    
                                </div>
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">Work Requested</label>
                                        <div class="slds-form-element__control">
                                            <input class="slds-input" type="text" id="newjobworequested"/>
                                        </div>
                                    </div>    
                                </div>
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">Work Type</label>
                                        <div class="slds-form-element__control">
                                            <!-- <apex:inputField value="{!objJob.Work_Type__c}" styleClass="slds-input" id="WorkTypeId" /> -->
                                            <select id="WorkTypeIdSelect" class="slds-select">
                                                <option value="">--None--</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label">Type</label>
                                        <div class="slds-form-element__control">
                                            <apex:inputField value="{!objJob.Type__c}" styleClass="slds-select" id="TypeWorkId" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-grid slds-wrap">
                                <div class="slds-col slds-size--1-of-1 slds-align--absolute-center Create_button slds-col--padded ">
                                    <div class="slds-form-element" style="position: relative; right: 47%;">
                                        <label class="slds-form-element__label">&nbsp;</label>
                                        <div class="slds-form-element__control" style="margin-bottom: 8px;">
                                            <a id="NewJobBtn" class="slds-button slds-button--neutral slds-button--brand inside_row_button" type="button">Add Job</a>
<!--                                             <a class="slds-button slds-button--neutral slds-button--brand inside_row_button " type="button" id="HideNewjobPanel">Cancel</a> -->
                                        </div>
                                    </div>
                                </div>
                            </div>  
                        </div>          
                    </div>
                </div>
            </div>
            
        </div>
        <!-- --Test- -->
        <div id="id02" class="modal" >
            
            <div class="modal-content animate" style="height: 90%; width: 80%;overflow: auto;">
                <div class="slds-grid slds-wrap slds-col--padded slds-m-top--medium slds-align--absolute-center">
                    <div class="slds-col slds-size--1-of-1">
                        <a id="createPaymentBtn1" style="margin-left: 45%;" class="slds-button slds-button--brand">Create Payment</a>
                    </div>
                </div>
                <a style="position: absolute;left: 86.8%;" id="closeSign1"><i class="fa fa-times fa-lg __web-inspector-hide-shortcut__" aria-hidden="true"></i></a>
                <!-- toggle -->
                <div class="slds-grid slds-wrap" id="custbalTgl">
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-small-size--1-of-2 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Add customer Balance</label>
                            <div class="slds-form-element__control">
                                <label class="slds-checkbox--toggle slds-grid slds-grid--vertical-align-center">
                                    <input name="checkbox" type="checkbox" id="checkCreateCustomBoat" />
                                    <span class="slds-checkbox--faux" data-check-on="Yes" data-check-off="No"></span>
                                </label>
                            </div>
                        </div> 
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-small-size--1-of-2 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label"></label>
                            <div class="slds-form-element__control">
                            </div>
                        </div> 
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-small-size--1-of-2 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label"></label>
                            <div class="slds-form-element__control">
                            </div>
                        </div> 
                    </div>
                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-small-size--1-of-2 slds-col--padded">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label"></label>
                            <div class="slds-form-element__control">
                            </div>
                        </div> 
                    </div>
                </div>
                <!-- toggle -->
                
                <div class="slds-col slds-size--1-of-1" style="display: none;" id="customeramountsec">
                    <div class="slds-grid slds-wrap">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-3 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Customer Balance</label>
                                    <div class="slds-form-element__control">
                                        <input type="text" class="slds-input" id="customerBal" disabled="true"/>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-3 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Amount</label>
                                    <div class="slds-form-element__control">
                                        <input type="decimal" class="slds-input" id="customerBalAmount" onkeyup="updateCB();"/>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-3 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label"></label>
                                    <div class="slds-form-element__control">
                                        <a class="slds-button slds-button--brand" style="margin-top: 12%;" onclick="addtoPaymentCB();">Add</a>
                                    </div>
                                </div>
                            </div>   
                        </div>   
                    </div>   
                </div>
                <script>
                function updateCB() {
                    var customerBalAmount = parseFloat($("#customerBalAmount").val());
                    var customerBal = parseFloat($("#customerBal").val());
                    console.log('customerBalAmount: '+customerBalAmount);
                    console.log('customerBal: '+customerBal);
                    if(customerBal < customerBalAmount) {
                        $("#customerBalAmount").val('0.00');
                        alert("Amount can't exceed the balance.");
                    }
                }
                function addtoPaymentCB() {
                    var objPaymentDataDetail = new Object();
                    var patmentMethod = $("#customerBalAmount").val();
                    objPaymentDataDetail["PaymentType"] = 'Credit Note';
                    
                    objPaymentDataDetail["Amount"] = document.getElementById("customerBalAmount").value;
                    
                    if(document.getElementById("customerBalAmount").value != null && document.getElementById("customerBalAmount").value != "") {
                        BOATBUILDING.WorkOrderControllerClone.addPaymentCN(objPaymentDataDetail, woId1, function(result, event) {
                            if(event.status) {
                                if(result != null) {
                                    document.getElementById("grandtotal_payment").value = result;
                                    calculate_totalofallJobDiv();
                                    document.getElementById("TotalAmountDue1").value = document.getElementById("grandtotal_balance").value; 
                                    fetchRelatedContactWo();
                                    //$('#id02').fadeOut();
                                } else {
                                    //$('#id02').fadeOut();
                                    
                                }
                            } 
                        });
                    } else {
                        alert("Please enter amount");
                    } 
                }
                </script>
                <section style="padding: 2%;">
                    <div class="slds-col slds-size--1-of-1">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Related Work Order</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!objPayment.Work_Warranty_Order__c}" styleClass="slds-input" id="RelatedworkOrder1" />
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Total Amount Due</label>
                                    <div class="slds-form-element__control">
                                        <input type="text" class="slds-input" id="TotalAmountDue1" disabled="disabled"/>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Payment Type</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!objPayment.Payment_Type__c}" styleClass="slds-select" id="PaymentType1" onchange="onChangePayment(this.value);"/>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded" id="patmntMethodSelect" style="display: none;">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Payment Method</label>
                                    <div class="slds-form-element__control">
                                        <select id="pms" class="slds-select">
                                            <option value="PaymentGateway">Payment Gateway</option>
                                            <option value="PaymentTerminal">Payment Terminal</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Amount</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!objPayment.Amount__c}" styleClass="slds-input" id="PaymentAmount1" onkeypress="UpdateBalance(this.value);" onkeyup="UpdateBalance(this.value);" />
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Check Number</label>
                                    <div class="slds-form-element__control">
                                        <apex:inputField value="{!objPayment.Check_Number__c}" styleClass="slds-input" id="CheckNumber1" />
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Balance</label>
                                    <div class="slds-form-element__control">
                                        <input type="text" class="slds-input" id="paymentBalance1" disabled="disabled"/>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-col--padded">
                                <div class="slds-form-element">
                                    <label class="slds-form-element__label">Credit Card Type</label>
                                    <div class="slds-form-element__control">
                                        <select Class="slds-select" id="CreditCardType1" disabled="disabled">
                                            <option value="">None</option>
                                            <option value="American Express">American Express</option>
                                            <option value="Citibank">Citibank</option>
                                            <option value="MasterCard">MasterCard</option>
                                            <option value="USAA">USAA</option>
                                            <option value="Visa">Visa</option>
                                        </select> 
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <div id="idupdnotification" class="modal" >
            
            <div class="modal-content animate" style="height: 90%; width: 80%;overflow: auto;">
                <div class="slds-grid slds-wrap slds-col--padded slds-m-top--medium slds-align--absolute-center">
                    <div class="slds-col slds-size--1-of-1">
                        <a id="updatenotificationbtn" style="margin-left: 45%;" class="slds-button slds-button--brand">Update</a>
                        
                    </div>
                    
                </div>
                
                <a style="position: relative;left: 93.8%;" id="closeSign2"><i class="fa fa-times fa-lg __web-inspector-hide-shortcut__" aria-hidden="true"></i></a>
                <div class="slds-grid">
                    <div class="slds-col">
                        <section style="padding: 2%;">
                            <div class="slds-col slds-size--1-of-1">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-1 slds-col--padded">
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label">Activity Type</label>
                                            <div class="slds-form-element__control">
                                                <apex:selectList style="width: 80%;" size="1" styleClass="slds-input-select" id="activityType">
                                                    <apex:selectOption itemLabel="Log a Call" itemValue="Log a Call" />
                                                    <apex:selectOption itemLabel="Email" itemValue="Email" />
                                                </apex:selectList>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-1 slds-col--padded">
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label">Customer Last Updated</label>
                                            <div class="slds-form-element__control">
                                                <!--<apex:inputField value="{!objCase.Customer_Last_updated__c}" styleClass="slds-input" id="LastupdateDate" />-->
                                                <input type="datetime-local" style="width: 80%;" class="slds-input" id="LastupdateDate" disabled="disabled"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-1 slds-col--padded">
                                        <div class="slds-form-element">
                                            <label class="slds-form-element__label">Customer Notes</label>
                                            <div class="slds-form-element__control">
                                                <apex:inputField value="{!objCase.Customer_Notes__c}" styleClass="slds-input" id="CustomerNotes" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <!--Updates for Akshay-->
                    <div class="slds-col">
                        <div style="position: relative;padding: 15px; font-size: 20px;">
                            Recent Comments
                        </div>
                        <!--<apex:repeat value="{!mapTimeToCustomerNotes}" var="item">-->
                        <span id="rcntCmnt">
                            
                        </span>
                        
                        <div style="position: relative;padding: 15px; font-size: 20px;">
                            Customer Comments
                        </div>
                        <span id="customerComment">
                            
                        </span>
                        
                        <div style="position: relative;padding: 15px; font-size: 20px;">
                            Service Writer Comments
                        </div>
                        
                        <span id="swComment">
                            
                        </span>
                        
                        <div style="position: relative;padding: 15px; font-size: 20px;">
                            Technician Comments
                        </div>
                        <span id="technicianComment">
                            
                        </span>
                        <!--</apex:repeat>-->
                    </div>
                </div>
            </div>
        </div> 
        
        <script>
        $("#checkCreateCustomBoat").change(function() {
            if(this.checked == true) {
                $("#customeramountsec").slideDown();
            }
            else {
                $("#customeramountsec").slideUp();
            }
        });
        /*   function addbaln(){
    var amount = document.getElementById("customerBal").value;
        if(amount == null && amount == ""){
            document.getElementById("customerBal").style.display = "none";
        
        }
    
    } */
    
    $("#scheduleWOO").click(function() {
        var WoIdd = $("#caseHiddenId").val();
        var woNamee = $("#WONameEdit").val();
        redirectToScedule(WoIdd, woNamee);
    });
    function printWO(obj) {
        if($("#caseHiddenId").val() != null && $("#caseHiddenId").val() != "") {
            if("{!PrintSkip}" == '0') {
                //window.top.location = '/apex/BOATBUILDING__CasePDFPageClone2?scontrolCaching=1&id='+$("#caseHiddenId").val()+'&btnStatus=Print&WOType=wo';
                
                window.open(
                    '/apex/BOATBUILDING__CasePDFPageClone2?scontrolCaching=1&id='+$("#caseHiddenId").val()+'&btnStatus=Print&WOType=wo',
                    '_blank' // <- This is what makes it open in a new window.
                );
                
            } else {
                
                window.open(
                    '/apex/BOATBUILDING__CasePDFPageClone2skp?scontrolCaching=1&id='+$("#caseHiddenId").val()+'&btnStatus=Print&WOType=wo',
                    '_blank' // <- This is what makes it open in a new window.
                );
                
                //window.top.location = '/apex/BOATBUILDING__CasePDFPageClone2skp?scontrolCaching=1&id='+$("#caseHiddenId").val()+'&btnStatus=Print&WOType=wo';
            } 
        }
    }
    
    function sndWO(obj) {
        if($("#caseHiddenId").val() != null && $("#caseHiddenId").val() != "") {
            window.top.location = '/apex/BOATBUILDING__SendWODetailPage?id='+$("#caseHiddenId").val(); 
        }
    }
    
    function UpdateBalance(amount){
        document.getElementById('paymentBalance1').value = parseFloat(document.getElementById('TotalAmountDue1').value - amount).toFixed(2);
    }
    
    function onChangePayment(strPaymentType) {
        $("#patmntMethodSelect").hide();
        if(strPaymentType == "Credit Card") {
            document.getElementById('CreditCardType1').disabled = false; 
        }                    
        
        if(strPaymentType == "Credit Card" && '{!baseUrl}' != ""){
            document.getElementById('CreditCardType1').disabled = false;
            //document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentAmount1').disabled = true;
            $("#createPaymentBtn1").html("Proceed to Gateway");
            $("#patmntMethodSelect").show();
            if($("#pms").val() != "PaymentGateway") {
                $("#createPaymentBtn1").html("Proceed with Terminal");
            }
            
        } else {
            if(strPaymentType != "Credit Card" ) {
                document.getElementById('CreditCardType1').disabled = true;
            }
            //document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentAmount1').disabled = false;
            $("#createPaymentBtn1").html("Create Payment");
            
        }
    }
    
    $("#pms").change(function(){
        if($("#pms").val() == "PaymentGateway") {
            $("#createPaymentBtn1").html("Proceed to Gateway");
        } else {
            $("#createPaymentBtn1").html("Proceed with Terminal");
        }
    });
    
    var woId1 = $("#caseHiddenId").val();
    //var baseUrl = '{!baseUrl}';
    
    function addPayment2(obj, objWorkOrderId){
        document.getElementById('id02').style.display='block';
        woId1 = $("#caseHiddenId").val();
        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:RelatedworkOrder1").value = $("#caseHiddenName").val();
        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentAmount1").value = "";
        document.getElementById("TotalAmountDue1").value = $("#grandtotal_balance").val();
        if(document.getElementById("custbalTgl").style.display == "block") {
            if(parseFloat($("#grandtotal_balance").val()) >= parseFloat($("#customerBal").val())) {
                $("#customerBalAmount").val(parseFloat($("#customerBal").val()));
            } else {
                $("#customerBalAmount").val(parseFloat($("#grandtotal_balance").val()));
            }
        }
    }
    
    var objPaymentDataDetail = new Object();
    
    $("#createPaymentBtn1").click(function() {
        var patmentMethod = $("#pms").val();
        objPaymentDataDetail["PaymentType"] = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentType1").value;
        if(objPaymentDataDetail["PaymentType"] == 'Credit Card' && '{!baseUrl}' != "" && patmentMethod == "PaymentGateway") {
            var woId2 = $("#caseHiddenId").val(); 
            if(document.getElementById("CreditCardType1").value != null && document.getElementById("CreditCardType1").value != "" && document.getElementById("CreditCardType1").value != "None") {
                window.top.location = '{!baseUrl}'+'?woId1='+woId2+'&CardType='+document.getElementById("CreditCardType1").value+'&amount='+document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentAmount1").value;
                return;  
            } else {
                alert("Please select card type");  
                return; 
            }   
        }
        objPaymentDataDetail["Amount"] = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentAmount1").value;
        objPaymentDataDetail["CheckNumber"] = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:CheckNumber1").value;
        objPaymentDataDetail["CreditCardType"] = document.getElementById("CreditCardType1").value;
        if(document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentType1").value != null && document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentType1").value != "") {
            if(document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentAmount1").value != null && document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentAmount1").value != "") {
                BOATBUILDING.WorkOrderControllerClone.addPayment(objPaymentDataDetail, woId1, function(result, event) {
                    if(event.status) {
                        if(result == '') {
                            //alert('insidepayemtvivek');
                            // window.open(baseUrl+"?woId1="+woId1);
                            $('#id02').fadeOut();
                        } else {
                            //alert('insidepayemtvivek');
                            // window.open(baseUrl+"?woId1="+woId1); 
                            document.getElementById("grandtotal_payment").value = result;
                            calculate_totalofallJobDiv();
                            $('#id02').fadeOut();
                        }
                    } 
                }); 
            } else {
                alert("Please enter amount");
            }
        } else {
            alert("Please select payment type");
        } 
    });
    
    function padd(str) {
        var strr = String(str);
        if(strr.length < 2) {
            return '0'+strr; 
        } else {
            return strr;
        }
    }
    
    //--Updates for Akshay Start
    function updatecusnotificationWOBtn(obj, objWorkOrderId){
        
        var currentdate = new Date(); 
        var dateTime = currentdate.getFullYear()+'-'+padd(String(currentdate.getMonth()+1))+'-'+padd(String(currentdate.getDate()))+'T'+padd(String(currentdate.getHours()))+":"+padd(String(currentdate.getMinutes()))+":"+padd(String(currentdate.getSeconds()))+'.000';
        //$("").val(dateTime); 
        console.log(dateTime);
        document.getElementById("LastupdateDate").value = dateTime;
        console.log('false');
        updateCusNotificationCont('1');
        
        woId1 = $("#caseHiddenId").val();
        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:RelatedworkOrder1").value = $("#caseHiddenName").val();
        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:PaymentAmount1").value = "";
        document.getElementById("TotalAmountDue1").value = $("#grandtotal_balance").val();
    }
    
    $("#updatenotificationbtn").click(function() {
        updateCusNotificationCont('2');
    });
    
    function updateCusNotificationCont(isCreate){
        //var lastUpdateDate = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:LastupdateDate").value;
        var lastUpdateDate = document.getElementById("LastupdateDate").value;
        var customerNotes = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:CustomerNotes").value;
        var activityType = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:activityType").value;
        if(lastUpdateDate == null){
            lastUpdateDate = '';
        }
        if(customerNotes == null){
            customerNotes = '';
        }
        woId1 = $("#caseHiddenId").val();
        console.log('lastUpdateDate--'+lastUpdateDate);
        debugger;
        console.log('customerNotes--'+customerNotes);
        console.log('isCreate--'+isCreate);
        console.log('woId1--'+woId1);
        BOATBUILDING.WorkOrderControllerClone.updatecusnotification(woId1,activityType,lastUpdateDate,customerNotes,isCreate,function(result, event) {
            if(event.status) {
                console.log(result);
                if(isCreate == '2'){
                    $('#idupdnotification').fadeOut();
                    window.top.location = "/apex/BOATBUILDING__ServicePage?type=WO&WOId="+$("#WONameEdit").val();
                } else if(isCreate == '1'){
                    console.log('In Fetched');      
                    document.getElementById('idupdnotification').style.display='block';
                    var htmlDiv = '';
                    console.log('result-updatecusnotification---'+result);
                    // Customer updates comments.
                    if(result.length > 0) {
                        if(result[0].length > 0){
                            var custUpdate = result[0];
                            console.log('custUpdate---'+custUpdate);
                            for(var i = 0; i < custUpdate.length; i++) {
                                if(custUpdate[i].includes('@-@')) {
                                    var lst = custUpdate[i].split('@-@');
                                    console.log(lst);
                                    var dateTimeVar = lst[0];
                                    var comment = '';
									if( lst[1].trim() != '' && lst[1].trim() != 'null')
                                  		comment = lst[1];
                                   	var sub = lst[2]; 
                                    htmlDiv += '<div class="slds-timeline__item"> <span class="slds-assistive-text">Call</span> <div class="slds-media"> <div class="slds-media__body"> <div class="slds-media slds-timeline__media slds-timeline__media_call"> <div class="slds-media__figure slds-timeline__icon"> <div class="slds-icon_container slds-icon-standard-log-a-call" title="call"> <img src="/resource/BOATBUILDING__UpdateCustomer" height="30" width="30"> </div> </div> <div class="slds-media__body"> <h3 class="slds-truncate" title="Date: ">'+dateTimeVar+' ('+sub+')</h3> <p class="slds-truncate" title="Customer Notes">'+comment+'</p> </div> </div> </div> </div> </div>';
                                }
                            }
                        }
                    }
                    
                    // Customer Job comments.
                    var customerCommentsHTML = '';
                    if(result.length > 1) {
                        if(result[1].length > 0){
                            var custComments = result[1];
                            for(var i = 0; i < custComments.length; i++) {
                                var comment = custComments[i]; 
                                customerCommentsHTML += '<div class="slds-timeline__item"> <span class="slds-assistive-text">Call</span> <div class="slds-media"> <div class="slds-media__body"> <div class="slds-media slds-timeline__media slds-timeline__media_call"> <div class="slds-media__figure slds-timeline__icon"> <div class="slds-icon_container slds-icon-standard-log-a-call" title="call"> <img src="/resource/BOATBUILDING__UpdateCustomer" height="30" width="30"> </div> </div> <div class="slds-media__body"> <p class="slds-truncate" title="Customer Notes">'+comment+'</p> </div> </div> </div> </div> </div>';
                            }
                        } else {
                            customerCommentsHTML += 'No Comments.';
                        }
                    }
                    
                    // Service Writer comments.
                    var swCommentsHTML = '';
                    if(result.length > 2) {
                        if(result[2].length > 0){
                            var swComments = result[2];
                            for(var i = 0; i < swComments.length; i++) {
                                var comment = swComments[i]; 
                                swCommentsHTML += '<div class="slds-timeline__item"> <span class="slds-assistive-text">Call</span> <div class="slds-media"> <div class="slds-media__body"> <div class="slds-media slds-timeline__media slds-timeline__media_call"> <div class="slds-media__figure slds-timeline__icon"> <div class="slds-icon_container slds-icon-standard-log-a-call" title="call"> <img src="/resource/BOATBUILDING__UpdateCustomer" height="30" width="30"> </div> </div> <div class="slds-media__body"> <p class="slds-truncate" title="Customer Notes">'+comment+'</p> </div> </div> </div> </div> </div>';
                            }
                        } else {
                            swCommentsHTML += 'No Comments.';
                        }
                    }
                    
                    // Technician comments.
                    var techCommentHTML = '';
                    if(result.length > 3) {
                        if(result[3].length > 0){
                            var techComments = result[3];
                            for(var i = 0; i < techComments.length; i++) {
                                var comment = techComments[i]; 
                                techCommentHTML += '<div class="slds-timeline__item"> <div class="slds-media"> <div class="slds-media__body"> <div class="slds-media slds-timeline__media slds-timeline__media_call"> <div class="slds-media__figure slds-timeline__icon"> <div class="slds-icon_container slds-icon-standard-log-a-call" title="call"> <img src="/resource/BOATBUILDING__UpdateCustomer" height="30" width="30"> </div> </div> <div class="slds-media__body"> <p class="slds-truncate" title="Customer Notes">'+comment+'</p> </div> </div> </div> </div> </div>';
                            }
                        } else {
                            techCommentHTML += 'No Comments.';
                        }
                    }
                    
                    $("#rcntCmnt").html(htmlDiv);
                    $("#customerComment").html(customerCommentsHTML);
                    $("#swComment").html(swCommentsHTML);
                    $("#technicianComment").html(techCommentHTML);
                }
            } 
        });
    }
    //--Updates for Akshay Akshay
    
    var modal = document.getElementById('id02');
    window.onclick = function(event) {
        if (event.target == modal) {
            $('#id02').fadeOut();
        }
    }
    $("#closeSign1").click(function() {
        $('#id02').fadeOut();
    });
    $("#closeSign2").click(function() {
        $('#idupdnotification').fadeOut();
    });
    
    
    </script> 
    <!----Test---->
    <div id="ShowjobList" style="display:none;">
        <div class="slds-grid slds-wrap slds-col--padded slds-m-top--medium" id="createjobpanel">
            <input type="hidden" name="DivValue" id="DivValue" value="0" />
            <input type="hidden" name="total_payment_id" id="total_payment_id" value="0" />
            <div class="slds-col slds-size--1-of-1 slds-medium-size--3-of-4 slds-col--padded" id="AddDivForJob">
                
            </div>
            
            <div class="slds-col slds-size--1-of-1 slds-medium-size--1-of-4 slds-col--padded">
                <div class="slds-card">
                    <div class="slds-card__body">
                        <table class="slds-table slds-table--bordered">
                            <tbody>
                                <tr>
                                    <th>Total Parts</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotal_parts" type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                                <tr>
                                    <th>Total Labor</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotal_labor" type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                                <tr>
                                    <th>Total Shop Supplies</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotal_supplies" type="text" disabled="disabled"/>
                                    </th>
                                </tr>  
                                <tr>
                                    <th>Total</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotal_total" type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                                <tr>
                                    <th>Discount On Job</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotalDiscount"  type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                                <tr>
                                    <th>Discount On WO</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="discountOnWO" type="text" onKeyPress="return isNumberKey(event);" onkeyup="calculateBalance();"/>
                                    </th>
                                </tr>
                                <tr>
                                    <th>Total Misc Charge</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotal_misc_charge" type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                                <tr>
                                    <th>Total Amount Due</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotal_amount_due" type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                                <tr>
                                    <th>Sales Tax</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotal_tax" type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                                <tr> 
                                    <th>Total Shipping Charge</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="shippingGrndTtl" type="text" disabled="disabled"/>
                                    </th>
                                </tr> 
                                <tr>
                                    <th>Total Payment</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotal_payment" type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                                
                                <tr>
                                    <th>Balance</th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandtotal_balance" type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>
                                        <div class="tooltip">Grand Total
                                            <span class="tooltiptext">Total Amount Due + Salestax + Shipping Charge</span>
                                        </div>
                                    </th>
                                    <th>
                                        <i class="fa fa-usd" style="position: absolute;margin-top: 7%;margin-left: 2.5%;" aria-hidden="true"></i>
                                        <input class="slds-input" id="grandTotalId" type="text" disabled="disabled"/>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <div  id="hiddenbtn" class="slds-grid slds-wrap slds-col--padded slds-m-top--medium slds-align--absolute-center" >
        <div class="slds-col slds-size--1-of-1" style="position: fixed; top: 92%; left: 44%; ">
            <a id="createwoorder"  class="slds-button slds-button--brand" style="margin-left: 35%; box-shadow: 0 10px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19) !important;">Create Work Order</a>
            <a id="cancelwoorder" onclick="window.top.location = '/apex/BOATBUILDING__ServicePage?type=WO';"  class="slds-button slds-button--brand" style="box-shadow: 0 10px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19) !important;">Back to List</a>
        </div>
    </div>
    </div>         
    
    <!-- For Adding Part -->
    <div id="PymntModl" class="modal" >
        <div class="modal-content animate" style="height: 90%; width: 80%;overflow: auto;">
            <a style="position: absolute;left: 86.8%;" id="closeSign33"><i class="fa fa-times fa-lg __web-inspector-hide-shortcut__" aria-hidden="true"></i></a>
            <section style="padding: 2%;">
                <b>Add Part</b><hr/>
                <label><b>Part Number/Part Name: </b></label>
                &nbsp;<input type="text" style="width: 20%;" id="prtDetailInput" class="slds-input"/>
                <button style="width: auto;" class="slds-button slds-button--neutral slds-button--brand inside_row_button " id="prtSrchBtn" type="button" >Search</button>
                <div class="spinnerClass" id="spinner" style="display: none;">
                    <i  class="fa fa-spinner fa-spin fa-3x fa-fw margin-bottom fa-5x" style="margin-left: 45%; margin-top: 23%;" aria-hidden="true"></i>
                </div>
                <div id="selectedPrntDiv" style="display: none;">
                    <hr/>
                    <label><b>Selected Parts: </b></label>
                    <div id="selectedPrtDiv">
                        
                    </div>
                    <div>
                        <a style="width: auto;position: relative;left: 91.5%;" class="slds-button slds-button--neutral slds-button--brand inside_row_button" id="addToCrt" type="button" >Add To Job</a>
                    </div>
                </div>
                <div id="partResultDiv" style="display: none;"> 
                    <hr/>
                    <div id="rsltLstDiv">
                        
                    </div>
                </div>
            </section>
        </div>
    </div>   
    
    <!-- For Adding New Part -->
    <div id="PymntModlnewjob" class="modal" >
        <div class="modal-content animate" style="height: 90%; width: 80%;overflow: auto;">
            <a style="position: absolute;left: 86.8%;" id="closeSign33newjob"><i class="fa fa-times fa-lg __web-inspector-hide-shortcut__" aria-hidden="true"></i></a>
            <section style="padding: 2%;">
                <b>Add Part</b><hr/>
                <label><b>Part Number/Part Name: </b></label>
                &nbsp;<input type="text" style="width: 20%;" id="prtDetailInputnewjob" class="slds-input"/>
                <button style="width: auto;" class="slds-button slds-button--neutral slds-button--brand inside_row_button " id="prtSrchBtnnewjob" type="button" >Search</button>
                <div class="spinnerClass" id="spinnernewjob" style="display: none;">
                    <i  class="fa fa-spinner fa-spin fa-3x fa-fw margin-bottom fa-5x" style="margin-left: 45%; margin-top: 23%;" aria-hidden="true"></i>
                </div>
                <div id="selectedPrntDivnewjob" style="display: none;">
                    <hr/>
                    <label><b>Selected Parts: </b></label>
                    <div id="selectedPrtDivnewjob">
                        
                    </div>
                    <div>
                        <a style="width: auto;position: relative;left: 91.5%;" class="slds-button slds-button--neutral slds-button--brand inside_row_button" id="addToCrtnewjob" type="button" >Add To Job</a>
                    </div>
                </div>
                <div id="partResultDivnewjob" style="display: none;"> 
                    <hr/>
                    <div id="rsltLstDivnewjob">
                        
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <script>
    var promo = '0';
    
    var addJobDiv = 0;
    var jobIdForCart = '';
    var jobIndex = '';
    window.onclick = function(event) {
        if (event.target == document.getElementById('PymntModl')) {
            //hideAll();
            $('#PymntModl').fadeOut();
            $("#selectedPrntDiv").hide();
            $("#partResultDiv").hide(); 
            document.getElementById("prtDetailInput").value = "";
            lstSelectedPartNumber = [];
            mapForQuantity = new Object();
        } 
    } 
    
    $("#closeSign33").click(function() {
        //hideAll();
        $('#PymntModl').fadeOut();
        $("#selectedPrntDiv").hide();
        $("#partResultDiv").hide(); 
        document.getElementById("prtDetailInput").value = "";
        lstSelectedPartNumber = [];
        mapForQuantity = new Object();
    });
    
    $("#closeSign33newjob").click(function() {
        //hideAll();
        $('#PymntModlnewjob').fadeOut();
        $("#selectedPrntDivnewjob").hide();
        $("#partResultDivnewjob").hide(); 
        document.getElementById("prtDetailInputnewjob").value = "";
        lstSelectedPartNumber = [];
        mapForQuantity = new Object();
    });
    
    function hideAll() {
        //console.log("hide"); 
        $('#PymntModl').fadeOut();
        $("#selectedPrntDiv").hide();
        $("#partResultDiv").hide(); 
        document.getElementById("prtDetailInput").value = "";
        lstSelectedPartNumber = [];
        mapForQuantity = new Object();
    }
    var existing = false;
    var lstjob = [];
    var selectedPartNumber1 = '';
    var existingCaseId = '';
    var lstjob = [];
    var alllstjob = []; 
    var lstContact = [];
    var lsttax = [] , lstss = [];
    var Percentage = '' , Cap_Amount_for_percent = '';
    
    function fetchWorkOrder(obj, objCaseId, objCaseName,objCaseAmtDue, objCaseStatus) {
        //console.log("aa"); 
        $('.popup').addClass('active');
        if(objCaseStatus == "Closed" || objCaseStatus == "closed") {
            $("#addpayment2").hide();
            $("#createwoorder").hide();
            $("#cancelwoorder").hide(); 
            $("#Addjob").hide();
            $("#Addnewjob").hide();
            $("#orLb").html("");
            $("#scheduleWOO").hide();
        }
        
        
        
        document.getElementById("caseHiddenId").value = objCaseId;
        document.getElementById("caseHiddenName").value = objCaseName;
        document.getElementById("caseHiddenTotalAmtDue").value = objCaseAmtDue;
        document.getElementById("caseHiddenType").value = objCaseStatus;
        $("#woSpinner").show();
        BOATBUILDING.WorkOrderControllerClone.fetchWorkOrder(objCaseId, function(result, event) {
            $('.popup').removeClass('active');
            if(event.status) {
                if(result != null) {
                    console.log(result);
                    $("#woSpinner").hide();
                    $("#workOrderListViewDiv").hide();
                    $("#workOrderFormDiv").show();
                    document.getElementById("createwoorder").innerHTML = "Update Work Order";
                    existing = true;
                    //alert(result[0].BOATBUILDING__Total_Payment_payment__c);
                    if(result[0].BOATBUILDING__Total_Payment_payment__c != undefined) {
                        document.getElementById("grandtotal_payment").value = result[0].BOATBUILDING__Total_Payment_payment__c;
                    } else {
                        document.getElementById("grandtotal_payment").value = (0.00).toFixed(2);
                    }
                    if(result[0].BOATBUILDING__Promo_Code__c != undefined) {
                        promo = result[0].BOATBUILDING__Promo_Code__c;
                    }
                    
                    
                    document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkid").value = result[0].BOATBUILDING__Contact__c;
                    existingCaseId = result[0].Id;
                    if(result[0].BOATBUILDING__Contact__r.FirstName != undefined) {
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkold").value = result[0].BOATBUILDING__Contact__r.FirstName +" "+ result[0].BOATBUILDING__Contact__r.LastName;
                    }else {
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkold").value = result[0].BOATBUILDING__Contact__r.LastName;
                    }
                    
                    if(result[0].BOATBUILDING__Contact__r.FirstName != undefined) {
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2").value = result[0].BOATBUILDING__Contact__r.FirstName +" "+ result[0].BOATBUILDING__Contact__r.LastName;
                    }else {
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2").value = result[0].BOATBUILDING__Contact__r.LastName;
                    }
                    
                    if(result[0].BOATBUILDING__Contact__r.MailingStreet != undefined) {
                        document.getElementById("WoAddressId").value = result[0].BOATBUILDING__Contact__r.MailingStreet;
                    }
                    
                    if(result[0].BOATBUILDING__Customer_Boat_Status__c != undefined) {
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WoCBS").value = result[0].BOATBUILDING__Customer_Boat_Status__c;
                    }
                    if(result[0].Name != undefined) {
                        document.getElementById("WONameEdit").value = result[0].Name;
                    }
                    
                    if(result[0].BOATBUILDING__Contact__r.MailingCity != undefined) {
                        document.getElementById("WoCityId").value = result[0].BOATBUILDING__Contact__r.MailingCity; 
                    }
                    
                    if(result[0].BOATBUILDING__Contact__r.MailingPostalCode != undefined) {
                        document.getElementById("WoZipId").value = result[0].BOATBUILDING__Contact__r.MailingPostalCode; 
                    } 
                    
                    if(result[0].BOATBUILDING__Contact__r.Phone != undefined) {
                        document.getElementById("WoPhoneId").value = result[0].BOATBUILDING__Contact__r.Phone; 
                    }
                    
                    if(result[0].BOATBUILDING__Contact__r.Email != undefined) {
                        document.getElementById("WoEmailId").value = result[0].BOATBUILDING__Contact__r.Email; 
                    }
                    if(result[0].BOATBUILDING__Discount__c != undefined) {
                        document.getElementById("discountOnWO").value = result[0].BOATBUILDING__Discount__c;
                    }
                    
                    if(result[0].BOATBUILDING__Status__c != undefined) {
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WoStatus").value = result[0].BOATBUILDING__Status__c;
                    }
                    
                    if(result[0].BOATBUILDING__Store_Location__c != undefined) { 
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation").value = result[0].BOATBUILDING__Store_Location__c;
                    }
                    
                    if(result[0].BOATBUILDING__CreatedDate__c != undefined) {  
                        //**** Remaining ****//
                        
                        var dt = new Date(result[0].BOATBUILDING__Created_Date_Formula__c); 
                        var dte = (dt.getMonth() + 1) + "/" + dt.getDate() + "/" + dt.getFullYear(); 
                        var dtField = document.getElementById("CreatedDateId");
                        dtField.setAttribute('type', 'text');
                        dtField.disabled = true;
                        dtField.value = dte; 
                    }
                    
                    if(result[0].BOATBUILDING__Boat__c != undefined) {
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkid").value = result[0].BOATBUILDING__Boat__c;
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkold").value = result[0].BOATBUILDING__Boat__r.Name;
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId").value = result[0].BOATBUILDING__Boat__r.Name;
                        if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Boat_HIN_No__c != undefined) {  
                            document.getElementById("WoHinId").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Boat_HIN_No__c; 
                        }
                        
                        if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_SN__c != undefined) {  
                            document.getElementById("WoEngSnId").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_SN__c; 
                        }
                        if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_1_Serial_Number__c != undefined) {
	                         document.getElementById("WoEngSnId1").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_1_Serial_Number__c;
	                     }
	                     if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_2_Serial_Number__c != undefined) { 
	                         document.getElementById("WoEngSnId2").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_2_Serial_Number__c;
	                     }
	                     if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_3_Serial_Number__c != undefined) {
	                         document.getElementById("WoEngSnId3").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_3_Serial_Number__c;
	                     }
	                     if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_4_Serial_Number__c != undefined) {
	                         document.getElementById("WoEngSnId4").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Engine_4_Serial_Number__c;
	                     } 
                        if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Boat_Registration_Number__c != undefined) {  
                            document.getElementById("WoBRN").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Boat_Registration_Number__c; 
                        }
                        
                        if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Trailer_VIN__c != undefined) {  
                            document.getElementById("WoTvinId").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Trailer_VIN__c; 
                        } 
                        
                        if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Boat_Manufacturer__c != undefined) {   
                            document.getElementById("WoMakeId").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Boat_Manufacturer__r.Name; 
                        }
                        
                        if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__Boat_Model__c != undefined) {  
                            document.getElementById("WoModelId").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__Boat_Model__c; 
                        } 
                        
                        if(result[0].BOATBUILDING__Boat__r.BOATBUILDING__M_Boat_Year__c != undefined) {  
                            document.getElementById("WoYearId").value = result[0].BOATBUILDING__Boat__r.BOATBUILDING__M_Boat_Year__c; 
                        } 
                    }
                    
                    if(result[0].BOATBUILDING__Drive__c != undefined) {
                        document.getElementById("wODriveId").value = result[0].BOATBUILDING__Drive__c; 
                    }
                    //if(result[0].BOATBUILDING__CreatedDate__c != undefined) {
                    // document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:CreatedDateId").value = result[0].BOATBUILDING__CreatedDate__c; 
                    //}
                    
                    if(result[0].BOATBUILDING__Hours__c != undefined) {
                        document.getElementById("wOHoursId").value = result[0].BOATBUILDING__Hours__c; 
                    }
                    
                    if(result[0].Status != undefined) { 
                        document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WoStatus").value = result[0].Status; 
                    }
                    
                    if(result[0].BOATBUILDING__Sales_Tax_Percent__c != undefined) {
                        document.getElementById("WoSalesTax").value = result[0].BOATBUILDING__Sales_Tax_Percent__c;  
                        document.getElementById("salestaxHidden").value = result[0].BOATBUILDING__Sales_Tax_Percent__c;
                        console.log('result[0].BOATBUILDING__Sales_Tax_Percent__c: '+result[0].BOATBUILDING__Sales_Tax_Percent__c);
                    }
                    fetchRelatedContactWo();
//                     $(".chosenWO").chosen({
// 			            no_results_text: "Oops, nothing found!" 
// 			        });
                    var lstResultJob = []; 
                    if(result[1] != undefined) {
                        lstResultJob = result[1];
                        if(lstResultJob.length > 0) {
                            for(var i = 0; i < lstResultJob.length; i++) {
                                
                                lstjob.push(lstResultJob[i]);
                                selectedPartNumber1 = lstResultJob[i].Id;
                                //document.getElementById("Addjob").click();
                                addJobFromEditable();
                                lstjob = [];
                            }
                        }
                    }
                } 
            }
        });
        
    }
    
    var workTypeList = [];
    $(document).ready(function() {
    	console.log('Test chosen');
    	/*$(".chosenWO").chosen({
            no_results_text: "Oops, nothing found!" 
        });*/
    	
        BOATBUILDING.WorkOrderControllerClone.fetchWorkTypePricingDetails(function(result, event) {
            if(event.status) {
                if(result != null) {
                    workTypeList = result;
                    if(workTypeList.length > 0) {
                        for(var i = 0; i < workTypeList.length; i++) {
                            if(workTypeList[i].BOATBUILDING__Active__c == true)
                                $("#WorkTypeIdSelect").append("<option value="+workTypeList[i].BOATBUILDING__Price__c+">"+workTypeList[i].Name+"</option>");
                        }
                    }
                }
            }
        });
    });
    $("#createWrkOrdrOnLstDiv").click(function() {
        $("#workOrderListViewDiv").hide();
        $("#workOrderFormDiv").show();
        var sl = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation').value;
        if(sl != null && sl != '' && sl != undefined) {
        	sLocationST(sl); 
        }
        /*$(".chosenWO").chosen({
            no_results_text: "Oops, nothing found!" 
        });*/
    });
    
    function getJobParameters(obj1) {
        existing = false;
        var jobID = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:sl1").value;
        if(jobID != null && jobID != "") {
            BOATBUILDING.WorkOrderControllerClone.getDetailsOfJob(jobID, function(result, event) {
                if(event.status) {
                    if(result != null) {
                        lstjob = result;
                        if(lstjob.length > 0) {
                            if(lstjob[0].BOATBUILDING__Work_Requested__c != null) {
                                document.getElementById("WoWrkRequested").value = lstjob[0].BOATBUILDING__Work_Requested__c;
                            }
                            if(lstjob[0].BOATBUILDING__Work_Type__c != null) {
                                document.getElementById("WoWrkType").value = lstjob[0].BOATBUILDING__Work_Type__c;
                            }
                            if(lstjob[0].BOATBUILDING__Type__c != null) {
                                document.getElementById("WoJobType").value = lstjob[0].BOATBUILDING__Type__c;
                            }
                        }
                        else {
                            document.getElementById("WoWrkRequested").value = "";
                            document.getElementById("WoWrkType").value = "";
                            document.getElementById("WoJobType").value = "";
                        }
                    }
                }
            });
        }
        else {
            document.getElementById("WoWrkRequested").value = "";
            document.getElementById("WoWrkType").value = "";
            document.getElementById("WoJobType").value = "";
        }
    }
    
    function promoChange() {
        var pc = $("#woPromocode").val();
        if(pc != '0') {
            $('.popup').addClass('active');
            BOATBUILDING.WorkOrderControllerClone.getPromocodeDetail(pc, function(result, event) {
                $('.popup').removeClass('active');
                if(result != null) { 
                    if(result.BOATBUILDING__Discount_In__c != undefined) {
                        if(result.BOATBUILDING__Discount_In__c == 'Amount') {
                            $("#discountOnWO").val(result.BOATBUILDING__Discount_Amount__c);
                            calculateBalance();
                        } else if(result.BOATBUILDING__Discount_In__c == 'Percentage' && result.BOATBUILDING__Discount_Percentage__c != undefined){
                            var totalDue = parseFloat($("#grandtotal_amount_due").val());
                            var per = parseFloat(result.BOATBUILDING__Discount_Percentage__c);
                            var dis = (totalDue * per)/100;
                            $("#discountOnWO").val(dis.toFixed(2));
                            calculateBalance();
                        }
                    } 
                }  
            }); 
        } else {
            $("#discountOnWO").val('0');
            calculateBalance();
        } 
    }
    
    function sLocationST(objval) {
        if(objval != null) {
            $('.popup').addClass('active');
            console.log('sLocationST');
            BOATBUILDING.WorkOrderControllerClone.getSalesTax(objval, function(result, event) {
                $('.popup').removeClass('active');
                if(result != null) { 
                    console.log(result);
                    document.getElementById("WoSalesTax").value = parseFloat(result.tax);
                    document.getElementById("salestaxHidden").value = parseFloat(result.tax);
                    
                    document.getElementById("salestaxOnPartHidden").value = result.STonParts;
                    document.getElementById("salestaxOnLaborHidden").value = result.STonLabor;
                    document.getElementById("salestaxOnSSHidden").value = result.STonSS;
                    document.getElementById("salestaxOnMISCHidden").value = result.STonMISC;
                    console.log('ALl Div');
                    
                }  
            }); 
        } else {
            document.getElementById("WoSalesTax").value = '0.00';
            document.getElementById("salestaxHidden").value = '0.00';
            document.getElementById("salestaxOnPartHidden").value = '0';
            document.getElementById("salestaxOnLaborHidden").value = '0';
            document.getElementById("salestaxOnSSHidden").value = '0'; 
            document.getElementById("salestaxOnMISCHidden").value = '0';
        }
    }
    
    function fetchRelatedContactWo() {
        var conWrkId = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkid").value;
        var conWrkName = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkold").value;
        if(conWrkName != null && conWrkName != "") {
            if(conWrkId != null && conWrkId != "" && conWrkId != "000000000000000") {
                var stLocation = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation').value;
                BOATBUILDING.WorkOrderControllerClone.getContact(conWrkId, stLocation, function(result, event) {
                    if(event.status) {
                        if(result != null) {
                            console.log('result');
                            console.log(result);
                            if(result[0] != undefined){
                                lstContact = result[0];
                                if(lstContact.length > 0) {
                                    if(lstContact[0].Phone != undefined) {
                                        document.getElementById("WoPhoneId").value = lstContact[0].Phone;
                                    }
                                    if(lstContact[0].MailingStreet != undefined) {
                                        document.getElementById("WoAddressId").value = lstContact[0].MailingStreet;
                                    }
                                    if(lstContact[0].MailingCity != undefined) {
                                        document.getElementById("WoCityId").value = lstContact[0].MailingCity;
                                    }
                                    if(lstContact[0].Email != undefined) {
                                        document.getElementById("WoEmailId").value = lstContact[0].Email;
                                    }
                                    if(lstContact[0].MailingPostalCode != undefined) {
                                        document.getElementById("WoZipId").value = lstContact[0].MailingPostalCode;
                                    }
                                    //BOATBUILDING__Account_Customer_Type__c
                                    if(lstContact[0].AccountId != undefined && lstContact[0].Account.BOATBUILDING__Account_Customer_Type__c != undefined) {
                                        document.getElementById("custType").value = lstContact[0].Account.BOATBUILDING__Account_Customer_Type__c;
                                    }
//                                     console.log(lstContact[0].Account.BOATBUILDING__Customer_Balance__c);  
                                    if(lstContact[0].AccountId != undefined && lstContact[0].Account.BOATBUILDING__Customer_Balance__c != undefined && lstContact[0].Account.BOATBUILDING__Customer_Balance__c > 0) {
//                                         console.log(lstContact[0].Account.BOATBUILDING__Customer_Balance__c);
                                        document.getElementById("custbalTgl").style.display = 'block';
                                        document.getElementById("customerBal").value = lstContact[0].Account.BOATBUILDING__Customer_Balance__c;
                                    } else {
                                        document.getElementById("custbalTgl").style.display = 'none';
                                        document.getElementById("customeramountsec").style.display = 'none';
                                        
                                        document.getElementById("customerBal").value = '0.00';
                                    }
                                }
                                else {
                                    document.getElementById("WoPhoneId").value = "";
                                    document.getElementById("WoAddressId").value = "";
                                    document.getElementById("WoCityId").value = "";
                                    document.getElementById("WoEmailId").value = "";
                                    document.getElementById("WoZipId").value = "";
                                    document.getElementById("custType").value = "";
                                }
                            }
                            if(result[1] != undefined){
                                lsttax = result[1];
                                console.log('lsttax');
                                console.log(lsttax);
                                document.getElementById("WoSalesTax").value = lsttax.tax;
                                document.getElementById("salestaxHidden").value = lsttax.tax;
                                
                                document.getElementById("salestaxOnPartHidden").value = lsttax.STonParts;
                                document.getElementById("salestaxOnLaborHidden").value = lsttax.STonLabor;
                                document.getElementById("salestaxOnSSHidden").value = lsttax.STonSS;
                                document.getElementById("salestaxOnMISCHidden").value = lsttax.STonMISC;
                                calculate_totalofallJobDiv();
                            }
                            
                            if(result[2] != undefined){
                                lstss = result[2];
                                if(lstss.length > 0) {
                                    
                                    if(lstss[0].BOATBUILDING__Percentage__c != undefined ) {
                                        Percentage = lstss[0].BOATBUILDING__Percentage__c;
                                    }
                                    if(lstss[0].BOATBUILDING__Cap_Amount_for_percent__c != undefined ) {
                                        Cap_Amount_for_percent = lstss[0].BOATBUILDING__Cap_Amount_for_percent__c;
                                    }
                                }
                            }
                        }
                    }
                });
                
                
                BOATBUILDING.WorkOrderControllerClone.getPromocodes(function(result, event) {
                    if(event.status) {
                        console.log(result);
                        if(result != null && result.length > 0) {
                            var promoHTML = '<option value="0">--None--</option>';
                            for(var i = 0; i < result.length; i++) {
                                if(result[i].BOATBUILDING__Discount_In__c == 'Amount') {
                                    promoHTML += '<option value="'+result[i].Id+'">' + result[i].BOATBUILDING__Promo_Code_Name__c + ' | $ ' +parseFloat(result[i].BOATBUILDING__Discount_Amount__c).toFixed(2)+ '</option>';
                                } else if(result[i].BOATBUILDING__Discount_In__c == 'Percentage') {
                                    promoHTML += '<option value="'+result[i].Id+'">' + result[i].BOATBUILDING__Promo_Code_Name__c + ' | ' +result[i].BOATBUILDING__Discount_Percentage__c+ '%</option>';
                                }
                            }
                            $("#woPromocode").html(promoHTML); 
                        } else {
                            $("#woPromocode").html('<option value="0">--None--</option>');
                        }
                        
                        console.log("promo check: "+promo);
                        
                        $("#woPromocode").val(promo)
                        //promoChange();
                    }
                });
                
            }
        }
        else {
            document.getElementById("WoPhoneId").value = "";
            document.getElementById("WoAddressId").value = "";
            document.getElementById("WoCityId").value = "";
            document.getElementById("WoEmailId").value = "";
            document.getElementById("WoZipId").value = "";
            document.getElementById("WoSalesTax").value = "";
        }
    }
    
    function fetchBoatFromItemWo(obj) {
        var itemId = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkid").value;
        var itemName = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkold").value;
        if(itemName != null && itemName != "") {
            if(itemId != null && itemId != "" && itemId != "000000000000000") {
                BOATBUILDING.WorkOrderControllerClone.fetchItemsWo(itemId, function(result, event) {
                    if(event.status) {
                        if(result != null) {
                            var lstCon1 = [];
                            lstCon1 = result;
                            if(lstCon1.length > 0) {
                                if(lstCon1[0].BOATBUILDING__Boat_HIN_No__c != undefined) {
                                    document.getElementById("WoHinId").value = lstCon1[0].BOATBUILDING__Boat_HIN_No__c;
                                }
                                if(lstCon1[0].BOATBUILDING__Engine_SN__c != undefined) {
                                    document.getElementById("WoEngSnId").value = lstCon1[0].BOATBUILDING__Engine_SN__c;
                                }
                                if(lstCon1[0].BOATBUILDING__Engine_1_Serial_Number__c != undefined) {
                                    document.getElementById("WoEngSnId1").value = lstCon1[0].BOATBUILDING__Engine_1_Serial_Number__c;
                                }
                                if(lstCon1[0].BOATBUILDING__Engine_2_Serial_Number__c != undefined) {
                                    document.getElementById("WoEngSnId2").value = lstCon1[0].BOATBUILDING__Engine_2_Serial_Number__c;
                                }
                                if(lstCon1[0].BOATBUILDING__Engine_3_Serial_Number__c != undefined) {
                                    document.getElementById("WoEngSnId3").value = lstCon1[0].BOATBUILDING__Engine_3_Serial_Number__c;
                                }
                                if(lstCon1[0].BOATBUILDING__Engine_4_Serial_Number__c != undefined) {
                                    document.getElementById("WoEngSnId4").value = lstCon1[0].BOATBUILDING__Engine_4_Serial_Number__c;
                                } 
                                if(lstCon1[0].BOATBUILDING__Boat_Manufacture_Date__c != undefined) {
                                    
                                    var d = parseInt(lstCon1[0].BOATBUILDING__Boat_Manufacture_Date__c);
                                    var dd = new Date(d);
                                    
                                    document.getElementById("WoDateCrtedId").value = (dd.getMonth()+1)+"/"+dd.getDate()+"/"+dd.getFullYear();
                                }
                                if(lstCon1[0].BOATBUILDING__Trailer_VIN__c != undefined) {
                                    document.getElementById("WoTvinId").value = lstCon1[0].BOATBUILDING__Trailer_VIN__c;
                                }
                                if(lstCon1[0].BOATBUILDING__Boat_Manufacturer__c != undefined) {
                                    document.getElementById("WoMakeId").value = lstCon1[0].BOATBUILDING__Boat_Manufacturer__r.Name;
                                }
                                if(lstCon1[0].BOATBUILDING__Boat_Model__c != undefined) {
                                    document.getElementById("WoModelId").value = lstCon1[0].BOATBUILDING__Boat_Model__c;
                                }
                                if(lstCon1[0].BOATBUILDING__M_Boat_Year__c != undefined) {
                                    document.getElementById("WoYearId").value = lstCon1[0].BOATBUILDING__M_Boat_Year__c;
                                }
                            }
                            else {
                                document.getElementById("WoHinId").value = "";
                                document.getElementById("WoEngSnId").value = "";
                                
                                document.getElementById("WoEngSnId1").value = "";
                                document.getElementById("WoEngSnId2").value = "";
                                document.getElementById("WoEngSnId3").value = "";
                                document.getElementById("WoEngSnId4").value = "";
                                
                                document.getElementById("WoDateCrtedId").value = "";
                                document.getElementById("WoTvinId").value = "";
                                document.getElementById("WoMakeId").value = "";
                                document.getElementById("WoModelId").value = "";
                                document.getElementById("WoYearId").value = "";
                            }
                        }
                    }
                });
            }
        }
        else {
            document.getElementById("WoHinId").value = "";
            document.getElementById("WoEngSnId").value = "";
            document.getElementById("WoEngSnId1").value = "";
	        document.getElementById("WoEngSnId2").value = "";
	        document.getElementById("WoEngSnId3").value = "";
	        document.getElementById("WoEngSnId4").value = "";
            document.getElementById("WoDateCrtedId").value = "";
            document.getElementById("WoTvinId").value = "";
            document.getElementById("WoMakeId").value = "";
            document.getElementById("WoModelId").value = "";
            document.getElementById("WoYearId").value = "";
        }
    }
    
    function calculate_LabourPrice(){
        document.getElementById("LabourTotalPrice").innerHTML = '';
        if(document.getElementById("LabourPrice").value !='' && document.getElementById("LabourQuantity").value !=''){
            var tot= parseFloat(document.getElementById("LabourQuantity").value);
            var sum_all = tot *  parseFloat(document.getElementById('LabourPrice').value);
            document.getElementById("LabourTotalPrice").innerHTML= (sum_all).toFixed(2);
        }
        else{
            return false;
        }
    }
    
    function calculate_totalofJobDiv(Divhiddenvalue){
        var hiddenvalue = document.getElementById("theValueDiv"+Divhiddenvalue).value;
        var grandtotal = 0.0;
        for(var i=1; i<=hiddenvalue; i++){
            if(document.getElementById("PartTotalDiv"+Divhiddenvalue+i) != null && document.getElementById("PartTotalDiv"+Divhiddenvalue+i).innerHTML != '' && document.getElementById("PartPriceDiv"+Divhiddenvalue+i).innerHTML != null ){
                var subtotal = parseFloat(document.getElementById("PartTotalDiv"+Divhiddenvalue+i).innerHTML);
                grandtotal = parseFloat(grandtotal + subtotal);
            }
        }
        var laboursubtotal = 0.00;
        if(document.getElementById("LabourTotalPriceDiv"+Divhiddenvalue) != null && document.getElementById("LabourTotalPriceDiv"+Divhiddenvalue).innerHTML != '' ){
            laboursubtotal = parseFloat(document.getElementById("LabourTotalPriceDiv"+Divhiddenvalue).innerHTML);
            grandtotal = parseFloat(grandtotal + laboursubtotal);
        } 
        document.getElementById("TotalOfJobDiv"+Divhiddenvalue).innerHTML = (grandtotal.toFixed(2));
        var ShopSuppliesvalue = 0.0;
        var Shopsubtotal = parseFloat(parseFloat(Percentage)*(parseFloat(laboursubtotal)/100));
        if(Shopsubtotal > parseFloat(Cap_Amount_for_percent)){
            ShopSuppliesvalue = parseFloat(Cap_Amount_for_percent);     
        }
        else{
            ShopSuppliesvalue = parseFloat(Shopsubtotal);
        }
        
        grandtotal = parseFloat(grandtotal) + parseFloat(ShopSuppliesvalue);
        document.getElementById("TotalOfJobDiv"+Divhiddenvalue).innerHTML = (grandtotal.toFixed(2));
        calDiscountedTotalAmt(Divhiddenvalue);
        calculate_totalofallJobDiv();
    }
    
    function calculate_totalofallJobDiv(){
        var shipping = 0.00;
        var Divhiddenvalue = document.getElementById("DivValue").value;
        var  grandtotal = 0.0 ; var total_parts = 0; var total_labour = 0; var total_supplies = 0;var total_amount = 0; var total_salesamount = 0.00; var total_amount_due = 0;var total_customer_pay = 0; var total_balance = 0;
        var  total_partsVT = 0; total_labourVT = 0; total_suppliesVT = 0;
        var salestax = parseFloat(document.getElementById("WoSalesTax").value);
        var salestaxPer = parseFloat(document.getElementById("salestaxHidden").value);
        if(Divhiddenvalue == "0"){
            $("#ShowjobList").css("display", "none");
        }   
        if(alllstjob != null && alllstjob.length > 0){
            for(var i=0;i < alllstjob.length; i++){
                //total_parts = parseFloat(total_parts + alllstjob[i].BOATBUILDING__Total_Amount_on_Parts_del__c);
            }
        }
        for(var i=1; i <= Divhiddenvalue; i++){
            if(document.getElementById("theValueDiv"+i) != null) {
                var hiddenvalue = document.getElementById("theValueDiv"+i).value;
                for(var j=1; j<=hiddenvalue; j++){
                    if( document.getElementById("PartTotalDiv"+i+j) != null && document.getElementById("PartTotalDiv"+i+j).innerHTML != ''){
                        var subtotal_parts = parseFloat(document.getElementById("PartTotalDiv"+i+j).innerHTML);
                        if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "1") {
                            total_parts = parseFloat(total_parts + subtotal_parts);
                        } else if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "0") {
                            total_partsVT = parseFloat(total_partsVT + subtotal_parts);
                        }
                    }
                }
            }
            var lstKey = Object.keys(objDivTotalPartAmt);
            
            if(lstKey.length > 0) {
                if("DivNum"+i in objDivTotalPartAmt) {
                    console.log('>>>>>>>>>>>:'+ objDivTotalPartAmt["DivNum"+i]);
                    var subtotal_parts = parseFloat(objDivTotalPartAmt["DivNum"+i]); 
                    if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "1") {
                        total_parts = parseFloat(total_parts + subtotal_parts);
                    } else if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "0") {
                        total_partsVT = parseFloat(total_partsVT + subtotal_parts);
                    } 
                }
            }
            
            if(document.getElementById("LabourTotalPriceDiv"+i) != null && document.getElementById("LabourTotalPriceDiv"+i).innerHTML != ''){
                var subtotal_labour = parseFloat(document.getElementById("LabourTotalPriceDiv"+i).innerHTML);
                if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "1") {
                    console.log("taxBool: true");
                    total_labour = parseFloat(total_labour + subtotal_labour);
                } else if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "0") {
                    console.log("taxBool: false");
                    total_labourVT = parseFloat(total_labourVT + subtotal_labour);
                }
            }
            if(document.getElementById("ShopSupliesTotalPriceDiv"+i) != null && document.getElementById("ShopSupliesTotalPriceDiv"+i).innerHTML != ''){
                var subtotal_supplies = parseFloat(document.getElementById("ShopSupliesTotalPriceDiv"+i).innerHTML);
                if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "1") {
                    total_supplies = parseFloat(total_supplies + subtotal_supplies);
                } else if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "0") {
                    total_suppliesVT = parseFloat(total_suppliesVT + subtotal_supplies);
                }
            }
            if(document.getElementById("TotalOfJobDiv"+i) != null && document.getElementById("TotalOfJobDiv"+i).innerHTML != ''){
                var subtotal_amount = parseFloat(document.getElementById("TotalOfJobDiv"+i).innerHTML);
                total_amount = parseFloat(total_amount + subtotal_amount);
            }
        }
        document.getElementById("grandtotal_parts").value = (total_parts + total_partsVT).toFixed(2);
        document.getElementById("grandtotal_labor").value = (total_labour + total_labourVT).toFixed(2);
        document.getElementById("grandtotal_supplies").value = (total_supplies + total_suppliesVT).toFixed(2);   
        
        
        var tp = document.getElementById("salestaxOnPartHidden").value;
        var tl = document.getElementById("salestaxOnLaborHidden").value;
        var tss = document.getElementById("salestaxOnSSHidden").value;
        var tmisc = document.getElementById("salestaxOnMISCHidden").value;
        
        console.log('tp: '+tp);
        console.log('tl: '+tl);
        console.log('tss: '+tss);
        console.log('tp: '+tmisc);
        
        console.log('total_parts: '+total_parts);
        console.log('total_partsVT: '+total_partsVT);
        
        var salesTaxonPart = 0.00;
        var salesTaxonLabor = 0.00;
        var salesTaxonSS = 0.00;
        var salesTaxonMISC = 0.00;  
        var taxOnAmountSS = 0.00; 
        if(tp != '0') {
            salesTaxonPart = parseFloat(total_parts * (salestaxPer/100));
            taxOnAmountSS += total_parts;
        }
        if(tl != '0') {
            salesTaxonLabor = parseFloat(total_labour * (salestaxPer/100));
            taxOnAmountSS += total_labour;  
        }
        if(tss != '0') {
            salesTaxonSS = parseFloat(total_supplies * (salestaxPer/100));
            taxOnAmountSS += total_supplies;
        }
        
        document.getElementById("grandtotal_total").value = (total_amount).toFixed(2); 
        
        //Discount on All jobs*********************************
        var totalDiscount = 0.00;
        var divCount = parseInt(document.getElementById("DivValue").value);
        for(var i = 1; i <= divCount; i++) {
            var dis = 0.00;
            if(document.getElementById("discountOnJob"+i) != null) {
                if(document.getElementById("discountOnJob"+i).value != '') {
                    dis = parseFloat(document.getElementById("discountOnJob"+i).value);
                }
            }
            totalDiscount += dis;
        }
        document.getElementById("grandtotalDiscount").value = (totalDiscount.toFixed(2));
        
        //Discount on WO*****************************************
        var discOnWO = 0.00;
        if(document.getElementById("discountOnWO").value != '') {
            discOnWO = parseFloat(document.getElementById("discountOnWO").value);
        }
        
        //Total Misc Charge***************************************
        var miscChargeFinal = 0.00;
        var miscChargeFinalVT = 0.00;
        for(var i=1; i <= Divhiddenvalue; i++) {
            
            if(document.getElementById("miscChargeT"+i) != null && document.getElementById("miscChargeT"+i).value != ''){
                var subtotal_Misc = parseFloat(document.getElementById("miscChargeT"+i).value);
                console.log('Divhiddenvalue>>'); 
                console.log(i); 
                console.log('subtotal_Misc>>');
                console.log(subtotal_Misc); 
                if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "1") {
                    miscChargeFinal = parseFloat(miscChargeFinal + subtotal_Misc);
                } else if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "0") {
                    miscChargeFinalVT = parseFloat(miscChargeFinalVT + subtotal_Misc);
                }
                console.log('miscChargeFinal>>');
                console.log(miscChargeFinal);
            } 
        }
        console.log('miscChargeFinal  >>: ');
        console.log(miscChargeFinal);
        
        if(tmisc != '0') {
            salesTaxonMISC = parseFloat(miscChargeFinal * (salestaxPer/100));
            taxOnAmountSS += miscChargeFinal;
        }
        
        document.getElementById("grandtotal_misc_charge").value = (miscChargeFinal + miscChargeFinalVT).toFixed(2);
        
        //Total Due Amount****************************************
        var dueAmountTotal = 0.00; 
        
        dueAmountTotal = total_amount + miscChargeFinal + miscChargeFinalVT - (totalDiscount + discOnWO);
        document.getElementById("grandtotal_amount_due").value = (dueAmountTotal).toFixed(2);
        
        //Sales Tax***********************************************
        
        //total_salesamount = parseFloat(dueAmountTotal * (7.25/100));
        var amountAfterDiscUI = 0.00;
        if(taxOnAmountSS > 0) {
            amountAfterDiscUI = taxOnAmountSS - totalDiscount - discOnWO;
        }
        console.log(amountAfterDiscUI);
        
        var finalTaxAmount = (amountAfterDiscUI) * (salestaxPer / 100); 
        
        console.log("salestaxPer: "+salestaxPer);
        console.log("document.getElementById('salestaxHidden').value: "+document.getElementById("salestaxHidden").value);
        //total_salesamount = salesTaxonPart + salesTaxonLabor + salesTaxonSS + salesTaxonMISC;//parseFloat(dueAmountTotal * (salestaxPer/100));
        
        total_salesamount = finalTaxAmount; 
        console.log('Assigned: '+total_salesamount);
        total_salesamount =  Math.round(total_salesamount * 100) / 100;
        if(total_salesamount >= 0) {
            document.getElementById("grandtotal_tax").value = parseFloat(total_salesamount).toFixed(2);
        } else {
            document.getElementById("grandtotal_tax").value = 0.00;
        }
        
        //Shipping Charge*****************************************
        var totalShippingChrge = 0.00;
        for(var i = 1; i <= divCount; i++) {
            var shippinCh = 0.00;
            if(document.getElementById("shippingId"+i) != null) {
                if(document.getElementById("shippingId"+i).value != '') {
                    shippinCh = parseFloat(document.getElementById("shippingId"+i).value);
                }
            }
            totalShippingChrge += shippinCh;
        }
        document.getElementById("shippingGrndTtl").value = parseFloat(totalShippingChrge).toFixed(2); 
        
        //Total Payment*******************************************
        var totalBalPay = 0.00;
        if(document.getElementById("grandtotal_payment").value != null && document.getElementById("grandtotal_payment").value != "") {
            totalBalPay = parseFloat(document.getElementById("grandtotal_payment").value);
        }
        //document.getElementById("grandtotal_balance").value = parseFloat((dueAmountTotal + total_salesamount + totalShippingChrge) - (totalBalPay)).toFixed(2);
        //var totBal = parseFloat(document.getElementById("grandtotal_balance").value);
        //document.getElementById("grandTotalId").value = parseFloat(totBal - totalBalPay).toFixed(2);
        document.getElementById("grandTotalId").value = parseFloat(dueAmountTotal + totalShippingChrge + total_salesamount).toFixed(2);  
        document.getElementById("grandtotal_balance").value = parseFloat(document.getElementById("grandTotalId").value) - (totalBalPay).toFixed(2);
    }
    
    function calculate_totalofallJobDiv1(){
        var shipping = 0.00;
        var Divhiddenvalue = document.getElementById("DivValue").value;
        var  grandtotal = 0.0 ; var total_parts = 0; var total_labour = 0; var total_supplies = 0;var total_amount = 0; var total_salesamount = 0.00; var total_amount_due = 0;var total_customer_pay = 0; var total_balance = 0;
        var  total_partsVT = 0; total_labourVT = 0; total_suppliesVT = 0;
        var salestax = parseFloat(document.getElementById("WoSalesTax").value);
        var salestaxPer = parseFloat(document.getElementById("salestaxHidden").value);
        if(Divhiddenvalue == "0"){
            $("#ShowjobList").css("display", "none");
        }   
        if(alllstjob != null && alllstjob.length > 0){
            for(var i=0;i < alllstjob.length; i++){
                //total_parts = parseFloat(total_parts + alllstjob[i].BOATBUILDING__Total_Amount_on_Parts_del__c);
            }
        } 
        for(var i=1; i <= Divhiddenvalue; i++){
            if(document.getElementById("theValueDiv"+i) != null) {
                var hiddenvalue = document.getElementById("theValueDiv"+i).value;
                for(var j=1; j<=hiddenvalue; j++){
                    if( document.getElementById("PartTotalDiv"+i+j) != null && document.getElementById("PartTotalDiv"+i+j).innerHTML != ''){
                        var subtotal_parts = parseFloat(document.getElementById("PartTotalDiv"+i+j).innerHTML);
                        //total_parts = parseFloat(total_parts + subtotal_parts);
                        if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "1") {
                            total_parts = parseFloat(total_parts + subtotal_parts);
                        } else if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "0") {
                            total_partsVT = parseFloat(total_partsVT + subtotal_parts);
                        }
                    }
                }
            }
            
            var lstKey = Object.keys(objDivTotalPartAmt);
            
            if(lstKey.length > 0) {
                if("DivNum"+i in objDivTotalPartAmt) {
                    console.log('>>>>>>>>>>>:'+ objDivTotalPartAmt["DivNum"+i]);
                    var subtotal_parts = parseFloat(objDivTotalPartAmt["DivNum"+i]); 
                    if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "1") {
                        total_parts = parseFloat(total_parts + subtotal_parts);
                    } else if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "0") {
                        total_partsVT = parseFloat(total_partsVT + subtotal_parts);
                    } 
                }
            } 
            
            if(document.getElementById("LabourTotalPriceDiv"+i) != null && document.getElementById("LabourTotalPriceDiv"+i).innerHTML != ''){
                var subtotal_labour = parseFloat(document.getElementById("LabourTotalPriceDiv"+i).innerHTML);
                
                if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "1") {
                    total_labour = parseFloat(total_labour + subtotal_labour);
                } else if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "0") {
                    total_labourVT = parseFloat(total_labourVT + subtotal_labour);
                }
                
                
            }
            if(document.getElementById("ShopSupliesTotalPriceDiv"+i) != null && document.getElementById("ShopSupliesTotalPriceDiv"+i).innerHTML != ''){
                var subtotal_supplies = parseFloat(document.getElementById("ShopSupliesTotalPriceDiv"+i).innerHTML);
                
                if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "1") {
                    total_supplies = parseFloat(total_supplies + subtotal_supplies);
                } else if(document.getElementById("taxBool"+i) != null && document.getElementById("taxBool"+i).value == "0") {
                    total_suppliesVT = parseFloat(total_labourVT + subtotal_supplies);
                }
                
                
            }
            if(document.getElementById("TotalOfJobDiv"+i) != null && document.getElementById("TotalOfJobDiv"+i).innerHTML != ''){
                var subtotal_amount = parseFloat(document.getElementById("TotalOfJobDiv"+i).innerHTML);
                total_amount = parseFloat(total_amount + subtotal_amount);
            }
        }
        document.getElementById("grandtotal_parts").value = (total_parts + total_partsVT).toFixed(2);
        document.getElementById("grandtotal_labor").value = (total_labour.toFixed(2));
        document.getElementById("grandtotal_supplies").value = (total_supplies.toFixed(2));
        
        //var  total_parts = parseFloat(document.getElementById("grandtotal_parts").value);
        var  total_miscCHrge = parseFloat(document.getElementById("grandtotal_misc_charge").value);
        var tp = document.getElementById("salestaxOnPartHidden").value;
        var tl = document.getElementById("salestaxOnLaborHidden").value;
        var tss = document.getElementById("salestaxOnSSHidden").value; 
        var tmisc = document.getElementById("salestaxOnMISCHidden").value;
        
        var salesTaxonPart = 0.00; 
        var salesTaxonLabor = 0.00;
        var salesTaxonSS = 0.00;
        var salesTaxonMISC = 0.00;
        
        var totalAountForTax = 0.00;
        console.log('total_parts: '+total_parts);
        console.log('total_partsVT: '+total_partsVT);
        if(tp != '0') {
            salesTaxonPart = parseFloat(total_parts * (salestaxPer/100));
            totalAountForTax += total_parts;
        }
        if(tl != '0') {
            salesTaxonLabor = parseFloat(total_labour * (salestaxPer/100));
            totalAountForTax += total_labour;
        }
        if(tss != '0') {
            salesTaxonSS = parseFloat(total_supplies * (salestaxPer/100));
            totalAountForTax += total_supplies;
        }
        if(tmisc != '0') {
            salesTaxonMISC = parseFloat(total_miscCHrge * (salestaxPer/100));
            totalAountForTax += total_miscCHrge;
        }
        
        document.getElementById("grandtotal_total").value = (total_amount).toFixed(2); 
        
        
        
        
        //Discount on All jobs*********************************
        var totalDiscount = 0.00;
        var divCount = parseInt(document.getElementById("DivValue").value);
        for(var i = 1; i <= divCount; i++) {
            var dis = 0.00;
            if(document.getElementById("discountOnJob"+i) != null) {
                if(document.getElementById("discountOnJob"+i).value != '') {
                    dis = parseFloat(document.getElementById("discountOnJob"+i).value);
                }
            }
            totalDiscount += dis;
        }
        document.getElementById("grandtotalDiscount").value = (totalDiscount.toFixed(2));
        
        //Discount on WO*****************************************
        var discOnWO = 0.00;
        if(document.getElementById("discountOnWO").value != '') {
            discOnWO = parseFloat(document.getElementById("discountOnWO").value);
        }
        
        //Total Due Amount****************************************
        var dueAmountTotal = 0.00;
        dueAmountTotal = total_amount - (totalDiscount + discOnWO);
        document.getElementById("grandtotal_amount_due").value = (dueAmountTotal).toFixed(2);
        
        //Sales Tax***********************************************
        var salestaxPer2 = parseFloat(document.getElementById("salestaxHidden").value);
        
        console.log("salestaxPer2: "+salestaxPer2);
        var amountAfterDiscUI = 0.00;
        if(totalAountForTax > 0) {
            amountAfterDiscUI = totalAountForTax - totalDiscount - discOnWO;
        } 
        
        var finalTaxmountForUI = amountAfterDiscUI * (salestaxPer2 / 100);
        //total_salesamount = parseFloat(dueAmountTotal * (7.25/100));
        //total_salesamount = parseFloat(dueAmountTotal * (salestaxPer2/100));
        //total_salesamount = salesTaxonPart + salesTaxonLabor + salesTaxonSS + salesTaxonMISC;
        total_salesamount =  finalTaxmountForUI;
        total_salesamount =  Math.round(total_salesamount * 100) / 100
        //document.getElementById("grandtotal_tax").value = parseFloat(total_salesamount).toFixed(2); 
        if(total_salesamount >= 0) {
            document.getElementById("grandtotal_tax").value = parseFloat(total_salesamount).toFixed(2);
        } else {
            document.getElementById("grandtotal_tax").value = parseFloat(0.00).toFixed(2);
        }
        
        //Shipping Charge*****************************************
        var totalShippingChrge = 0.00;
        for(var i = 1; i <= divCount; i++) {
            var shippinCh = 0.00;
            if(document.getElementById("shippingId"+i) != null) {
                if(document.getElementById("shippingId"+i).value != '') {
                    shippinCh = parseFloat(document.getElementById("shippingId"+i).value);
                }
            }
            totalShippingChrge += shippinCh;
        }
        document.getElementById("shippingGrndTtl").value = parseFloat(totalShippingChrge).toFixed(2); 
        
        //Total Payment*******************************************
        var totalBalPay = 0.00;
        if(document.getElementById("grandtotal_payment").value != null && document.getElementById("grandtotal_payment").value != "") {
            totalBalPay = parseFloat(document.getElementById("grandtotal_payment").value);
        }
        //document.getElementById("grandtotal_balance").value = parseFloat((dueAmountTotal + total_salesamount + totalShippingChrge) - (totalBalPay)).toFixed(2);
        
        //document.getElementById("grandTotalId").value = parseFloat(total_amount + totalShippingChrge + total_salesamount).toFixed(2);
        document.getElementById("grandTotalId").value = parseFloat(dueAmountTotal + totalShippingChrge + total_salesamount).toFixed(2);
        
        document.getElementById("grandtotal_balance").value = parseFloat(document.getElementById("grandTotalId").value) - (totalBalPay).toFixed(2);
    }

    function populate_quantity_div(sel,Divnum,id)
    {
        var selectedPartNumber1 = '';
        var selectedPartDesc1 = sel.options[sel.selectedIndex].text;
        /*if(!existing) {
                        
                     }*/
        selectedPartNumber1 =  sel.options[sel.selectedIndex].value;
        var PartPriceid = "#PartPriceDiv"+Divnum+id;
        var PartsQuantity = "#PartsQuantityDiv"+Divnum+id;
        var PartTotal = "#PartTotalDiv"+Divnum+id;
        
        for(var j = 0 ; j < lstPart.length ; j++) {
            if(lstPart[j].Id == selectedPartNumber1){
                $(PartPriceid).html(lstPart[j].MSRP);
                $(PartsQuantity).val(lstPart[j].Quantity);
                $(PartTotal).html(lstPart[j].Quantity * lstPart[j].MSRP);
            }
        }
    }
    
    function bind_WorkType(id,Woworktype)
    {
        if(workTypeList.length > 0) {
            for(var i = 0; i < workTypeList.length; i++) {
                
                console.log(Woworktype);
                console.log(workTypeList[i].Name);
                if(workTypeList[i].BOATBUILDING__Active__c) {
                    if(Woworktype === workTypeList[i].Name) {
                        //console.log("True");
                        //$(id).attr('selected', 'selected');
                        //+"  option:contains(" + Woworktype + ")"
                        $(id).append("<option selected='selected' value="+workTypeList[i].BOATBUILDING__Price__c+">"+workTypeList[i].Name+"</option>");
                    } else {
                        $(id).append("<option value="+workTypeList[i].BOATBUILDING__Price__c+">"+workTypeList[i].Name+"</option>");
                    } 
                }
            }
        }
    }
    
    function change_LabourValues(Divnum)
    {
        var LabourPrice = "LabourPriceDiv"+Divnum;
        
        var LabourTotalPrice = "LabourTotalPriceDiv"+Divnum;
        if(document.getElementById("WorkTypeSelect"+Divnum) != null) {
            document.getElementById(LabourPrice).value = $("#WorkTypeSelect"+Divnum).val();
        }
        if(document.getElementById("newjobWorkTypeId"+Divnum) != null) {
            document.getElementById(LabourPrice).value = $("#newjobWorkTypeId"+Divnum).val();
        }
        var tot = 0;
        if(document.getElementById("LabourQuantityDiv"+Divnum).value != "") {
            tot= parseFloat(document.getElementById("LabourQuantityDiv"+Divnum).value);
        }
        var sum_all = tot *  parseFloat(document.getElementById(LabourPrice).value);
        document.getElementById(LabourTotalPrice).innerHTML = (sum_all.toFixed(2));
        var partsTotal = 0.00;
        var laborTotal = 0.00;
        var shopSupplies = 0.00;
        if("DivNum"+Divnum in objDivTotalPartAmt) {
            partsTotal = parseFloat(objDivTotalPartAmt["DivNum"+Divnum]);
        }
        if(document.getElementById(LabourTotalPrice) != null && document.getElementById(LabourTotalPrice).innerHTML != "") {
            laborTotal = parseFloat(document.getElementById(LabourTotalPrice).innerHTML);
        }
        
        var midTotal = partsTotal + laborTotal;
        if(Percentage != '' && Cap_Amount_for_percent != '') {
            
            shopSupplies = laborTotal * (parseFloat(Percentage) / 100); 
            if(shopSupplies > parseFloat(Cap_Amount_for_percent)) {
                //shopSupplies = 25.00;
                shopSupplies = parseFloat(Cap_Amount_for_percent)
            }
        }
        document.getElementById("ShopSupliesTotalPriceDiv"+Divnum).innerHTML = shopSupplies.toFixed(2);
        document.getElementById("TotalOfJobDiv"+Divnum).innerHTML = parseFloat(midTotal + shopSupplies).toFixed(2);
        calDiscountedTotalAmt(Divnum);
    }

    function calculate_quantity_Div(Divnum,id)
    {
        document.getElementById("PartTotalDiv"+Divnum+id).innerHTML = '';
        var sum_all = 0.0;
        if(document.getElementById("PartsQuantityDiv"+Divnum+id).value !='' && document.getElementById("PartPriceDiv"+Divnum+id).innerHTML !=''){
            var tot= parseInt(document.getElementById("PartsQuantityDiv"+Divnum+id).value);
            sum_all = tot *  parseFloat(document.getElementById('PartPriceDiv'+Divnum+id).innerHTML);
        }
        document.getElementById("PartTotalDiv"+Divnum+id).innerHTML= (sum_all.toFixed(2));
        calDiscountedTotalAmt(Divnum);
    }
    
    function add_new_row(Divnum)
    {
        addJobDiv = Divnum;
        jobIndex = Divnum;
        $("#PymntModlnewjob").fadeIn();  
        /*$("#hiddentdDiv"+Divnum).css("display","");
                    var fd = document.getElementById("file1Div"+Divnum);
                    var newdiv = document.createElement("div"+Divnum);
                    var numi = document.getElementById('theValueDiv'+Divnum);
                    var num = (document.getElementById("theValueDiv"+Divnum).value -1)+ 2;
                    numi.value = num;
                    var selectpartlist = "selectpartlistDiv"+Divnum+num;
                    var PartTotal = "PartTotalDiv"+Divnum+num;
                    var PartsQuantity = "PartsQuantityDiv"+Divnum+num;
                    var PartPrice = "PartPriceDiv"+Divnum+num;
                    
                    var r = Math.floor(Math.random()*100000);
                    newdiv.setAttribute("id","aaaa"+r);
                
                    newdiv.innerHTML ='<table width="100%" border="0" cellspacing="2" cellpadding="2"><tr><td data-label="Part" width="43" >Parts</td><td data-label="Parts No" width="65"><select style="width:200px;" class="slds-select chosen selectpartlist" onchange="populate_quantity_div(this,'+Divnum+','+num+'); calculate_totalofJobDiv('+Divnum+');" id="'+selectpartlist+'"><option selected="selected">Choose...</option></select></td><td data-label="Quanity" width="144"><input id="'+PartsQuantity+'" onkeypress="return isNumber(event)" onkeyup="calculate_quantity_Div('+Divnum+','+num+'); calculate_totalofJobDiv('+Divnum+');" class="slds-input" type="text"/><td id="'+PartPrice+'" class="slds-text-align--right" width="90"></td><td width="60" class="slds-text-align--right" id="'+PartTotal+'"><i class="fa fa-usd" aria-hidden="true"></i></td><td width="24" align="right"><a href="#1" title="Remove" class="hyperlink" style="text-decoration:none;" onclick="Javascript:remove_row(\''+"aaaa"+r+'\','+num+');return false">Remove</a></td></tr></table>';
                    fd.appendChild(newdiv);
                
                    var selectedPartNumber = '';
                    
                     if(lstPart.length > 0) {
                                 for(var i = 0 ; i < lstPart.length ; i++) {
                                        var partId = "";
                                        var partNumber = "";
                                        var partName = ""
                                        var partQuantity = 0;
                                        var retailPrice = 0.00;
                                        var totalRetailPrice = 0.00;
                                        var grndTotal = 0.00;
                                        if(lstPart[i].Id != null) {
                                            partId = lstPart[i].Id;
                                        }
                                        if(lstPart[i].PartNumber != null) {
                                             partNumber = lstPart[i].PartNumber;
                                        }
                                        if(lstPart[i].PartName != null) {
                                             partName = lstPart[i].PartName;
                                        }
                                        if(lstPart[i].Quantity != null) {
                                             partQuantity = parseInt(lstPart[i].Quantity);
                                        }
                                        if(lstPart[i].MSRP != null) {
                                             retailPrice = parseFloat(lstPart[i].MSRP);
                                        }
                                        totalRetailPrice = mapInvoiceItemQuantity[lstPart[i].PartNumber] * retailPrice;
                                        $("#selectpartlistDiv"+Divnum+num).append("<option value="+partId+">"+partNumber+":"+partName+"</option>");   
                                    }
                                        $("#selectpartlistDiv"+Divnum+num).trigger("chosen:updated");
                    } 
                                $("#selectpartlistDiv"+Divnum+num).chosen({
                                    disable_search_threshold: 10,
                                    no_results_text: "Oops, nothing found!",
                                    width: "220px",
                                    search_contains: true
                                }); 
                    */
        }
    
    function remove_row(xxx,id) 
    {
        var Divhiddenvalue = document.getElementById("DivValue").value;
        var hiddenvalue = "theValueDiv"+Divhiddenvalue;
        var xxx = document.getElementById(xxx);
        xxx.parentNode.removeChild(xxx);
        document.getElementById(hiddenvalue).value = parseInt(document.getElementById(hiddenvalue).value)-1;
        calculate_totalofJobDiv(Divhiddenvalue);
        //document.getElementById("theValue").value=document.getElementById("theValue").value -1;
    }  
    
    function remove_div(divid,divnum) 
    {
        if("DivNum"+divnum in objDivTotalPartAmt) {
            delete objDivTotalPartAmt["DivNum"+divnum];
        }
        var elem = document.getElementById(divid);
        elem.remove(); 
        document.getElementById("DivValue").value = parseInt(document.getElementById("DivValue").value)-1;
        var newdivid = "aaoo"+divnum;
        if(divid == newdivid){
            var index = parseInt(divnum);
            var index_to_remove = parseInt(divnum) - 1;
            alllstjob.pop(index_to_remove);
        }
        calculate_totalofallJobDiv();
    }   
    
    </script>
    
    <script>
    
    $(document).ready(function(){
        lstPart = [];
        var selectedPartNumber = '';
        BOATBUILDING.WorkOrderControllerClone.PopulatePartNumber(function(result, event) {
            if(event.status) {
                if(result != null) {
                    lstPart = result;
                    if(lstPart.length > 0) {
                        for(var i = 0 ; i < lstPart.length ; i++) {
                            var partId= "";
                            var partNumber = "";
                            var partName = ""
                            var partQuantity = 0;
                            var retailPrice = 0.00;
                            var totalRetailPrice = 0.00;
                            var grndTotal = 0.00;
                            if(lstPart[i].Id != null) {
                                partId = lstPart[i].Id;
                            }
                            if(lstPart[i].PartNumber != null) {
                                partNumber = lstPart[i].PartNumber;
                            }
                            if(lstPart[i].PartName != null) {
                                partName = lstPart[i].PartName;
                            }
                            if(lstPart[i].Quantity != null) {
                                partQuantity = parseInt(lstPart[i].Quantity);
                            }
                            if(lstPart[i].MSRP != null) {
                                retailPrice = parseFloat(lstPart[i].MSRP);
                            }
                            totalRetailPrice = mapInvoiceItemQuantity[lstPart[i].PartNumber] * retailPrice;
                            $(".selectpartlist").append("<option value="+partId+">"+partNumber+":"+partName+"</option>");   
                        }
                        $('.selectpartlist').trigger("chosen:updated");
                    }
                }
            }
        });
        $(".chosen").chosen({
            disable_search_threshold: 10,
            no_results_text: "Oops, nothing found!",
            width: "220px",
            search_contains: true
        }); 
        
        $("#selectpartlist").change(function(){
            var selectedPartDesc = $(this).find("option:selected").text();
            selectedPartNumber = $(this).val();
            for(var i = 0 ; i < lstPart.length ; i++) {
                if(lstPart[i].Id == selectedPartNumber){
                    $("#PartPrice").html(lstPart[i].BOATBUILDING__Part_MSRP_Price__c);
                    $("#PartsQuantity").val(lstPart[i].BOATBUILDING__Quantity__c);
                    $("#PartTotal").html(lstPart[i].BOATBUILDING__Quantity__c * lstPart[i].BOATBUILDING__Part_MSRP_Price__c);
                }
            }
        });
        
    });
    
    function calculate_LabourPrice_Div(Divnum)
    {
        document.getElementById("LabourTotalPriceDiv"+Divnum).innerHTML = '0.00';
        if(document.getElementById("LabourPriceDiv"+Divnum).value != '' && document.getElementById("LabourQuantityDiv"+Divnum).value != '' && document.getElementById("LabourQuantityDiv"+Divnum).value != ".") 
        {
            var tot= parseFloat(document.getElementById("LabourQuantityDiv"+Divnum).value);
            var sum_all = tot *  parseFloat(document.getElementById('LabourPriceDiv'+Divnum).value);
            var finalSum = (sum_all.toFixed(2));
            document.getElementById("LabourTotalPriceDiv"+Divnum).innerHTML = finalSum;
        }
        else{
            return false;
        }
        change_LabourValues(Divnum);
    }
    
    function calDiscountedTotalAmt(divIndex) {
        var totalAmt = 0.00;    
        var discount = 0.00;
        var discountONWO = 0.00;
        console.log('calDiscountedTotalAmt>>>>:' +divIndex);
        if(document.getElementById("TotalOfJobDiv"+divIndex).innerHTML != '' && document.getElementById("TotalOfJobDiv"+divIndex).innerHTML != 'NaN') {
            totalAmt = parseFloat(document.getElementById("TotalOfJobDiv"+divIndex).innerHTML);
        }
        if(document.getElementById("discountOnJob"+divIndex).value != '') {
            discount = parseFloat(document.getElementById("discountOnJob"+divIndex).value);
        }
        console.log('discount>>>>:' +discount);
        if(discount <= totalAmt) {
            document.getElementById("gTotalAmt"+divIndex).innerHTML = (totalAmt - discount).toFixed(2);
        }else {
            // alert("Discount should less than total amount.");
            document.getElementById("gTotalAmt"+divIndex).innerHTML = (totalAmt).toFixed(2);
            document.getElementById("discountOnJob"+divIndex).value = (0.00).toFixed(2);
        }  
        
        var miscChrg = 0.00;
        if(document.getElementById("miscChargeT"+divIndex) != null && document.getElementById("miscChargeT"+divIndex).value != '') {
            miscChrg = parseFloat(document.getElementById("miscChargeT"+divIndex).value);
        }
        var ShippingCharge = 0.00;
        if(document.getElementById("shippingId"+divIndex) != null && document.getElementById("shippingId"+divIndex).value != '') {
            ShippingCharge = parseFloat(document.getElementById("shippingId"+divIndex).value);
        }
        
        var totalOfJobDivTT =  0.00;
        if(document.getElementById("TotalOfJobDiv"+divIndex).innerHTML != '') { 
            totalOfJobDivTT = parseFloat(document.getElementById("TotalOfJobDiv"+divIndex).innerHTML);
        }
        
        
        document.getElementById("gTotalAmt"+divIndex).innerHTML = (totalOfJobDivTT + miscChrg + ShippingCharge - parseFloat(discount)).toFixed(2);      
        
        
        calculate_totalofallJobDiv(); 
    }
    
    function calculateBalance() {
        calculate_totalofallJobDiv();
    }
    
    var objDivTotalPartAmt = new Object();
    $("#Addjob").click(function(){
        var sel = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:sl1');
        if(!existing) {
            selectedPartNumber1 = sel.options[sel.selectedIndex].value;
        }
        var Divi = document.getElementById('DivValue');
        var Divnum = (document.getElementById("DivValue").value -1)+ 2;
        Divi.value = Divnum;
        
        var theValue = "theValueDiv"+Divnum;
        var WoExistingjobId = "WojobId"+Divnum;
        var WoExistingjobName = "WoExistingjobName"+Divnum;
        var WoExistingWr = "WoExistingWr"+Divnum;
        var WoExistingWt = "WoExistingWt"+Divnum;
        var partdiv='';
        var WOComments = '';
        var TechName = '';
        var TechId = '';
        var BTN_lbl = 'Add Technician';
        var shippingChargeId = "shippingId"+Divnum;
        if(document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkid').value != '000000000000000' &&  document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2').value != ''&& document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkid').value != '000000000000000' && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId').value != ''
           && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation').value != null && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation').value != ''){
            if(selectedPartNumber1 != ''){
                //$("#createwoorder").css("display","");
                $("#ShowjobList").css("display", "");
                var AddPart = "AddPartDiv"+Divnum;
                var hiddentd = "hiddentdDiv"+Divnum;
                var ShopSuppliesPrice = "ShopSuppliesPriceDiv"+Divnum;
                var ShopSupliesTotalPrice = "ShopSupliesTotalPriceDiv"+Divnum;
                var TotalOfJobDiv = "TotalOfJobDiv"+Divnum;
                var WorkTypeSelect = "WorkTypeSelect"+Divnum;
                var LabourQuantity = "LabourQuantityDiv"+Divnum;
                var LabourPrice = "LabourPriceDiv"+Divnum;
                var LabourTotalPrice = "LabourTotalPriceDiv"+Divnum;
                var WOComment = '', Wojobname = '',Woworkrequested = '', Woworktype = '',WoLabourQuantity = '',WoLabourPrice = 0.0, WoLabourTotalPrice = 0.0, WoshopsuppliesPrice = 0.0, wojobCustomerPay = 0.0 , wojobTotal = 0.0 ,WojobId = '' ;
                if(lstjob.length > 0) {
                    if(lstjob[0].Id != undefined) {
                        WojobId = lstjob[0].Id;
                    }
                    if(lstjob[0].BOATBUILDING__Technician__c != undefined) {
                        TechId = lstjob[0].BOATBUILDING__Technician__c;
                        TechName = lstjob[0].BOATBUILDING__Technician__r.Name;
                        BTN_lbl = 'Update Technician';
                    }
                    
                    if(lstjob[0].BOATBUILDING__Job_Name__c != undefined) {
                        Wojobname = lstjob[0].BOATBUILDING__Job_Name__c;
                    }
                    if(lstjob[0].BOATBUILDING__Work_Requested__c != undefined) {
                        Woworkrequested = lstjob[0].BOATBUILDING__Work_Requested__c;
                    }
                    console.log('worktypeeeeeeeeeeeeeBefore'+lstjob[0].BOATBUILDING__Work_Type__c);
                    if(lstjob[0].BOATBUILDING__Work_Type__c != undefined) {
                        console.log('worktypeeeeeeeeeeeee'+lstjob[0].BOATBUILDING__Work_Type__c);
                        Woworktype = lstjob[0].BOATBUILDING__Work_Type__c;
                    }
                    if(lstjob[0].BOATBUILDING__No_of_Labors__c != undefined) {
                        WoLabourQuantity = lstjob[0].BOATBUILDING__No_of_Labors__c;
                    }
                    if(lstjob[0].BOATBUILDING__Price_per_Labor__c != undefined) {
                        WoLabourPrice = lstjob[0].BOATBUILDING__Price_per_Labor__c;
                    }
                    
                    if(lstjob[0].BOATBUILDING__Comments__c != undefined) {
                        WOComment = lstjob[0].BOATBUILDING__Comments__c;
                    } 
                    if(lstjob[0].BOATBUILDING__Total_Cost_Labor__c != undefined) {
                        WoLabourTotalPrice = lstjob[0].BOATBUILDING__Total_Cost_Labor__c;
                    }
                    if(lstjob[0].BOATBUILDING__Shop_Supplies_Total__c != undefined && lstjob[0].BOATBUILDING__Shop_Supplies_Total__c <= parseFloat(Cap_Amount_for_percent)) {
                        WoshopsuppliesPrice = lstjob[0].BOATBUILDING__Shop_Supplies_Total__c;
                    }else if(Cap_Amount_for_percent != ''){
                        WoshopsuppliesPrice = parseFloat(Cap_Amount_for_percent);                      
                    }else {
                        WoshopsuppliesPrice = 0.00;
                    }
                    var totalPrtAmt = 0.00;
                    if(lstjob[0].BOATBUILDING__Total_Amount_on_Parts_del__c != undefined) {
                        totalPrtAmt = parseFloat(lstjob[0].BOATBUILDING__Total_Amount_on_Parts_del__c); 
                    }
                    
                    var misccc = 0.00
                    if(lstjob[0].BOATBUILDING__Misc_Charge__c != undefined) {
                        misccc = parseFloat(lstjob[0].BOATBUILDING__Misc_Charge__c);
                    }
                    var misccc2 = 0.00
                    if(lstjob[0].BOATBUILDING__Misc_Charge_2__c != undefined) {
                        misccc2 = parseFloat(lstjob[0].BOATBUILDING__Misc_Charge_2__c);
                    }
                    var misccc3 = 0.00
                    if(lstjob[0].BOATBUILDING__Misc_Charge_3__c != undefined) {
                        misccc3 = parseFloat(lstjob[0].BOATBUILDING__Misc_Charge_3__c);
                    }
                    var miscccd = '';
                    if(lstjob[0].BOATBUILDING__Misc_Description_1__c != undefined) {
                        miscccd = lstjob[0].BOATBUILDING__Misc_Description_1__c;
                    } 
                    var miscccd2 = '';
                    if(lstjob[0].BOATBUILDING__Misc_Description_2__c != undefined) {
                        miscccd2 = lstjob[0].BOATBUILDING__Misc_Description_2__c;
                    }
                    var miscccd3 = '';
                    if(lstjob[0].BOATBUILDING__Misc_Description_3__c != undefined) {
                        miscccd3 = lstjob[0].BOATBUILDING__Misc_Description_3__c;
                    }
                    
                    var taxableBool = '0';
                    if(lstjob[0].BOATBUILDING__Taxable__c == true) { 
                        console.log('Taxable Bool: '+lstjob[0].BOATBUILDING__Taxable__c);
                        taxableBool = '1'; 
                    }
                    
                    var custComm = '';
                    console.log('+++++: '+lstjob[0].BOATBUILDING__Customer_Comments__c);
                    if(lstjob[0].BOATBUILDING__Customer_Comments__c != undefined) {
                        custComm = lstjob[0].BOATBUILDING__Customer_Comments__c;
                        console.log(lstjob[0].BOATBUILDING__Customer_Comments__c);
                    }
                    // + parseFloat(WoShippingCharge)
                    var totalMisc = misccc + misccc2 + misccc3;
                    wojobTotal = WoLabourTotalPrice + WoshopsuppliesPrice + totalPrtAmt + misccc; 
                    
                }
                if(taxableBool == '1') {
                    var newdiv ="<div class='slds-card'id='aaoo"+Divnum+"'><div style='color: #D8000C;' id='error-panel"+Divnum+"'> <input type='hidden' value='"+taxableBool+"' id='taxBool"+Divnum+"'/> <ul id='error-div"+Divnum+"'></ul></div><div style='float:right;line-height:0;'><a style='text-decoration:none;' onclick='remove_div(\"aaoo"+Divnum+"\",\""+Divnum+"\")'><i class='fa fa-times fa-lg' aria-hidden='true'></i></a></div><div class='slds-grid slds-wrap slds-m-top--medium'><table class='slds-table slds-table--bordered'><thead><tr><th>Job</th><th>Work Requested</th><th >Type</th><th >Quantity</th><th class='slds-text-align--right'>Price</th><th class='slds-text-align--right'>Total</th><th class='slds-text-align--right'></th></tr></thead><tbody> <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Taxable</td><td  class='slds-text-align--right'><label class='slds-checkbox'><input type='checkbox' name='Taxable' onchange='taxchange("+Divnum+")' id='taxableBoolView"+Divnum+"' checked='checked'/><span class='slds-checkbox--faux'></span></label></label></td></tr><tr><td colspan='5'><input id="+WoExistingjobId+" type='hidden' value="+WojobId+"></input><input class='slds-input' id="+WoExistingjobName+" type='text' value='"+Wojobname+"'></input></td><td><select id="+WorkTypeSelect+" onchange='change_LabourValues("+Divnum+"); calculate_totalofallJobDiv();' class='slds-select'><option value='0' selected='selected'>--None--</option></select></td><td>&nbsp;</td><td class='slds-text-align--right'></td></tr><tr><td colspan='7'><div id=existingjobdiv"+Divnum+"><input type='hidden' name='theValue' id='"+theValue+"' value='0' /></div></td></tr><tr><td>&nbsp;</td><td data-label='Labor'>Labor</td><td>&nbsp;</td><td data-label='Quantity'><input id='"+LabourQuantity+"' onkeypress='return isNumberKey(event)' class='slds-input' type='text' onkeyup='calculate_LabourPrice_Div("+Divnum+"); calculate_totalofallJobDiv();' value='"+WoLabourQuantity+"'/></td><td data-label='Price' class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><input id='"+LabourPrice+"'  class='slds-input' type='text' disabled='disabled' value="+WoLabourPrice+"></td><td data-label='Total' class='slds-text-align--right' ><i class='fa fa-usd' aria-hidden='true' ></i><span id="+LabourTotalPrice+">"+WoLabourTotalPrice+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td data-label='Shop Supplies'>Shop Supplies</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Total' class='slds-text-align--right'></td><td data-label='TotalShop' class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><span id='ShopSupliesTotalPriceDiv"+Divnum+"'>"+WoshopsuppliesPrice+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Prospecting' class='slds-text-align--right'>Total:<td class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><span id='TotalOfJobDiv"+Divnum+"'>"+wojobTotal+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Discount ($)</td><td class='slds-text-align--right'><input onkeypress='return isNumberKey(event)' onKeyUp='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Discount' id='discountOnJob"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Shipping Charge ($)</td><td class='slds-text-align--right'><input onkeypress='return isNumberKey(event)' onKeyUp='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Shipping Charge' id='"+shippingChargeId+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>Misc Description 1</td><td colspan='2'><input type='text' value='"+miscccd+"' class='slds-input' id='miscDesc1"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 1 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' value='"+misccc+"' class='slds-input' name='Misc Charge' id='miscCharge1"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 2</td><td colspan='2'><input value='"+miscccd2+"' type='text' class='slds-input'  id='miscDesc2"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 2 ($)</td><td class='slds-text-align--right'><input value='"+misccc2+"'  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge2"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 3</td><td colspan='2'><input value='"+miscccd3+"' type='text' class='slds-input' id='miscDesc3"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 3 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' value='"+misccc3+"' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge3"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Misc Charge ($)</td><td class='slds-text-align--right'><input disabled='disabled' value='"+parseFloat(totalMisc).toFixed(2)+"'onkeypress='return isNumberKey(event)' onchange='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Misc Charge' id='miscChargeT"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Total Amount</td><td class='slds-text-align--right' id='gTotalAmt"+Divnum+"'>"+(wojobTotal).toFixed(2)+"</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Approved By Customer</td><td class='slds-text-align--right'><label class='slds-checkbox'><input  type='checkbox' name='Is Approved' id='isApprovedJob"+Divnum+"' value='Approved By Customer'><span class='slds-checkbox--faux'></span></label></td><td>&nbsp;</td></tr></tbody></table></div><div style='padding: 5px;'><span style='position: absolute;'>Comments:</span><input type='hidden' value='300' id='hcmnt"+Divnum+"'> <input type='hidden'  id='cmnt"+Divnum+"' value='"+WOComments+"'/><span style='position: relative; left:24%;'><a onclick='addCommentToJob(\""+Divnum+"\", \"SER\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCommentFromJob(\""+Divnum+"\", \"SER\");'>View</a></span> </div><div style='padding: 5px;'><span style='position: absolute;'>Customer Comments:</span> <input type='hidden'  id='Custcmnt"+Divnum+"' value='"+custComm+"' /><span style='position: relative; left:24%;'><a onclick='addCustCommentToJob(\""+Divnum+"\", \"CUST\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCustCommentFromJob(\""+Divnum+"\", \"CUST\");'>View</a></span> </div> <div style='padding: 5px;'> <span>Technician:&nbsp;<input type='hidden' id='jbTechId"+Divnum+"' value='"+TechId+"'/><span id='techName"+Divnum+"'>"+TechName+"</span>&nbsp;<a onclick='addTechnician(\""+Divnum+"\")' style='position: absolute; left:19.5%;'> "+BTN_lbl+" </a></span> </div></div>";
                } else {
                    var newdiv ="<div class='slds-card'id='aaoo"+Divnum+"'><div style='color: #D8000C;' id='error-panel"+Divnum+"'> <input type='hidden' value='"+taxableBool+"' id='taxBool"+Divnum+"'/> <ul id='error-div"+Divnum+"'></ul></div><div style='float:right;line-height:0;'><a style='text-decoration:none;' onclick='remove_div(\"aaoo"+Divnum+"\",\""+Divnum+"\")'><i class='fa fa-times fa-lg' aria-hidden='true'></i></a></div><div class='slds-grid slds-wrap slds-m-top--medium'><table class='slds-table slds-table--bordered'><thead><tr><th>Job</th><th>Work Requested</th><th >Type</th><th >Quantity</th><th class='slds-text-align--right'>Price</th><th class='slds-text-align--right'>Total</th><th class='slds-text-align--right'></th></tr></thead><tbody> <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Taxable</td><td  class='slds-text-align--right'><label class='slds-checkbox'><input type='checkbox' name='Taxable' onchange='taxchange("+Divnum+")' id='taxableBoolView"+Divnum+"'/><span class='slds-checkbox--faux'></span></label></label></td></tr><tr><td colspan='5'><input id="+WoExistingjobId+" type='hidden' value="+WojobId+"></input><input class='slds-input' id="+WoExistingjobName+" type='text' value='"+Wojobname+"'></input></td><td><select id="+WorkTypeSelect+" onchange='change_LabourValues("+Divnum+"); calculate_totalofallJobDiv();' class='slds-select'><option value='0' selected='selected'>--None--</option></select></td><td>&nbsp;</td><td class='slds-text-align--right'></td></tr><tr><td colspan='7'><div id=existingjobdiv"+Divnum+"><input type='hidden' name='theValue' id='"+theValue+"' value='0' /></div></td></tr><tr><td>&nbsp;</td><td data-label='Labor'>Labor</td><td>&nbsp;</td><td data-label='Quantity'><input id='"+LabourQuantity+"' onkeypress='return isNumberKey(event)' class='slds-input' type='text' onkeyup='calculate_LabourPrice_Div("+Divnum+"); calculate_totalofallJobDiv();' value='"+WoLabourQuantity+"'/></td><td data-label='Price' class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><input id='"+LabourPrice+"'  class='slds-input' type='text' disabled='disabled' value="+WoLabourPrice+"></td><td data-label='Total' class='slds-text-align--right' ><i class='fa fa-usd' aria-hidden='true' ></i><span id="+LabourTotalPrice+">"+WoLabourTotalPrice+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td data-label='Shop Supplies'>Shop Supplies</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Total' class='slds-text-align--right'></td><td data-label='TotalShop' class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><span id='ShopSupliesTotalPriceDiv"+Divnum+"'>"+WoshopsuppliesPrice+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Prospecting' class='slds-text-align--right'>Total:<td class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><span id='TotalOfJobDiv"+Divnum+"'>"+wojobTotal+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Discount ($)</td><td class='slds-text-align--right'><input onkeypress='return isNumberKey(event)' onKeyUp='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Discount' id='discountOnJob"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Shipping Charge ($)</td><td class='slds-text-align--right'><input onkeypress='return isNumberKey(event)' onKeyUp='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Shipping Charge' id='"+shippingChargeId+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>Misc Description 1</td><td colspan='2'><input type='text' value='"+miscccd+"' class='slds-input' id='miscDesc1"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 1 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' value='"+misccc+"' class='slds-input' name='Misc Charge' id='miscCharge1"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 2</td><td colspan='2'><input value='"+miscccd2+"' type='text' class='slds-input'  id='miscDesc2"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 2 ($)</td><td class='slds-text-align--right'><input value='"+misccc2+"'  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge2"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 3</td><td colspan='2'><input value='"+miscccd3+"' type='text' class='slds-input' id='miscDesc3"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 3 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' value='"+misccc3+"' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge3"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Misc Charge ($)</td><td class='slds-text-align--right'><input disabled='disabled' value='"+parseFloat(totalMisc).toFixed(2)+"'onkeypress='return isNumberKey(event)' onchange='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Misc Charge' id='miscChargeT"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Total Amount</td><td class='slds-text-align--right' id='gTotalAmt"+Divnum+"'>"+(wojobTotal).toFixed(2)+"</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Approved By Customer</td><td class='slds-text-align--right'><label class='slds-checkbox'><input  type='checkbox' name='Is Approved' id='isApprovedJob"+Divnum+"' value='Approved By Customer'><span class='slds-checkbox--faux'></span></label></td><td>&nbsp;</td></tr></tbody></table></div><div style='padding: 5px;'><span style='position: absolute;'>Comments:</span><input type='hidden' value='300' id='hcmnt"+Divnum+"'> <input type='hidden'  id='cmnt"+Divnum+"' value='"+WOComments+"'/><span style='position: relative; left:24%;'><a onclick='addCommentToJob(\""+Divnum+"\", \"SER\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCommentFromJob(\""+Divnum+"\", \"SER\");'>View</a></span> </div><div style='padding: 5px;'><span style='position: absolute;'>Customer Comments:</span> <input type='hidden'  id='Custcmnt"+Divnum+"' value='"+custComm+"' /><span style='position: relative; left:24%;'><a onclick='addCustCommentToJob(\""+Divnum+"\", \"CUST\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCustCommentFromJob(\""+Divnum+"\", \"CUST\");'>View</a></span> </div> <div style='padding: 5px;'> <span>Technician:&nbsp;<input type='hidden' id='jbTechId"+Divnum+"' value='"+TechId+"'/><span id='techName"+Divnum+"'>"+TechName+"</span>&nbsp;<a onclick='addTechnician(\""+Divnum+"\")' style='position: absolute; left:19.5%;'> "+BTN_lbl+" </a></span></div></div>";
                }
                
                if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r != undefined) {
                    var totalOfAll = 0.00;
                    for(var i=0; i<lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r.length; i++){
                        var WoPartnumber = '', WoPartQuantity = '',WoPartname = '', WoPartPrice = 0.0, WoPartTotalPrice = 0.0;
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Part_Number__c != undefined){
                            WoPartnumber = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Part_Number__c;
                        }
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Part_Name__c != undefined){
                            WoPartname = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Part_Name__c;
                        }
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Quantity__c != undefined ){
                            WoPartQuantity = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Quantity__c;
                        }
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Price__c != undefined ){
                            WoPartPrice = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Price__c;
                        }
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Total__c != undefined ){
                            WoPartTotalPrice = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Total__c;
                            totalOfAll += parseFloat(WoPartTotalPrice);
                        }
                        objDivTotalPartAmt["DivNum"+Divnum] = totalOfAll;
                        partdiv += '<table width="100%" border="0" cellspacing="2" cellpadding="2"><tr><td data-label="Part" width="43" >Parts</td><td width="65">'+WoPartnumber+'</td><td width="65">'+WoPartname+'</td><td width="106">&nbsp;</td><td data-label="Quantity" width="144">'+WoPartQuantity+'</td><td class="slds-text-align--right" width="90"><i class="fa fa-usd" aria-hidden="true"></i>'+WoPartPrice+'</td><td width="60" class="slds-text-align--right"><i class="fa fa-usd" aria-hidden="true"></i>'+WoPartTotalPrice+'</td></tr></table>';                            
                    }
                    console.log(">>>>objDivTotalPartAmt: "+objDivTotalPartAmt);
                }
                var id = "#WorkTypeSelect"+Divnum;
                $("#AddDivForJob").append(newdiv);
                bind_WorkType(id,Woworktype);
                var fd = document.getElementById("existingjobdiv"+Divnum);
                $(fd).append(partdiv);
                if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r != undefined){
                    document.getElementById('theValueDiv'+Divnum).value = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r.length;
                }
                alllstjob = alllstjob.concat(lstjob);
                calculate_totalofallJobDiv(); 
                changecounter1(Divnum);
            }
            else{
                //document.getElementById("woerrSnap").innerHTML = "Please Select Existing Job";
                alert("Please Select Existing Job");
                //$("#woerrorDiv").slideDown();
                //$("#woerrorDiv").delay(4000).slideUp();
                return false;
            }
        }
        else{
        	alert("Please Select Customer And Boat And Store Location");
//             document.getElementById("woerrSnap").innerHTML = "Please Select Customer And Boat And Store Location";
//             $("#woerrorDiv").slideDown();
//             $("#woerrorDiv").delay(4000).slideUp();
            return false; 
        }
    });
    
    function changecounter1(divNum) {
        var entrdText = $("#cmnt"+divNum).val();
        if(entrdText.length > 300) {
            //return false;
        } else {
            $("#cntr"+divNum).html(300 - entrdText.length);
            document.getElementById("hcmnt"+divNum).value = entrdText.length;
        }
        //return true;
    }
    
    function changecounter(obj, divNum) {
        var entrdText = $("#cmnt"+divNum).val();
        if(entrdText.length > 300) {
            return false;
        } else {
            $("#cntr"+divNum).html(300 - entrdText.length);
            document.getElementById("hcmnt"+divNum).value = entrdText.length;
        }
        return true;
    }
    
    $("#NewJobBtn").click(function(){  
        console.log(">>>>>: ", document.getElementById('WorkTypeIdSelect').value);
        if(document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkid').value != '000000000000000' &&  document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2').value != ''&& document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkid').value != '000000000000000' && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId').value != ''){
            if( document.getElementById('WorkTypeIdSelect').value != null &&  document.getElementById('WorkTypeIdSelect').value != '' && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:TypeWorkId').value != ''
               && document.getElementById('newjobNameId').value != ''
               && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation').value != null && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation').value != ''){
                //$("#createwoorder").css("display","");
                $("#ShowjobList").css("display", "");
                var jobName = document.getElementById('newjobNameId').value;
                //var newjobworequested = document.getElementById('newjobworequested').value;
                var newjobWorkTypeId = $("#WorkTypeIdSelect option:selected").text();
                var newjobWorkTypeValue = $("#WorkTypeIdSelect").val();
                var newjobTypeWorkId = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:TypeWorkId').value;
                var Divi = document.getElementById('DivValue');
                var Divnum = (document.getElementById("DivValue").value -1)+ 2;
                Divi.value = Divnum; 
                var theValue = "theValueDiv"+Divnum;
                var AddPart = "AddPartDiv"+Divnum;
                var hiddentd = "hiddentdDiv"+Divnum;
                var LabourQuantity = "LabourQuantityDiv"+Divnum;
                var LabourPrice = "LabourPriceDiv"+Divnum;
                var LabourTotalPrice = "LabourTotalPriceDiv"+Divnum;
                var ShopSuppliesPrice = "ShopSuppliesPriceDiv"+Divnum;
                var ShopSupliesTotalPrice = "ShopSupliesTotalPriceDiv"+Divnum;
                var TotalOfJobDiv = "TotalOfJobDiv"+Divnum;
                var file1 = "file1Div"+Divnum;
                var shippingChargeId = "shippingId"+Divnum; 
                var miscCharge = "miscCharge"+Divnum;
                var newdiv ="<div class='slds-card' id='newdiv"+Divnum+"'><div style='color: #D8000C;' id='error-panel"+Divnum+"'><input type='hidden' value='1' id='taxBool"+Divnum+"'/><ul id='error-div"+Divnum+"'></ul></div><div style='float:right;line-height:0;'><a style='text-decoration:none;padding:5px;' onclick='remove_div(\"newdiv"+Divnum+"\")'><i class='fa fa-times fa-lg' aria-hidden='true'></i></a></div><div class='slds-grid slds-wrap slds-m-top--medium'><table class='slds-table slds-table--bordered'><thead><tr><th width='43'>Job Name:</th><th width='95' id='jobNameId"+Divnum+"'>"+jobName+"</th><th width='106'>&nbsp;</th><th width='144'>&nbsp;</th><th width='90' class='slds-text-align--right'>&nbsp;</th><th width='84' colspan='2' class='slds-text-align--right'>&nbsp;</th></tr><tr><th width='43'>Job</th><th width='95'>Work Requested</th><th width='106'>Type</th><th width='144'>Quantity</th><th width='90' class='slds-text-align--right'>Price</th><th width='84' colspan='2' class='slds-text-align--right'>Total</th></tr></thead><tbody> <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Taxable</td><td  class='slds-text-align--right'><label class='slds-checkbox'><input type='checkbox' name='Taxable' onchange='taxchange("+Divnum+")' checked='checked' id='taxableBoolView"+Divnum+"'><span class='slds-checkbox--faux'></span></label></label></td></tr><tr><td colspan='3'></td><td id=newjobworequested"+Divnum+"></td><td><select id=newjobWorkTypeId"+Divnum+" class='slds-select' onchange='change_LabourValues("+Divnum+");'><option value='0' selected='selected'>--None--</option></select></td><td><input type=hidden id=newjobTypeWorkId"+Divnum+" value="+newjobTypeWorkId+"/></td><td  class='slds-text-align--right'><a class='slds-button slds-button--brand' onclick='add_new_row(\""+Divnum+"\");' id='"+AddPart+"'>Add Part</a></td></tr><tr><td colspan='7' id='"+hiddentd+"' style='display:none;'><div id='"+file1+"'><input type='hidden' name='theValue' id='"+theValue+"' value='0' /></div></td></tr><tr><td>&nbsp;</td><td data-label='Labor'>Labor</td><td>&nbsp;</td><td data-label='Quantity'><input id='"+LabourQuantity+"' onkeypress='return isNumberKey(event)' class='slds-input' type='text'  onkeyup='calculate_LabourPrice_Div("+Divnum+"); calculate_totalofJobDiv("+Divnum+");'/></td><td data-label='Price' class='slds-text-align--right'><input id='"+LabourPrice+"' class='slds-input' type='text' disabled='disabled' value='"+parseFloat($("#WorkTypeIdSelect option:selected").val()).toFixed(2)+"' onkeypress='return isNumberKey(event)' onkeyup='calculate_LabourPrice_Div("+Divnum+"); calculate_totalofJobDiv("+Divnum+"); '/></td><td data-label='Total' class='slds-text-align--right' id='"+LabourTotalPrice+"'></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td data-label='Shop Supplies'>Shop Supplies</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Total' class='slds-text-align--right'>&nbsp;</td><td data-label='TotalShop' class='slds-text-align--right' id='"+ShopSupliesTotalPrice+"'></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Prospecting' class='slds-text-align--right'>Total:<td class='slds-text-align--right' id='"+TotalOfJobDiv+"'></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Discount ($)</td><td class='slds-text-align--right'><input onkeypress='return isNumberKey(event)' class='slds-input' onKeyUp='calDiscountedTotalAmt("+Divnum+");' name='Discount' id='discountOnJob"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Shipping Charge ($)</td><td class='slds-text-align--right'><input onkeypress='return isNumberKey(event)' onKeyUp='calDiscountedTotalAmt("+Divnum+"); calculate_totalofJobDiv("+Divnum+");' class='slds-input' name='Shipping Charge' id='"+shippingChargeId+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 1</td><td colspan='2'><input type='text' class='slds-input' id='miscDesc1"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 1 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge1"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 2</td><td colspan='2'><input  type='text' class='slds-input'  id='miscDesc2"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 2 ($)</td><td class='slds-text-align--right'><input onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge2"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 3</td><td colspan='2'><input type='text' class='slds-input' id='miscDesc3"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 3 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge3"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Misc Charge ($)</td><td class='slds-text-align--right'><input disabled='disabled' onkeypress='return isNumberKey(event)' onchange='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Misc Charge' id='miscChargeT"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Total Amount</td><td class='slds-text-align--right' id='gTotalAmt"+Divnum+"'>0.00</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Approved By Customer</td><td class='slds-text-align--right'><label class='slds-checkbox'><input  type='checkbox' name='Is Approved' id='isApprovedJob"+Divnum+"' value='Approved By Customer'><span class='slds-checkbox--faux'></span></label></td><td>&nbsp;</td></tr></tbody></table></div><div style='padding: 5px;'><span style='position: absolute;'>Comments:</span><input type='hidden' value='300' id='hcmnt"+Divnum+"'> <input type='hidden'  id='cmnt"+Divnum+"' /><span style='position: relative; left:24%;'><a onclick='addCommentToJob(\""+Divnum+"\", \"SER\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCommentFromJob(\""+Divnum+"\", \"SER\");'>View</a></span> </div><div style='padding: 5px;'><span style='position: absolute;'>Customer Comments:</span> <input type='hidden'  id='Custcmnt"+Divnum+"' /><span style='position: relative; left:24%;'><a onclick='addCustCommentToJob(\""+Divnum+"\", \"CUST\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCustCommentFromJob(\""+Divnum+"\", \"CUST\");'>View</a></span> </div> <div style='padding: 5px;'> <span>Technician:&nbsp;<input type='hidden' id='jbTechId"+Divnum+"'/><span id='techName"+Divnum+"'></span>&nbsp;<a onclick='addTechnician(\""+Divnum+"\")' style='position: absolute; left:19.5%;'> Add Technician </a></span></div></div>";  
                var WorkTypeSelect = "#newjobWorkTypeId"+Divnum;
                $("#AddDivForJob").append(newdiv);
                bind_WorkType(WorkTypeSelect,newjobWorkTypeId);
                $("#newjobNameId").val("");
                $("#newjobworequested").val(""); 
                $("#WorkTypeIdSelect").val("");
                document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:TypeWorkId').value = "0"; 
            }
            else{
//                 document.getElementById("woerrSnap").innerHTML = "Job Name, WorkRequested, WorkType, Type And Store Location are mandatory";
//                 $("#woerrorDiv").slideDown();
//                 $("#woerrorDiv").delay(4000).slideUp();
                alert("Job Name, WorkRequested, WorkType, Type And Store Location are mandatory");
                return false;
            }
        }
        else{ 
//             document.getElementById("woerrSnap").innerHTML = "Customer And Boat Selection are mandatory";
//             $("#woerrorDiv").slideDown();
//             $("#woerrorDiv").delay(4000).slideUp();
            alert("Customer And Boat Selection are mandatory");
            return false;
        }
        
    });
    $("#addNewJobBtn").click(function(){
        $("#showaddjobPanel").css("display", "");
        $("#ExistingJobPanel").css("display", "none");
    });
    $("#addCannedJobBtn").click(function(){
        $("#showaddjobPanel").css("display", "none");
        $("#ExistingJobPanel").css("display", "");
        $(".chosenWO").chosen({
            no_results_text: "Oops, nothing found!" 
        });
    });
    
    function guid() {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
        }
        return s4() + s4() + s4() + s4() + s4();
    }
    
    function isNumber(evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        return true;
    }
    
    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode != 46 && charCode > 31 
            && (charCode < 48 || charCode > 57)){
            return false;
        }
        return true;
    }

    var jsonobject = '';
    function jsonCreation(Divnum){
        //alert('insidejsoncreation');
        var line_items = '', job_items = '';
        jsonobject = '[';
        var PromoCode = '', CustomerBoatStatus = '';StoreLocation = '';miscDesc1 = '', miscDesc2 = '', miscDesc3 = '', miscChrge1 = '', miscChrge2 = '', miscChrge3 = '', Comments = '', ShippingCharge = '',  CaseId = '', discountAmtOnJob = ''; discountAmtOnWO = ''; isApprovedStatus = '', JobName = '', workrequested = '',WorkTypeId = '', TypeWorkId = '',Line_item_count = '',Labour_Quantity = '', Labour_Price = '',Shop_Price = '',Customer_Pay = '', ExistingJobId = '',PartQuantity = '',PartPrice = '',Contact_id = '', boatId = '', wODriveId = '',CreatedDateId ='', wOHoursId = '' , PartId = '', PartName = '', WoSalesTax = '0.0', WoStatus = '';
        var count = 0; 
        var TechId = ''; 
        if(existingCaseId != '') {
            CaseId = existingCaseId;
        }
        Contact_id = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkid').value;
        boatId = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkid').value;
        if(document.getElementById('wODriveId').value != ''){
            wODriveId = document.getElementById('wODriveId').value;
        }
        else{
            wODriveId = "null";
        }
        if(document.getElementById('CreatedDateId').value != '') {
            //alert('insidecreateddate');
            //alert(document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:CreatedDateId').value);
            CreatedDateId = document.getElementById('CreatedDateId').value;
        }
        else{
            CreatedDateId = "null";
        }
        if(document.getElementById('wOHoursId').value != ''){
            wOHoursId = document.getElementById('wOHoursId').value;
        }
        else{
            wOHoursId = "null";
        }
        if(document.getElementById("discountOnWO").value != '') {
            discountAmtOnWO = document.getElementById("discountOnWO").value;
        }else {
            discountAmtOnWO = "null";
        }
        var Statuslist = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WoStatus');
        if(Statuslist.options[Statuslist.selectedIndex].value != '') {
            WoStatus = Statuslist.options[Statuslist.selectedIndex].value;
        }
        else{
            //document.getElementById("woerrSnap").innerHTML = "Please Select Status";
            //$("#woerrorDiv").slideDown();
            //$("#woerrorDiv").delay(4000).slideUp();
            alert("Please Select Status.");
            return false;
        }
        
        if(StoreLocationRequired == true) {
            var StrLocationlist = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation'); 
            if(StrLocationlist.options[StrLocationlist.selectedIndex].value != '') {
                StoreLocation = StrLocationlist.options[StrLocationlist.selectedIndex].value;
            }
            else{
                alert("Please Select Store Location.");
                return false; 
            }    
        } else {
            var StrLocationlist = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation'); 
            if(StrLocationlist.options[StrLocationlist.selectedIndex].value != '') {
                StoreLocation = StrLocationlist.options[StrLocationlist.selectedIndex].value;
            }
        }
        if(document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WoCBS").value != '') {
            CustomerBoatStatus = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WoCBS").value;
        }else {
            CustomerBoatStatus = "null";
        }
        
        if(document.getElementById("woPromocode").value != '0') {
            PromoCode = document.getElementById("woPromocode").value;
        }else {
            PromoCode = "null";
        }
        
        
        var CustComments = '';
        
        WoSalesTax = document.getElementById('WoSalesTax').value;
        job_items = '';
        for(var i=1;i<=Divnum;i++){
            CustComments = '';
            if(document.getElementById('WojobId'+i) != null) {
                //console.log('sssssss: '+i);
                ExistingJobId = document.getElementById('WojobId'+i).value;
                if(document.getElementById('isApprovedJob'+i).checked == true){
                    isApprovedStatus = "1";
                }else {
                    isApprovedStatus = "0";
                }
                if(document.getElementById('shippingId'+i).value != ''){        
                    ShippingCharge = document.getElementById('shippingId'+i).value;     
                } else {
                    ShippingCharge = '0.00'; 
                }
                
                if(document.getElementById('miscCharge1'+i).value != ''){        
                    miscChrge1 = document.getElementById('miscCharge1'+i).value;     
                } else {
                    miscChrge1 = '0.00';
                }
                if(document.getElementById('miscCharge2'+i).value != ''){        
                    miscChrge2 = document.getElementById('miscCharge2'+i).value;     
                } else {
                    miscChrge2 = '0.00';
                }
                if(document.getElementById('miscCharge3'+i).value != ''){        
                    miscChrge3 = document.getElementById('miscCharge3'+i).value;     
                } else {
                    miscChrge3 = '0.00';
                }
                //miscDesc1
                if(document.getElementById('miscDesc1'+i).value != ''){        
                    miscDesc1 = document.getElementById('miscDesc1'+i).value;     
                } else {
                    miscDesc1 = '---';
                }
                if(document.getElementById('miscDesc2'+i).value != ''){        
                    miscDesc2 = document.getElementById('miscDesc2'+i).value;     
                } else {
                    miscDesc2 = '---';
                }
                if(document.getElementById('miscDesc3'+i).value != ''){        
                    miscDesc3 = document.getElementById('miscDesc3'+i).value;     
                } else {
                    miscDesc3 = '---';
                }
                
                if(document.getElementById('discountOnJob'+i).value != ''){
                    discountAmtOnJob = document.getElementById('discountOnJob'+i).value;
                } else {
                    discountAmtOnJob = '0.00';  
                }
                if(document.getElementById('WoExistingjobName'+i).value != ''){
                    JobName = document.getElementById('WoExistingjobName'+i).value;
                }
                else{
                    document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please fill Job Name</li>';
                    return false;
                }
                
                if(document.getElementById('cmnt'+i).value != ''){
                    Comments = document.getElementById('cmnt'+i).value;
                } else {
                    Comments = '';
                }
                
                if(document.getElementById('Custcmnt'+i).value != ''){
                    CustComments = document.getElementById('Custcmnt'+i).value;
                } else {
                    CustComments = '';
                }
                
                if(document.getElementById('jbTechId'+i).value != '' && document.getElementById('jbTechId'+i).value != '0'){
                    TechId = document.getElementById('jbTechId'+i).value;
                } else {
                    TechId = '';
                }
                
                
                
                if(document.getElementById('LabourQuantityDiv'+i).value != ''){
                    document.getElementById('error-div'+i).innerHTML = '';
                    Labour_Quantity = document.getElementById('LabourQuantityDiv'+i).value;
                }
                else{
                    document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please fill Labor Quantity</li>';
                    return false; 
                }
                var taxBool = '0';
                if(document.getElementById('taxBool'+i) != null){
                    
                    taxBool = document.getElementById('taxBool'+i).value;
                }
                
                if(document.getElementById('WorkTypeSelect'+i).value != ''){
                    var wId = '#WorkTypeSelect'+i;
                    WorkTypeId = $(wId+" option:selected").text();
                }
                else{
                    document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please Select Work Type</li>';
                    return false;
                }
                if(i>1){
                    job_items += ',';
                }
                job_items += '{'+'"ExistingJobId"'+':'+'"'+ExistingJobId+'"'+','+'"Id"'+':'+'"'+guid()+'"'+','+'"JobName"'+':'+'"'+JobName+'"'+','+'"WorkRequested"'+':'+'"'+workrequested+'"'+','+'"WorkType"'+':'+'"'+WorkTypeId+'"'+','+'"Type"'+':'+'"'+TypeWorkId+'"'+','+'"Line_item_count"'+':'+'"'+Line_item_count+'"'+','+'"line_items"'+':'+'['+line_items+']'+','+'"Labour_Quantity"'+':'+'"'+Labour_Quantity+'"'+','+'"Labour_Price"'+':'+'"'+Labour_Price+'"'+','+'"Shop_Price"'+':'+'"'+Shop_Price+'"'+','+'"ApprovedByCustomer"'+':'+'"'+isApprovedStatus+'"'+','+'"DiscountOnJob"'+':'+'"'+discountAmtOnJob+'"'+','+'"ShippingCharge"'+':'+'"'+ShippingCharge+'"'+','+'"Comments"'+':'+'"'+Comments+'"'+','+'"CustComments"'+':'+'"'+CustComments+'"'+','+'"MiscCharge"'+':'+'"'+miscChrge1+'"'+','+'"MiscCharge2"'+':'+'"'+miscChrge2+'"'+','+'"MiscCharge3"'+':'+'"'+miscChrge3+'"'+','+'"MiscDesc1"'+':'+'"'+miscDesc1+'"'+','+'"MiscDesc2"'+':'+'"'+miscDesc2+'"'+','+'"MiscDesc3"'+':'+'"'+miscDesc3+'"'+','+'"taxBool"'+':'+'"'+taxBool+'"'+','+'"TechId"'+':'+'"'+TechId+'"'+'}';  
            }
            else{ 
                ExistingJobId = '';
                if(document.getElementById('newdiv'+i) != null){
                    var uniqueId = guid();
                    if(document.getElementById('jobNameId'+i).innerHTML != ''){
                        JobName = document.getElementById('jobNameId'+i).innerHTML;
                    }else {
                        document.getElementById("woerrSnap").innerHTML = "Please fill Job Name";
                        $("#woerrorDiv").slideDown();
                        $("#woerrorDiv").delay(4000).slideUp();
                        return;
                    }
                    //if(document.getElementById('miscCharge'+i).value != ''){        
                    // miscChrge = document.getElementById('miscCharge'+i).value;     
                    //} else {
                    // miscChrge = '0.00';
                    // }
                    
                    
                    
                    if(document.getElementById('miscCharge1'+i).value != ''){        
                        miscChrge1 = document.getElementById('miscCharge1'+i).value;     
                    } else {
                        miscChrge1 = '0.00';  
                    }
                    if(document.getElementById('miscCharge2'+i).value != ''){        
                        miscChrge2 = document.getElementById('miscCharge2'+i).value;     
                    } else {
                        miscChrge2 = '0.00';
                    }
                    if(document.getElementById('miscCharge3'+i).value != ''){        
                        miscChrge3 = document.getElementById('miscCharge3'+i).value;     
                    } else {
                        miscChrge3 = '0.00';
                    }
                    
                    
                    if(document.getElementById('miscDesc1'+i).value != ''){        
                        miscDesc1 = document.getElementById('miscDesc1'+i).value;
                        console.log("miscDesc1>>>>>: "+miscDesc1);
                        debugger;     
                    } else {
                        miscDesc1 = '---'; 
                    }
                    if(document.getElementById('miscDesc2'+i).value != ''){        
                        miscDesc2 = document.getElementById('miscDesc2'+i).value;     
                    } else {
                        miscDesc2 = '---';
                    }
                    if(document.getElementById('miscDesc3'+i).value != ''){        
                        miscDesc3 = document.getElementById('miscDesc3'+i).value;     
                    } else {
                        miscDesc3 = '---';
                    }
                    
                    var taxBool = '0';
                    if(document.getElementById('taxBool'+i) != null){
                        
                        taxBool = document.getElementById('taxBool'+i).value;
                    }
                    
                    
                    if(document.getElementById('cmnt'+i).value != ''){
                        Comments = document.getElementById('cmnt'+i).value;
                    }  else {
                        Comments = '';
                    }
                    
                    if(document.getElementById('Custcmnt'+i).value != ''){
                        CustComments = document.getElementById('Custcmnt'+i).value;
                    } else {
                        CustComments = '';
                    }
                    if(document.getElementById('jbTechId'+i).value != '' && document.getElementById('jbTechId'+i).value != '0'){
	                    TechId = document.getElementById('jbTechId'+i).value;
	                } else {
	                    TechId = '';
	                }
                    if(document.getElementById('newjobWorkTypeId'+i).value != ''){
                        var wId = '#newjobWorkTypeId'+i;
                        WorkTypeId = $(wId+" option:selected").text();
                    }
                    else{
                        document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please Select Work Type</li>';
                        return false;
                    }
                    if(document.getElementById('newjobTypeWorkId'+i).value != ''){
                        TypeWorkId = document.getElementById('newjobTypeWorkId'+i).value;
                    }
                    if(document.getElementById('theValueDiv'+i).value != ''){
                        line_items = '';
                        Line_item_count = document.getElementById('theValueDiv'+i).value;
                        for(var j=1; j<=Line_item_count; j++){
                            //var Partlist = document.getElementById('selectpartlistDiv'+i+j);
                            PartId = document.getElementById('prtId'+i+j).innerHTML;
                            //PartName = $("#selectpartlistDiv"+i+j+" option:selected").text();
                            PartName = document.getElementById('selectpartlistDiv'+i+j).value;
                            //if(PartId != 'Choose...'){ 
                            if(PartId != ''){
                                document.getElementById('error-div'+i).innerHTML = '';
                                if(document.getElementById('PartsQuantityDiv'+i+j).value != ''){
                                    document.getElementById('error-div'+i).innerHTML = '';
                                    PartQuantity = document.getElementById('PartsQuantityDiv'+i+j).value;
                                }
                                else{
                                    document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please fill Parts Quantity</li>';
                                    return false;
                                }
                                
                                if(document.getElementById('PartPriceDiv'+i+j).innerHTML != ''){
                                    document.getElementById('error-div'+i).innerHTML = '';
                                    PartPrice = document.getElementById('PartPriceDiv'+i+j).innerHTML;
                                }
                                else{
                                    document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please fill Part Price</li>';
                                    return false;
                                }
                                if(j>1){
                                    line_items += ',';
                                }
                                line_items += '{'+'"Id"'+':'+'"'+uniqueId+'"'+','+'"PartId"'+':'+'"'+PartId+'"'+','+'"PartName"'+':'+'"'+PartName+'"'+','+'"PartQuantity"'+':'+'"'+PartQuantity+'"'+','+'"PartPrice"'+':'+'"'+PartPrice+'"'+'}';
                            }
                            else{
                                document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please Select Part</li>';
                                return false;
                            }
                        }
                        
                    }
                    if(document.getElementById('LabourQuantityDiv'+i).value != ''){
                        document.getElementById('error-div'+i).innerHTML = '';
                        Labour_Quantity = document.getElementById('LabourQuantityDiv'+i).value;
                    }
                    else{
                        document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please fill Labor Quantity</li>';
                        return false;
                    }
                    if(document.getElementById('LabourPriceDiv'+i).value != ''){
                        document.getElementById('error-div'+i).innerHTML = '';
                        Labour_Price = document.getElementById('LabourPriceDiv'+i).value;
                    }
                    else{
                        document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please fill Labor Price</li>';
                        return false;
                    }
                    if(document.getElementById('ShopSupliesTotalPriceDiv'+i).innerHTML != ''){
                        document.getElementById('error-div'+i).innerHTML = '';
                        Shop_Price = document.getElementById('ShopSupliesTotalPriceDiv'+i).innerHTML;
                    }
                    else{
                        document.getElementById('error-div'+i).innerHTML = '<li><i class="fa fa-times-circle"></i>Please fill Shop Supplies</li>';
                        return false; 
                    } 
                    /*if(document.getElementById('CustomerPay'+i).value != ''){
                            Customer_Pay = document.getElementById('CustomerPay'+i).value;
                        }*/
                        if(document.getElementById('isApprovedJob'+i).checked == true){
                            isApprovedStatus = "1";
                        }else {
                            isApprovedStatus = "0";
                        }
                        if(document.getElementById('discountOnJob'+i).value != ''){
                            discountAmtOnJob = document.getElementById('discountOnJob'+i).value;
                        }  else {
                            discountAmtOnJob = '0.00';  
                        }
                        if(document.getElementById('shippingId'+i).value != ''){
                            ShippingCharge = document.getElementById('shippingId'+i).value;
                        } else {
                            ShippingCharge = '0.00';
                        }
                        
                        if(i>1){   
                            job_items += ',';
                        }
                        job_items += '{'+'"ExistingJobId"'+':'+'"'+ExistingJobId+'"'+','+'"Id"'+':'+'"'+uniqueId+'"'+','+'"JobName"'+':'+'"'+JobName+'"'+','+'"WorkRequested"'+':'+'"'+workrequested+'"'+','+'"WorkType"'+':'+'"'+WorkTypeId+'"'+','+'"Type"'+':'+'"'+TypeWorkId+'"'+','+'"Line_item_count"'+':'+'"'+Line_item_count+'"'+','+'"line_items"'+':'+'['+line_items+']'+','+'"Labour_Quantity"'+':'+'"'+Labour_Quantity+'"'+','+'"Labour_Price"'+':'+'"'+Labour_Price+'"'+','+'"Shop_Price"'+':'+'"'+Shop_Price+'"'+','+'"ApprovedByCustomer"'+':'+'"'+isApprovedStatus+'"'+','+'"DiscountOnJob"'+':'+'"'+discountAmtOnJob+'"'+','+'"ShippingCharge"'+':'+'"'+ShippingCharge+'"'+','+'"Comments"'+':'+'"'+Comments+'"'+','+'"CustComments"'+':'+'"'+CustComments+'"'+','+'"MiscCharge"'+':'+'"'+miscChrge1+'"'+','+'"MiscCharge2"'+':'+'"'+miscChrge2+'"'+','+'"MiscCharge3"'+':'+'"'+miscChrge3+'"'+','+'"MiscDesc1"'+':'+'"'+miscDesc1+'"'+','+'"MiscDesc2"'+':'+'"'+miscDesc2+'"'+','+'"MiscDesc3"'+':'+'"'+miscDesc3+'"'+','+'"taxBool"'+':'+'"'+taxBool+'"'+','+'"TechId"'+':'+'"'+TechId+'"'+'}';   //   
                    }  
                }
                
            }
            
            //PromoCode
            jsonobject += '{'+'"PromoCode"'+':'+'"'+PromoCode+'",'+'"CustomerBoatStatus"'+':'+'"'+CustomerBoatStatus+'",'+'"StoreLocation"'+':'+'"'+StoreLocation+'",'+'"WOCreatedDate"'+':'+'"'+CreatedDateId+'",'+'"CaseId"'+':'+'"'+CaseId+'"'+','+'"Contact_Id"'+':'+'"'+Contact_id+'"'+','+'"boatId"'+':'+'"'+boatId+'"'+','+'"Drive"'+':'+'"'+wODriveId+'"'+','+'"Hours"'+':'+'"'+wOHoursId+'"'+','+'"Status"'+':'+'"'+WoStatus+'"'+','+'"SalesTax"'+':'+'"'+WoSalesTax+'"'+','+'"DiscountOnWO"'+':'+'"'+discountAmtOnWO+'"'+','+'"Job_item"'+':'+'['+job_items+']'+'}';
            
            jsonobject += ']'; 
            return "success";
        }  
 
    $("#createwoorder").click(function(){
        var objCaseStatus = document.getElementById("caseHiddenType").value;
        var boatIdd = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkid').value;
        BOATBUILDING.WorkOrderControllerClone.getBoat(boatIdd, function(result, event) {
            console.log(result);
            if(result != null && result.BOATBUILDING__Boat_HIN_No__c == undefined) {
                $('.popup').removeClass('active');
                alert("Please update HIN number on selected boat.");
                return;
            } else {
                
                if(objCaseStatus != "Closed" && objCaseStatus != "closed") {
                    var Divnum = document.getElementById("DivValue").value ;
                    //console.log(Divnum);
                    if(document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkid').value != '000000000000000' &&  document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2').value != ''&& document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkid').value != '000000000000000' && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId').value != ''){
                        if(Divnum != '0'){
                        }
                        //alert('DINUM'+Divnum);
                        //alert('insidecreateorderafterdivnum');
                        var result = jsonCreation(Divnum); 
                        // alert(result);
                        console.log(jsonobject); 
                        debugger;
                        if(result=="success") {
                            $('.popup').addClass('active');
                            BOATBUILDING.WorkOrderControllerClone.createWorkOrder(jsonobject, function(result, event) {
                                if(event.status){
                                    console.log(result);
                                    if(result == 'Success') {
                                        console.log('Done');
                                        var woid = $("#WONameEdit").val();
                                        if(woid != null && woid != "Will show in classic") {
                                            window.top.location = "/apex/BOATBUILDING__ServicePage?type=WO&WOId="+woid;
                                        } else {
                                            window.top.location = "/apex/BOATBUILDING__ServicePage?type=WO";
                                        }    
                                    }
                                    else{
                                        $('.popup').removeClass('active');
                                        alert("Something went wrong. Please try again.");
                                    }  
                                }
                            });
                        }
                        else{ 
                            
                            return false;
                        }
                    }
                    else{
                    alert("Please select Customer And Boat");
//                         document.getElementById("woerrSnap").innerHTML = ;
//                         $("#woerrorDiv").slideDown();
//                         $("#woerrorDiv").delay(4000).slideUp();
                        return false;
                    }
                } else { 
                    alert("This work order has been closed.\nThank you!!"); 
                }
                
            }
        });
        
    }); 
    
    function removeFromExistingWO(divId, JobId) {
        //console.log(JobId); 
        var woId = document.getElementById("WONameEdit").value;
        
        if(confirm('Are you sure to remove this job?')) {
            BOATBUILDING.WorkOrderControllerClone.removeFromExistingWO(JobId, function(result, event) {
                if(event.status) {
                    if(result != null) {
                        //console.log(result);
                        if(result == "SUCCESS") {
                            
                            var objCaseStatus = document.getElementById("caseHiddenType").value;
                            if(objCaseStatus != "Closed" && objCaseStatus != "closed") {
                                var Divnum = document.getElementById("DivValue").value ;
                                //console.log(Divnum);
                                if(document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkid').value != '000000000000000' &&  document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2').value != ''&& document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkid').value != '000000000000000' && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId').value != ''){
                                    if(Divnum != '0'){
                                    }
                                    var result = jsonCreation(Divnum);
                                    if(result=="success") {
                                        $('.popup').addClass('active');
                                        BOATBUILDING.WorkOrderControllerClone.createWorkOrder(jsonobject, function(result, event) {
                                            if(event.status){
                                                if(result == 'Success') {
                                                    console.log('Done');
                                                    var woid = $("#WONameEdit").val();
                                                    window.top.location = "/apex/BOATBUILDING__ServicePage?type=WO&WOId="+woid;    
                                                }
                                                else{
                                                    $('.popup').removeClass('active');
                                                    alert("Something went wrong. Please try again.");
                                                }  
                                            }
                                        });
                                    }
                                    else{ 
                                        
                                        return false;
                                    }
                                }
                                else{
                                    document.getElementById("woerrSnap").innerHTML = "Please select Customer And Boat";
                                    $("#woerrorDiv").slideDown();
                                    $("#woerrorDiv").delay(4000).slideUp();
                                    return false;
                                }
                            } else {
                                alert("This work order has been closed.\nThank you!!"); 
                            }
                            
                        }
                    }
                }
            });
        }
    }
    
    function addJobFromEditable() {
        var sel = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:sl1');
        if(!existing) {
            selectedPartNumber1 = sel.options[sel.selectedIndex].value;
        }
        var Divi = document.getElementById('DivValue');
        var Divnum = (document.getElementById("DivValue").value -1)+ 2;
        Divi.value = Divnum;
        
        var theValue = "theValueDiv"+Divnum;
        var WoExistingjobId = "WojobId"+Divnum;
        var WoExistingjobName = "WoExistingjobName"+Divnum;
        var WoExistingWr = "WoExistingWr"+Divnum;
        var WoExistingWt = "WoExistingWt"+Divnum;
        var partdiv='';
        var shippingChargeId = "shippingId"+Divnum;
        //if(document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2_lkid').value != '000000000000000' &&  document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:conWrkId2').value != ''&& document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId_lkid').value != '000000000000000' && document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:boatLookId').value != ''){
            if(selectedPartNumber1 != ''){
                //$("#createwoorder").css("display","");
                $("#ShowjobList").css("display", "");
                var AddPart = "AddPartDiv"+Divnum;
                var hiddentd = "hiddentdDiv"+Divnum;
                var ShopSuppliesPrice = "ShopSuppliesPriceDiv"+Divnum;
                var ShopSupliesTotalPrice = "ShopSupliesTotalPriceDiv"+Divnum;
                var TotalOfJobDiv = "TotalOfJobDiv"+Divnum;
                var WorkTypeSelect = "WorkTypeSelect"+Divnum;
                var LabourQuantity = "LabourQuantityDiv"+Divnum;
                var LabourPrice = "LabourPriceDiv"+Divnum;
                var LabourTotalPrice = "LabourTotalPriceDiv"+Divnum;
                var TechId = '';
                var TechName = '';
                var  WOComments ='', Wojobname = '',Woworkrequested = '', Woworktype = '',WoLabourQuantity = '',WoLabourPrice = 0.0, WoLabourTotalPrice = 0.0, WoshopsuppliesPrice = 0.0, wojobCustomerPay = 0.0 , wojobTotal = 0.0 ,WojobId = '' ;
                var WoDiscount = 0.00 , WoShippingCharge = 0.00, woJobTotalWDis = 0.00;
                var BTN_lbl = 'Add Technician';
                if(lstjob.length > 0) {
                    if(lstjob[0].Id != undefined) {
                        WojobId = lstjob[0].Id;
                    } 
                    if(lstjob[0].BOATBUILDING__Technician__c != undefined) {
                        TechId = lstjob[0].BOATBUILDING__Technician__c;
                        TechName = lstjob[0].BOATBUILDING__Technician__r.Name;
                        BTN_lbl = 'Update Technician';
                    }
                    console.log('>>>>>>>WojobId: '+WojobId);
                    console.log('>>>>>>>TechId: '+TechId);
                    console.log('>>>>>>>TechName: '+TechName);
                    
                    if(lstjob[0].BOATBUILDING__Job_Name__c != undefined) {
                        Wojobname = lstjob[0].BOATBUILDING__Job_Name__c;
                    }
                    if(lstjob[0].BOATBUILDING__Work_Requested__c != undefined) {
                        Woworkrequested = lstjob[0].BOATBUILDING__Work_Requested__c;
                    }
                    if(lstjob[0].BOATBUILDING__Work_Type__c != undefined) {
                        Woworktype = lstjob[0].BOATBUILDING__Work_Type__c;
                    }
                    if(lstjob[0].BOATBUILDING__No_of_Labors__c != undefined) {
                        WoLabourQuantity = lstjob[0].BOATBUILDING__No_of_Labors__c;
                    }
                    if(lstjob[0].BOATBUILDING__Price_per_Labor__c != undefined) {
                        WoLabourPrice = lstjob[0].BOATBUILDING__Price_per_Labor__c;
                    }
                    if(lstjob[0].BOATBUILDING__Total_Cost_Labor__c != undefined) {
                        WoLabourTotalPrice = lstjob[0].BOATBUILDING__Total_Cost_Labor__c;
                    }
                    if(lstjob[0].BOATBUILDING__Shop_Supplies_Total__c != undefined) {
                        WoshopsuppliesPrice = lstjob[0].BOATBUILDING__Shop_Supplies_Total__c;
                    }
                    if(lstjob[0].BOATBUILDING__Shipping_Charge__c != undefined) {
                        WoShippingCharge = parseFloat(lstjob[0].BOATBUILDING__Shipping_Charge__c);
                    }
                    
                    if(lstjob[0].BOATBUILDING__Comments__c != undefined) { 
                        WOComments = lstjob[0].BOATBUILDING__Comments__c;
                    }
                    if(lstjob[0].BOATBUILDING__Discount__c != undefined) {
                        WoDiscount = parseFloat(lstjob[0].BOATBUILDING__Discount__c);
                    }
                    
                    var totalPrtAmt = 0.00;
                    if(lstjob[0].BOATBUILDING__Total_Amount_on_Parts_del__c != undefined) {
                        totalPrtAmt = parseFloat(lstjob[0].BOATBUILDING__Total_Amount_on_Parts_del__c);  
                    }
                    
                    var misccc = 0.00
                    if(lstjob[0].BOATBUILDING__Misc_Charge__c != undefined) {
                        misccc = parseFloat(lstjob[0].BOATBUILDING__Misc_Charge__c);
                    }
                    var misccc2 = 0.00
                    if(lstjob[0].BOATBUILDING__Misc_Charge_2__c != undefined) {
                        misccc2 = parseFloat(lstjob[0].BOATBUILDING__Misc_Charge_2__c);
                    }
                    var misccc3 = 0.00
                    if(lstjob[0].BOATBUILDING__Misc_Charge_3__c != undefined) {
                        misccc3 = parseFloat(lstjob[0].BOATBUILDING__Misc_Charge_3__c);
                    }
                    var miscccd = '';
                    if(lstjob[0].BOATBUILDING__Misc_Description_1__c != undefined) {
                        miscccd = lstjob[0].BOATBUILDING__Misc_Description_1__c;
                    } 
                    var miscccd2 = '';
                    if(lstjob[0].BOATBUILDING__Misc_Description_2__c != undefined) {
                        miscccd2 = lstjob[0].BOATBUILDING__Misc_Description_2__c;
                    }
                    var miscccd3 = '';
                    if(lstjob[0].BOATBUILDING__Misc_Description_3__c != undefined) {
                        miscccd3 = lstjob[0].BOATBUILDING__Misc_Description_3__c;
                    }
                    
                    var taxableBool = '0';
                    if(lstjob[0].BOATBUILDING__Taxable__c == true) {
                        console.log('Bool Check: ');
                        console.log(lstjob[0].BOATBUILDING__Taxable__c);
                        taxableBool = '1';
                    }
                    
                    var custComm = '';
                    if(lstjob[0].BOATBUILDING__Customer_Comments__c != undefined) {
                        custComm = lstjob[0].BOATBUILDING__Customer_Comments__c;
                    }
                    // + parseFloat(WoShippingCharge)
                    var totalMisc = misccc + misccc2 + misccc3;
                    woJobTotalWDis = (parseFloat(WoLabourTotalPrice) + parseFloat(WoshopsuppliesPrice) + parseFloat(totalPrtAmt));
                    wojobTotal = (parseFloat(WoLabourTotalPrice) + parseFloat(WoshopsuppliesPrice) + parseFloat(totalMisc) + parseFloat(totalPrtAmt) + parseFloat(WoShippingCharge)) - parseFloat(WoDiscount);
                }
                if(taxableBool == '1') {
                    var newdiv ="<div class='slds-card'id='aaoo"+Divnum+"'><div style='color: #D8000C;' id='error-panel"+Divnum+"'> <input type='hidden' value='"+taxableBool+"' id='taxBool"+Divnum+"'/> <ul id='error-div"+Divnum+"'></ul></div><div style='float:right;line-height:0;'><a id='rmv"+Divnum+"' style='text-decoration:none;' onclick='removeFromExistingWO(\"aaoo"+Divnum+"\",\""+WojobId+"\")'><i class='fa fa-times fa-lg' aria-hidden='true'></i></a></div><div class='slds-grid slds-wrap slds-m-top--medium'><table class='slds-table slds-table--bordered'><thead><tr><th>Job</th><th>Work Requested</th><th >Type</th><th >Quantity</th><th class='slds-text-align--right'>Price</th><th class='slds-text-align--right'>Total</th><th class='slds-text-align--right'></th></tr></thead><tbody><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Taxable</td><td  class='slds-text-align--right'><label class='slds-checkbox'><input type='checkbox' name='Taxable' onchange='taxchange("+Divnum+")' id='taxableBoolView"+Divnum+"' checked='checked'/><span class='slds-checkbox--faux'></span></label></label></td></tr><tr><td colspan='5'><input id="+WoExistingjobId+" type='hidden' value="+WojobId+"></input><input class='slds-input' id="+WoExistingjobName+" type='text' value='"+Wojobname+"'></input></td><td><select id="+WorkTypeSelect+" onchange='change_LabourValues("+Divnum+"); calculate_totalofallJobDiv();' class='slds-select'><option value='0' selected='selected'>--None--</option></select></td><td  class='slds-text-align--right'><a id='addPWOJ"+Divnum+"' onclick='addPartForEditable("+Divnum+", \""+selectedPartNumber1+"\");' class='slds-button slds-button--brand'>Add Part</a></td></tr><tr><td colspan='7'><div id=existingjobdiv"+Divnum+"><input type='hidden' name='theValue' id='"+theValue+"' value='0' /></div></td></tr><tr><td>&nbsp;</td><td data-label='Labor'>Labor</td><td>&nbsp;</td><td data-label='Quantity'><input id='"+LabourQuantity+"' onkeypress='return isNumberKey(event)' class='slds-input' type='text' onkeyup='calculate_LabourPrice_Div("+Divnum+"); calculate_totalofallJobDiv();' value='"+WoLabourQuantity+"'/></td><td data-label='Price' class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><input id='"+LabourPrice+"'  class='slds-input' type='text' disabled='disabled' value="+WoLabourPrice+"></td><td data-label='Total' class='slds-text-align--right' ><i class='fa fa-usd' aria-hidden='true' ></i><span id="+LabourTotalPrice+">"+WoLabourTotalPrice+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td data-label='Shop Supplies'>Shop Supplies</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Total' class='slds-text-align--right'></td><td data-label='TotalShop' class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><span id='ShopSupliesTotalPriceDiv"+Divnum+"'>"+WoshopsuppliesPrice+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Prospecting' class='slds-text-align--right'>Total:<td class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><span id='TotalOfJobDiv"+Divnum+"'>"+parseFloat(woJobTotalWDis).toFixed(2)+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Discount ($)</td><td class='slds-text-align--right'><input value='"+parseFloat(WoDiscount).toFixed(2)+"' onkeypress='return isNumberKey(event)' onKeyUp='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Discount' id='discountOnJob"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Shipping Charge ($)</td><td class='slds-text-align--right'><input value='"+parseFloat(WoShippingCharge).toFixed(2)+"' onkeypress='return isNumberKey(event)' onKeyUp='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Shipping Charge' id='"+shippingChargeId+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>Misc Description 1</td><td colspan='2'><input type='text' value='"+miscccd+"' class='slds-input' id='miscDesc1"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 1 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' value='"+misccc+"' class='slds-input' name='Misc Charge' id='miscCharge1"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 2</td><td colspan='2'><input value='"+miscccd2+"' type='text' class='slds-input'  id='miscDesc2"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 2 ($)</td><td class='slds-text-align--right'><input value='"+misccc2+"'  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge2"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 3</td><td colspan='2'><input value='"+miscccd3+"' type='text' class='slds-input' id='miscDesc3"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 3 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' value='"+misccc3+"' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge3"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Misc Charge ($)</td><td class='slds-text-align--right'><input disabled='disabled' value='"+parseFloat(totalMisc).toFixed(2)+"'onkeypress='return isNumberKey(event)' onchange='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Misc Charge' id='miscChargeT"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Total Amount</td><td class='slds-text-align--right' id='gTotalAmt"+Divnum+"'>"+(wojobTotal).toFixed(2)+"</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Approved By Customer</td><td class='slds-text-align--right'><label class='slds-checkbox'><input  type='checkbox' name='Is Approved' id='isApprovedJob"+Divnum+"' value='Approved By Customer'><span class='slds-checkbox--faux'></span></label></td><td>&nbsp;</td></tr></tbody></table></div><div style='padding: 5px;'><span style='position: absolute;'>Comments:</span><input type='hidden' value='300' id='hcmnt"+Divnum+"'> <input type='hidden'  id='cmnt"+Divnum+"' value='"+WOComments+"'/><span style='position: relative; left:24%;'><a onclick='addCommentToJob(\""+Divnum+"\", \"SER\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCommentFromJob(\""+Divnum+"\", \"SER\");'>View</a></span> </div><div style='padding: 5px;'><span style='position: absolute;'>Customer Comments:</span> <input type='hidden' value='"+custComm+"'  id='Custcmnt"+Divnum+"' /><span style='position: relative; left:24%;'><a onclick='addCustCommentToJob(\""+Divnum+"\", \"CUST\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCustCommentFromJob(\""+Divnum+"\", \"CUST\");'>View</a></span> </div> <div style='padding: 5px;'> <span>Technician:&nbsp;<input type='hidden' id='jbTechId"+Divnum+"' value='"+TechId+"'/><span id='techName"+Divnum+"'>"+TechName+"</span>&nbsp;<a onclick='addTechnician(\""+Divnum+"\")' style='position: absolute; left:19.5%;'> "+BTN_lbl+" </a></span> </div></div>";
                } else {
                    var newdiv ="<div class='slds-card'id='aaoo"+Divnum+"'><div style='color: #D8000C;' id='error-panel"+Divnum+"'> <input type='hidden' value='"+taxableBool+"' id='taxBool"+Divnum+"'/> <ul id='error-div"+Divnum+"'></ul></div><div style='float:right;line-height:0;'><a id='rmv"+Divnum+"' style='text-decoration:none;' onclick='removeFromExistingWO(\"aaoo"+Divnum+"\",\""+WojobId+"\")'><i class='fa fa-times fa-lg' aria-hidden='true'></i></a></div><div class='slds-grid slds-wrap slds-m-top--medium'><table class='slds-table slds-table--bordered'><thead><tr><th>Job</th><th>Work Requested</th><th >Type</th><th >Quantity</th><th class='slds-text-align--right'>Price</th><th class='slds-text-align--right'>Total</th><th class='slds-text-align--right'></th></tr></thead><tbody><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Taxable</td><td  class='slds-text-align--right'><label class='slds-checkbox'><input type='checkbox' name='Taxable' onchange='taxchange("+Divnum+")' id='taxableBoolView"+Divnum+"'/><span class='slds-checkbox--faux'></span></label></label></td></tr><tr><td colspan='5'><input id="+WoExistingjobId+" type='hidden' value="+WojobId+"></input><input class='slds-input' id="+WoExistingjobName+" type='text' value='"+Wojobname+"'></input></td><td><select id="+WorkTypeSelect+" onchange='change_LabourValues("+Divnum+"); calculate_totalofallJobDiv();' class='slds-select'><option value='0' selected='selected'>--None--</option></select></td><td class='slds-text-align--right'><a id='addPWOJ"+Divnum+"' onclick='addPartForEditable("+Divnum+", \""+selectedPartNumber1+"\");' class='slds-button slds-button--brand'>Add Part</a></td></tr><tr><td colspan='7'><div id=existingjobdiv"+Divnum+"><input type='hidden' name='theValue' id='"+theValue+"' value='0' /></div></td></tr><tr><td>&nbsp;</td><td data-label='Labor'>Labor</td><td>&nbsp;</td><td data-label='Quantity'><input id='"+LabourQuantity+"' onkeypress='return isNumberKey(event)' class='slds-input' type='text' onkeyup='calculate_LabourPrice_Div("+Divnum+"); calculate_totalofallJobDiv();' value='"+WoLabourQuantity+"'/></td><td data-label='Price' class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><input id='"+LabourPrice+"'  class='slds-input' type='text' disabled='disabled' value="+WoLabourPrice+"></td><td data-label='Total' class='slds-text-align--right' ><i class='fa fa-usd' aria-hidden='true' ></i><span id="+LabourTotalPrice+">"+WoLabourTotalPrice+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td data-label='Shop Supplies'>Shop Supplies</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Total' class='slds-text-align--right'></td><td data-label='TotalShop' class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><span id='ShopSupliesTotalPriceDiv"+Divnum+"'>"+WoshopsuppliesPrice+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td data-label='Prospecting' class='slds-text-align--right'>Total:<td class='slds-text-align--right'><i class='fa fa-usd' aria-hidden='true'></i><span id='TotalOfJobDiv"+Divnum+"'>"+parseFloat(woJobTotalWDis).toFixed(2)+"</span></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Discount ($)</td><td class='slds-text-align--right'><input value='"+parseFloat(WoDiscount).toFixed(2)+"' onkeypress='return isNumberKey(event)' onKeyUp='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Discount' id='discountOnJob"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Shipping Charge ($)</td><td class='slds-text-align--right'><input value='"+parseFloat(WoShippingCharge).toFixed(2)+"' onkeypress='return isNumberKey(event)' onKeyUp='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Shipping Charge' id='"+shippingChargeId+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>Misc Description 1</td><td colspan='2'><input type='text' value='"+miscccd+"' class='slds-input' id='miscDesc1"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 1 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' value='"+misccc+"' class='slds-input' name='Misc Charge' id='miscCharge1"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 2</td><td colspan='2'><input value='"+miscccd2+"' type='text' class='slds-input'  id='miscDesc2"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 2 ($)</td><td class='slds-text-align--right'><input value='"+misccc2+"'  onkeypress='return isNumberKey(event)' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge2"+Divnum+"'/></td><td>&nbsp;</td></tr> <tr><td>&nbsp;</td><td>Misc Description 3</td><td colspan='2'><input value='"+miscccd3+"' type='text' class='slds-input' id='miscDesc3"+Divnum+"'/></td><td class='slds-text-align--right'>Misc Charge 3 ($)</td><td class='slds-text-align--right'><input  onkeypress='return isNumberKey(event)' value='"+misccc3+"' onKeyUp='calculatetotalMisc("+Divnum+");' class='slds-input' name='Misc Charge' id='miscCharge3"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Misc Charge ($)</td><td class='slds-text-align--right'><input disabled='disabled' value='"+parseFloat(totalMisc).toFixed(2)+"'onkeypress='return isNumberKey(event)' onchange='calDiscountedTotalAmt("+Divnum+");' class='slds-input' name='Misc Charge' id='miscChargeT"+Divnum+"'/></td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Total Amount</td><td class='slds-text-align--right' id='gTotalAmt"+Divnum+"'>"+(wojobTotal).toFixed(2)+"</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td class='slds-text-align--right'>Approved By Customer</td><td class='slds-text-align--right'><label class='slds-checkbox'><input  type='checkbox' name='Is Approved' id='isApprovedJob"+Divnum+"' value='Approved By Customer'><span class='slds-checkbox--faux'></span></label></td><td>&nbsp;</td></tr></tbody></table></div><div style='padding: 5px;'><span style='position: absolute;'>Comments:</span><input type='hidden' value='300' id='hcmnt"+Divnum+"'> <input type='hidden'  id='cmnt"+Divnum+"' value='"+WOComments+"'/><span style='position: relative; left:24%;'><a onclick='addCommentToJob(\""+Divnum+"\", \"SER\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCommentFromJob(\""+Divnum+"\", \"SER\");'>View</a></span> </div><div style='padding: 5px;'><span style='position: absolute;'>Customer Comments:</span> <input type='hidden' value='"+custComm+"'  id='Custcmnt"+Divnum+"' /><span style='position: relative; left:24%;'><a onclick='addCustCommentToJob(\""+Divnum+"\", \"CUST\");'>Add</a>&nbsp;|&nbsp;<a onclick='viewCustCommentFromJob(\""+Divnum+"\", \"CUST\");'>View</a></span> </div> <div style='padding: 5px;'> <span>Technician:&nbsp;<input type='hidden' id='jbTechId"+Divnum+"' value='"+TechId+"'/><span id='techName"+Divnum+"'>"+TechName+"</span>&nbsp;<a onclick='addTechnician(\""+Divnum+"\")' style='position: absolute; left:19.5%;'> "+BTN_lbl+" </a></span> </div></div>";
                }
                
                if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r != undefined) {
                    var totalOfAll = 0.00;
                    for(var i=0; i<lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r.length; i++){
                        var JLIId = '', WoPartnumber = '', WoPartQuantity = '', WoPartFullName = '', WoPartname = '', WoPartPrice = 0.0, WoPartTotalPrice = 0.0;
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].Id != undefined){
                            JLIId = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].Id;
                        }
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Part_Number__c != undefined){
                            WoPartnumber = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Part_Number__c;
                        }
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Part_Name__c != undefined){
                            WoPartFullName = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Part_Name__c;
                            if(WoPartFullName.length > 5) {
                                WoPartname = WoPartFullName.substr(0, 5) + '...'; 
                            } else {
                                WoPartname = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Part_Name__c;
                            }
                        } 
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Quantity__c != undefined ){
                            WoPartQuantity = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Quantity__c;
                        }
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Price__c != undefined ){
                            WoPartPrice = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Price__c;
                        }
                        if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Total__c != undefined ){
                            WoPartTotalPrice = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r[i].BOATBUILDING__Total__c;
                            totalOfAll += parseFloat(WoPartTotalPrice);
                        }
                        objDivTotalPartAmt["DivNum"+Divnum] = totalOfAll; 
                        var prtIndex = i+1;
                        partdiv += '<table width="100%" border="0" cellspacing="2" cellpadding="2"><tr><td data-label="Part" width="43" >Parts</td><td width="65">'+WoPartnumber+'</td><td width="100"><span style=" display: none; position: absolute; top: -38%; left: -4%; border: 1px solid #a8b8c7; padding: 5px; border-radius: 1rem; background: #e1e6ee; z-index:999;" id="hiddnPrtName'+Divnum+''+prtIndex+'">'+WoPartFullName+'</span><a onmouseover="viewFullName(\''+Divnum+'\',\''+prtIndex+'\');" onmouseout="hideFullName(\''+Divnum+'\',\''+prtIndex+'\');">'+WoPartname+'</a></td><td width="106">&nbsp;</td><td data-label="Quantity" width="144"><input onkeyPress="return isNumber(event);" onKeyUp="changeQuanityFromEditableMode(this, \''+JLIId+'\', \''+Divnum+'\');" type="text" class="slds-input" value="'+WoPartQuantity+'" /></td><td class="slds-text-align--right" width="90"><i class="fa fa-usd" aria-hidden="true"></i>'+WoPartPrice+'</td><td width="60" style="text-align: right;" class="slds-text-align--right"><i class="fa fa-usd" aria-hidden="true"></i>'+WoPartTotalPrice+'</td><td style="text-align: right;"><a onclick="removePart(this, \''+JLIId+'\', \''+Divnum+'\');">Remove</a></td></tr></table>';                            
                    }
                    console.log(">>>>objDivTotalPartAmt: "+objDivTotalPartAmt);
                    console.log(objDivTotalPartAmt);
                }
                var id = "#WorkTypeSelect"+Divnum;
                $("#AddDivForJob").append(newdiv);
                console.log("id,Woworktype: "+id+Woworktype);
                bind_WorkType(id,Woworktype);
                var fd = document.getElementById("existingjobdiv"+Divnum);
                $(fd).append(partdiv);  
                if(lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r != undefined){
                    document.getElementById('theValueDiv'+Divnum).value = lstjob[0].BOATBUILDING__Work_Order_Job_Line_Items__r.length;
                }
                alllstjob = alllstjob.concat(lstjob);
                calculate_totalofallJobDiv();
                changecounter1(Divnum);
                //var Divhiddenvalue = document.getElementById("DivValue").value;
                //for(var i = 0; i < Divhiddenvalue; i++) {
                var objCaseStatus = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WoStatus").value;
                if(objCaseStatus == "Closed" || objCaseStatus == "closed") {
                    $("#addPWOJ"+Divnum).hide();
                    $("#rmv"+Divnum).hide();  
                    
                }
                //}
            }
            else{
                document.getElementById("woerrSnap").innerHTML = "Please Select Existing Job";
                $("#woerrorDiv").slideDown();
                $("#woerrorDiv").delay(4000).slideUp();
                return false;
            }
//         }
//         else{
//             document.getElementById("woerrSnap").innerHTML = "Please Select Customer And Boat";
//             $("#woerrorDiv").slideDown();
//             $("#woerrorDiv").delay(4000).slideUp();
//             return false;
//         }
    }
    
    function taxchange(divNum) {
        if(document.getElementById("taxableBoolView"+divNum).checked) {
            document.getElementById("taxBool"+divNum).value = '1';
        } else {
            document.getElementById("taxBool"+divNum).value = '0';
        }
        //taxBool 
        
        calculate_totalofallJobDiv();
    }
    
    function calculatetotalMisc(divNum) {
        var misc1 = 0.00; 
        var misc2 = 0.00;
        var misc3 = 0.00;
        
        if($("#miscCharge1"+divNum).val().replace(/\s/g,'') != "" ) {
            misc1 = parseFloat($("#miscCharge1"+divNum).val());
        }
        
        if($("#miscCharge2"+divNum).val().replace(/\s/g,'') != "" ) {
            misc2 = parseFloat($("#miscCharge2"+divNum).val());
        }
        
        if($("#miscCharge3"+divNum).val().replace(/\s/g,'') != "" ) {
            misc3 = parseFloat($("#miscCharge3"+divNum).val());
        }       
        var totalMisc = misc1 + misc2 + misc3;
        console.log(misc1 + misc2 + misc3);
        $("#miscChargeT"+divNum).val(totalMisc.toFixed(2));
        console.log('>>calculatetotalMisc'+divNum);
        calDiscountedTotalAmt(divNum);
    }
    
    function viewFullName(dn,pn) {
        $("#hiddnPrtName"+dn+""+pn).fadeIn();
    }
    
    function hideFullName(dn,pn) {
        $("#hiddnPrtName"+dn+""+pn).fadeOut();
    }
    
    //var addJobDiv = 0;
    //var jobIdForCart = '';
    //var jobIndex = '';
    function addPartForEditable(divNum, jobId) { 
        addJobDiv = divNum;
        $("#PymntModl").fadeIn(); 
        jobIdForCart = jobId;
        jobIndex = divNum; 
    }
    var lstSelectedPartNumber = [];
    var lstParts = [];
    var mapForQuantity = new Object();
    var mapForQuantityTmp = new Object();
    var mapForQuantity = new Object();
    
    $("#prtSrchBtn").click(function() {
        $("#spinner").show();
        var prtDetail = $("#prtDetailInput").val(); 
        var sLocation = '';
        if(document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation").value != null ) {
            sLocation = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation").value;
        }
        if(prtDetail != "") {
            BOATBUILDING.WorkOrderControllerClone.searchParts(prtDetail, sLocation, function(result, event) {
                if(event.status) {
                    if(result != null) {
                        lstParts = result;
                        $("#partResultDiv").fadeIn();
                        var tableHTML = "<table class='slds-table' style='border-collapse: collapse;'><thead><tr><th>&nbsp;</th><th>Part Number</th><th>Part Name</th> <th>Store Location</th> <th>Quanity</th><th>Retail Price</th><th>Total Amount</th></tr></thead><tbody>";
                        if(lstParts.length > 0) {
                            for(var i = 0; i < lstParts.length; i++) {
                                var total = parseFloat(lstParts[i].Quantity) * parseFloat(lstParts[i].MSRP);
                                if (lstParts[i].PartNumber in mapForQuantity ) {
                                    tableHTML +="<tr><td><input id='select"+i+"' checked='checked' onchange='addToCart(\""+i+"\");' type='checkbox' /></td><td id='partNumber"+i+"'>"+lstParts[i].PartNumber+"</td><td>"+lstParts[i].PartName+"</td><td>"+lstParts[i].StoreLocation+"</td><td><input type='text' id='partQuantity"+i+"' value='"+mapForQuantity[lstParts[i].PartNumber]+"' onkeyPress='return isNumber(event);' onKeyUp='quantityChange(\""+i+"\");' class='slds-input'/></td><td>$<span id='partMSRP"+i+"'>"+lstParts[i].MSRP+"</span></td><td>$<span id='partTotal"+i+"'>"+total+"</span></td></tr>"
                                } 
                                else {
                                    tableHTML +="<tr><td><input id='select"+i+"' onchange='addToCart(\""+i+"\");' type='checkbox' /></td><td id='partNumber"+i+"'>"+lstParts[i].PartNumber+"</td><td>"+lstParts[i].PartName+"</td><td>"+lstParts[i].StoreLocation+"</td> <td><input type='text' id='partQuantity"+i+"' value='"+lstParts[i].Quantity+"' onkeyPress='return isNumber(event);' onKeyUp='quantityChange(\""+i+"\");' class='slds-input'/></td><td>$<span id='partMSRP"+i+"'>"+lstParts[i].MSRP+"</span></td><td>$<span id='partTotal"+i+"'>"+total+"</span></td></tr>"
                                }
                            }
                            tableHTML += "</tbody></table>";
                        }
                        document.getElementById("rsltLstDiv").innerHTML = tableHTML;
                        $("#spinner").hide();
                    }else {
                        $("#partResultDiv").fadeIn();
                        document.getElementById("rsltLstDiv").innerHTML = "<span style='color: red;'>No Record Found.</span>";
                        $("#spinner").hide();
                    }
                }
            });
        }
        else {
            $("#partResultDiv").fadeIn();
            document.getElementById("rsltLstDiv").innerHTML = "<span style='color: red;'>Please enter Part Number/Part Name.</span>";
            $("#spinner").hide();
        }
    });
        
    $("#prtSrchBtnnewjob").click(function() {
        $("#spinnernewjob").show();
        var prtDetail = $("#prtDetailInputnewjob").val();
        var sLocation = '';
        if(document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation").value != null ) {
            sLocation = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation").value;
        } 
        if(prtDetail != "") {
            BOATBUILDING.WorkOrderControllerClone.searchParts(prtDetail, sLocation, function(result, event) {
                if(event.status) {
                    if(result != null) {
                        lstParts = result;
                        $("#partResultDivnewjob").fadeIn();
                        var tableHTML = "<table class='slds-table' style='border-collapse: collapse;'><thead><tr><th>&nbsp;</th><th>Part Number</th><th>Part Name</th>  <th>Store Location</th> <th>Quanity</th><th>Retail Price</th><th>Total Amount</th></tr></thead><tbody>";
                        if(lstParts.length > 0) {
                            for(var i = 0; i < lstParts.length; i++) {
                                var total = parseFloat(lstParts[i].Quantity) * parseFloat(lstParts[i].MSRP);
                                if (lstParts[i].PartNumber in mapForQuantity ) {
                                    tableHTML +="<tr><td><input id='selectnewjob"+i+"' checked='checked' onchange='addToCartnewjob(\""+i+"\");' type='checkbox' /></td><td id='partNumbernewjob"+i+"'>"+lstParts[i].PartNumber+"</td><td>"+lstParts[i].PartName+"</td> <td>"+lstParts[i].StoreLocation+"</td><td><input type='text' id='partQuantitynewjob"+i+"' value='"+mapForQuantity[lstParts[i].PartNumber]+"' onkeyPress='return isNumber(event);' onKeyUp='quantityChangenewjob(\""+i+"\");' class='slds-input'/></td><td>$<span id='partMSRPnewjob"+i+"'>"+lstParts[i].MSRP+"</span></td><td>$<span id='partTotalnewjob"+i+"'>"+total+"</span></td></tr>"
                                } 
                                else {
                                    tableHTML +="<tr><td><input id='selectnewjob"+i+"' onchange='addToCartnewjob(\""+i+"\");' type='checkbox' /></td><td id='partNumbernewjob"+i+"'>"+lstParts[i].PartNumber+"</td><td>"+lstParts[i].PartName+"</td> <td>"+lstParts[i].StoreLocation+"</td><td><input type='text' id='partQuantitynewjob"+i+"' value='"+lstParts[i].Quantity+"' onkeyPress='return isNumber(event);' onKeyUp='quantityChangenewjob(\""+i+"\");' class='slds-input'/></td><td>$<span id='partMSRPnewjob"+i+"'>"+lstParts[i].MSRP+"</span></td><td>$<span id='partTotalnewjob"+i+"'>"+total+"</span></td></tr>"
                                } 
                            }
                            tableHTML += "</tbody></table>";
                        }
                        document.getElementById("rsltLstDivnewjob").innerHTML = tableHTML;
                        $("#spinnernewjob").hide();
                    }else {
                        $("#partResultDivnewjob").fadeIn();
                        document.getElementById("rsltLstDivnewjob").innerHTML = "<span style='color: red;'>No Record Found.</span>";
                        $("#spinnernewjob").hide(); 
                    }
                }
            });
        }
        else {
            $("#partResultDivnewjob").fadeIn();
            document.getElementById("rsltLstDivnewjob").innerHTML = "<span style='color: red;'>Please enter Part Number/Part Name.</span>";
            $("#spinnernewjob").hide();
        }
    });
    
    function addToCart(index) {
        var partNumber = document.getElementById("partNumber"+index).innerHTML;
        var partQuantity = $("#partQuantity"+index).val();
        var partMSRP = document.getElementById("partMSRP"+index).innerHTML;
        
        if(document.getElementById("select"+index).checked == true) {
            if(partQuantity != '') {
                if(parseFloat(partQuantity) > 0) {
                    mapForQuantity[partNumber] = partQuantity;
                    lstSelectedPartNumber.push(partNumber);
                    if(lstSelectedPartNumber.length > 0) {
                        var strParts = '['
                        for(var i = 0; i < lstSelectedPartNumber.length; i++) {
                            if(i == 0) {
                                strParts += "<a style='font-style: italic;'>"+lstSelectedPartNumber[i]+"</a>";
                            }
                            else {
                                strParts += ", <a style='font-style: italic;'>"+lstSelectedPartNumber[i]+"</a>";
                            }
                        }
                        strParts += "]";
                        $("#selectedPrntDiv").fadeIn();
                        document.getElementById("selectedPrtDiv").innerHTML = strParts; 
                        
                    }
                }
                else {
                    document.getElementById("select"+index).checked = false;
                    alert("Quantity should be greater than 0.");
                }
            }else {
                document.getElementById("select"+index).checked = false;
                alert("Quantity should be greater than 0.");
            }
        }
        else {
            if(lstSelectedPartNumber.length > 0) {
                var index = lstSelectedPartNumber.indexOf(partNumber);
                if(index > -1) {
                    lstSelectedPartNumber.splice(index, 1);
                }
                if(lstSelectedPartNumber.length > 0) {
                    var strParts = '['
                    for(var i = 0; i < lstSelectedPartNumber.length; i++) {
                        if(i == 0) {
                            strParts += "<a style='font-style: italic;'>"+lstSelectedPartNumber[i]+"</a>";
                        }
                        else {
                            strParts += ", <a style='font-style: italic;'>"+lstSelectedPartNumber[i]+"</a>";
                        }
                    }
                    strParts += "]";
                    $("#selectedPrntDiv").fadeIn();
                    document.getElementById("selectedPrtDiv").innerHTML = strParts;     
                }
                else {
                    $("#selectedPrntDiv").fadeOut();
                }
            }
            
            delete mapForQuantity[partNumber];
        }
    }    
    
    function addToCartnewjob(index) {
        var partNumber = document.getElementById("partNumbernewjob"+index).innerHTML;
        var partQuantity = $("#partQuantitynewjob"+index).val();
        var partMSRP = document.getElementById("partMSRPnewjob"+index).innerHTML;
        
        if(document.getElementById("selectnewjob"+index).checked == true) {
            if(partQuantity != '') {
                if(parseFloat(partQuantity) > 0) {
                    mapForQuantity[partNumber] = partQuantity;
                    lstSelectedPartNumber.push(partNumber);
                    if(lstSelectedPartNumber.length > 0) {
                        var strParts = '['
                        for(var i = 0; i < lstSelectedPartNumber.length; i++) {
                            if(i == 0) {
                                strParts += "<a style='font-style: italic;'>"+lstSelectedPartNumber[i]+"</a>";
                            }
                            else {
                                strParts += ", <a style='font-style: italic;'>"+lstSelectedPartNumber[i]+"</a>";
                            }
                        }
                        strParts += "]";
                        $("#selectedPrntDivnewjob").fadeIn();
                        document.getElementById("selectedPrtDivnewjob").innerHTML = strParts; 
                        
                    }
                }
                else {
                    document.getElementById("selectnewjob"+index).checked = false;
                    alert("Quantity should be greater than 0.");
                }
            }else {
                document.getElementById("selectnewjob"+index).checked = false;
                alert("Quantity should be greater than 0.");
            }
        }
        else {
            if(lstSelectedPartNumber.length > 0) {
                var index = lstSelectedPartNumber.indexOf(partNumber);
                if(index > -1) {
                    lstSelectedPartNumber.splice(index, 1);
                }
                if(lstSelectedPartNumber.length > 0) {
                    var strParts = '['
                    for(var i = 0; i < lstSelectedPartNumber.length; i++) {
                        if(i == 0) {
                            strParts += "<a style='font-style: italic;'>"+lstSelectedPartNumber[i]+"</a>";
                        }
                        else {
                            strParts += ", <a style='font-style: italic;'>"+lstSelectedPartNumber[i]+"</a>";
                        }
                    }
                    strParts += "]";
                    $("#selectedPrntDivnewjob").fadeIn();
                    document.getElementById("selectedPrtDivnewjob").innerHTML = strParts;     
                }
                else {
                    $("#selectedPrntDivnewjob").fadeOut();
                }
            }
            
            delete mapForQuantity[partNumber];
        }
    }
    
    function quantityChange(index) {
        updateDiscountQuantityMaps(index);
    }
    
    function quantityChangenewjob(index) {
        updateDiscountQuantityMapsnewjob(index);
    }
    
    function updateDiscountQuantityMaps(index) {
        var partNumber = document.getElementById("partNumber"+index).innerHTML;
        var partQuantity = $("#partQuantity"+index).val();
        var partMSRP = document.getElementById("partMSRP"+index).innerHTML;
        var partQuantityTmp = 0;
        if(partQuantity != '') {
            partQuantityTmp = parseFloat(partQuantity);
        }
        var total = partQuantityTmp * partMSRP;
        
        document.getElementById("partTotal"+index).innerHTML = total;
        if (partNumber in mapForQuantity ) {
            mapForQuantity[partNumber] = partQuantity;
        }
    }
    
    function updateDiscountQuantityMapsnewjob(index) {
        var partNumber = document.getElementById("partNumbernewjob"+index).innerHTML;
        var partQuantity = $("#partQuantitynewjob"+index).val();
        var partMSRP = document.getElementById("partMSRPnewjob"+index).innerHTML;
        var partQuantityTmp = 0;
        if(partQuantity != '') {
            partQuantityTmp = parseFloat(partQuantity);
        }
        var total = partQuantityTmp * partMSRP;
        
        document.getElementById("partTotalnewjob"+index).innerHTML = total;
        if (partNumber in mapForQuantity ) { 
            mapForQuantity[partNumber] = partQuantity;
        }
    }  
    
    var lstFinalList = [];
    var objMapForResutData = new Object();
    $("#addToCrt").click(function() {
        //console.log("Add Part"); 
        $("#spinner").show();
        if(addJobDiv != 0) {
            for(key in mapForQuantity) {
                mapForQuantityTmp[key] = mapForQuantity[key];
            } 
            var lstResult = [];
            var sLocation = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation").value;
            if(lstSelectedPartNumber.length > 0 && sLocation != null) {
                
                
                BOATBUILDING.WorkOrderControllerClone.getFinalList(lstSelectedPartNumber, mapForQuantityTmp, jobIdForCart, sLocation, function(result, event) {
                    if(event.status) {
                        //hideAll(); 
                        if(result != null) { 
                            lstResult = result;
                            if(lstResult.length > 0) {
                                for(var i = 0; i < lstResult.length; i++) { 
                                    if(lstResult[i].PartNumber in mapForQuantityTmp ) {
                                        if(!(lstResult[i].PartNumber in objMapForResutData)) {
                                            lstFinalList.push(lstResult[i]);
                                            objMapForResutData[lstResult[i].PartNumber] = lstResult[i];
                                        }
                                    }
                                } 
                            }
                            if(lstFinalList.length > 0) {
                                var grandTotalBal = 0.00;
                                var tableHTML = '';
                                for(var i = 0; i < lstFinalList.length; i++) {
                                    if(lstFinalList[i].PartNumber in mapForQuantityTmp) {
                                        var total = parseFloat(mapForQuantityTmp[lstFinalList[i].PartNumber]) * parseFloat(lstFinalList[i].MSRP);
                                        grandTotalBal += total; 
                                        
                                        var WoPartFullName = '', WoPartname = '';
                                        if(lstFinalList[i].PartName != undefined){
                                            WoPartFullName = lstFinalList[i].PartName;
                                            if(WoPartFullName.length > 5) {
                                                WoPartname = WoPartFullName.substr(0, 5) + '...'; 
                                            } else {
                                                WoPartname = lstFinalList[i].PartName;
                                            }
                                        }
                                        var prtIndex = (i+addJobDiv)+"final";
                                        
                                        
                                        tableHTML += '<table width="100%" border="0" cellspacing="2" cellpadding="2"><tr><td data-label="Part" width="43" >Parts</td><td width="65">'+lstFinalList[i].PartNumber+'</td><td width="100"><span style=" display: none; position: absolute; top: -38%; left: -4%; border: 1px solid #a8b8c7; padding: 5px; border-radius: 1rem; background: #e1e6ee; z-index:999;" id="hiddnPrtName'+addJobDiv+''+prtIndex+'">'+WoPartFullName+'</span><a onmouseover="viewFullName(\''+addJobDiv+'\',\''+prtIndex+'\');" onmouseout="hideFullName(\''+addJobDiv+'\',\''+prtIndex+'\');">'+WoPartname+'</a></td><td width="106">&nbsp;</td><td data-label="Quantity" width="144"><input onkeyPress="return isNumber(event);" onKeyUp="changeQuanityFromEditableMode(this, \''+lstFinalList[i].Id+'\', \''+addJobDiv+'\');"  type="text" value="'+mapForQuantityTmp[lstFinalList[i].PartNumber]+'" class="slds-input"/></td><td class="slds-text-align--right" width="90"><i class="fa fa-usd" aria-hidden="true"></i>'+parseFloat(lstFinalList[i].MSRP).toFixed(2)+'</td><td width="60" class="slds-text-align--right"><i class="fa fa-usd" aria-hidden="true"></i>'+parseFloat(total).toFixed(2)+'</td><td style="text-align: right;"><a onclick="removePart(this, \''+lstFinalList[i].Id+'\', \''+addJobDiv+'\');">Remove</a></td></tr></table>';
                                        objDivTotalPartAmt["DivNum"+addJobDiv] = grandTotalBal;   
                                    } 
                                    console.log("objDivTotalPartAmt");
                                    console.log(objDivTotalPartAmt); 
                                }  
                                //tableHTML += "</tbody></table>";
                                $("#existingjobdiv"+addJobDiv).append(tableHTML);
                                var grandTotalBal2 = parseFloat($("#grandtotal_parts").val()) + parseFloat(grandTotalBal);
                                document.getElementById("grandtotal_parts").value = parseFloat(grandTotalBal2).toFixed();
                                var grandtotal_total = (grandTotalBal2 + parseFloat($("#grandtotal_labor").val()) + parseFloat($("#grandtotal_supplies").val())).toFixed(2);
                                document.getElementById("grandtotal_total").value = parseFloat(grandtotal_total).toFixed(2);
                                var totalDue = parseFloat(grandtotal_total) + parseFloat($("#grandtotal_tax").val());
                                document.getElementById("grandtotal_amount_due").value = parseFloat(totalDue).toFixed(2);
                                
                                document.getElementById("TotalOfJobDiv"+jobIndex).innerHTML = parseFloat(grandtotal_total).toFixed(2);
                                var disJob = 0.00;
                                if($("#discountOnJob"+jobIndex).val() != "") {
                                    disJob = parseFloat($("#discountOnJob"+jobIndex).val());
                                }
                                
                                var shipCh = 0.00;
                                if($("#shippingId"+jobIndex).val() != "") {
                                    shipCh = parseFloat($("#shippingId"+jobIndex).val());
                                }
                                
                                var totalforJob = (parseFloat(grandtotal_total) + parseFloat(shipCh)) - parseFloat(disJob);
                                
                                document.getElementById("gTotalAmt"+jobIndex).innerHTML = parseFloat(totalforJob).toFixed(2);
                                
                                var grandtotalDiscount = parseFloat($("#grandtotalDiscount").val());
                                var grandtotal_payment = parseFloat($("#grandtotal_payment").val());
                                var discountOnWO = 0.00;
                                if($("#grandtotal_payment").val() != '') {
                                    discountOnWO = parseFloat($("#grandtotal_payment").val());
                                }
                                document.getElementById("grandtotal_balance").value = parseFloat(totalDue - (grandtotal_payment + discountOnWO)).toFixed(2);
                                calculate_totalofallJobDiv1();
                            }
                            $("#spinner").hide();
                            //calculate_totalofallJobDiv(); 
                            $('#PymntModl').fadeOut();
                            $("#selectedPrntDiv").hide();
                            $("#partResultDiv").hide(); 
                            document.getElementById("prtDetailInput").value = "";
                            lstSelectedPartNumber = [];
                            mapForQuantity = new Object();
                            mapForQuantityTmp = new Object();
                            lstFinalList = [];
                            
                        }
                    }
                });
            } else {
                alert("Please select the store location.")            
            }
            
        } 
        
    });
    
    $("#addToCrtnewjob").click(function() {
        //console.log("Add Part"); 
        $("#spinnernewjob").show();
        if(addJobDiv != 0) {
            for(key in mapForQuantity) {
                mapForQuantityTmp[key] = mapForQuantity[key];
            } 
            var lstResult = [];
            var sLocation = document.getElementById("pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation").value;
            if(lstSelectedPartNumber.length > 0 && sLocation != null) {
                BOATBUILDING.WorkOrderControllerClone.getFinalList2(lstSelectedPartNumber, mapForQuantityTmp, sLocation, function(result, event) {
                    if(event.status) {
                        //hideAll();  
                        if(result != null) { 
                            lstResult = result;
                            if(lstResult.length > 0) {
                                for(var i = 0; i < lstResult.length; i++) { 
                                    if(lstResult[i].PartNumber in mapForQuantityTmp ) {
                                        if(!(lstResult[i].PartNumber in objMapForResutData)) {
                                            lstFinalList.push(lstResult[i]);
                                            objMapForResutData[lstResult[i].PartNumber] = lstResult[i];
                                        }
                                    }
                                } 
                            }
                            if(lstFinalList.length > 0) {
                                var grandTotalBal = 0.00;
                                var tableHTML = '';
                                $("#hiddentdDiv"+addJobDiv).css("display","");
                                var fd = document.getElementById("file1Div"+addJobDiv);
                                
                                for(var i = 0; i < lstFinalList.length; i++) {
                                    if(lstFinalList[i].PartNumber in mapForQuantityTmp) {
                                        var total = parseFloat(mapForQuantityTmp[lstFinalList[i].PartNumber]) * parseFloat(lstFinalList[i].MSRP);
                                        grandTotalBal += total; 
                                        
                                        var WoPartFullName = '', WoPartname = '';
                                        if(lstFinalList[i].PartName != undefined){
                                            WoPartFullName = lstFinalList[i].PartName;
                                            if(WoPartFullName.length > 5) {
                                                WoPartname = WoPartFullName.substr(0, 5) + '...'; 
                                            } else {
                                                WoPartname = lstFinalList[i].PartName;
                                            }
                                        }
                                        var prtIndex = (i+addJobDiv)+"final";
                                        
                                        var newdiv = document.createElement("div"+addJobDiv);
                                        var numi = document.getElementById('theValueDiv'+addJobDiv);
                                        var num = (document.getElementById("theValueDiv"+addJobDiv).value -1)+ 2;
                                        numi.value = num;
                                        var selectpartlist = "selectpartlistDiv"+addJobDiv+num;
                                        var PartTotal = "PartTotalDiv"+addJobDiv+num;
                                        var partId = "prtId"+addJobDiv+num;
                                        var PartsQuantity = "PartsQuantityDiv"+addJobDiv+num;
                                        var PartPrice = "PartPriceDiv"+addJobDiv+num; 
                                        
                                        var r = Math.floor(Math.random()*100000);
                                        newdiv.setAttribute("id","aaaa"+r);
                                        
                                        newdiv.innerHTML = '<table width="100%" border="0" cellspacing="2" cellpadding="2"><tr><td data-label="Part" width="43" >Parts</td><td width="65" id="'+partId+'">'+lstFinalList[i].PartNumber+'</td><td data-label="Parts No" width="65"><span style=" display: none; position: absolute; top: -38%; left: -4%; border: 1px solid #a8b8c7; padding: 5px; border-radius: 1rem; background: #e1e6ee; z-index:999;" id="hiddnPrtName'+addJobDiv+''+prtIndex+'">'+WoPartFullName+'</span><input type="hidden" value="'+WoPartFullName+'" id="'+selectpartlist+'"><a onmouseover="viewFullName(\''+addJobDiv+'\',\''+prtIndex+'\');" onmouseout="hideFullName(\''+addJobDiv+'\',\''+prtIndex+'\');" >'+WoPartname+'</a></td><td data-label="Quanity" width="144"><input id="'+PartsQuantity+'" onkeypress="return isNumber(event)" onkeyup="calculate_quantity_Div('+addJobDiv+','+num+'); calculate_totalofJobDiv('+addJobDiv+');" class="slds-input" type="text" value="'+mapForQuantityTmp[lstFinalList[i].PartNumber]+'"/><td id="'+PartPrice+'" class="slds-text-align--right" width="90">'+parseFloat(lstFinalList[i].MSRP).toFixed(2)+'</td><td width="60" class="slds-text-align--right" id="'+PartTotal+'">'+parseFloat(total).toFixed(2)+'</td><td width="24" align="right"><a href="#1" title="Remove" class="hyperlink" style="text-decoration:none;" onclick="Javascript:remove_row(\''+"aaaa"+r+'\','+num+');return false">Remove</a></td></tr></table>';
                                        fd.appendChild(newdiv); 
                                    } 
                                } 
                                
                                $('#PymntModlnewjob').fadeOut();
                                $("#selectedPrntDivnewjob").hide();
                                $("#partResultDivnewjob").hide(); 
                                document.getElementById("prtDetailInputnewjob").value = "";
                                lstSelectedPartNumber = [];
                                mapForQuantity = new Object(); 
                                mapForQuantityTmp = new Object();
                                lstFinalList = [];
                                calculate_totalofallJobDiv();
                                calculate_totalofallJobDiv1();
                            }
                            $("#spinnernewjob").hide(); 
                            $('#PymntModlnewjob').fadeOut();
                            $("#selectedPrntDivnewjob").hide();
                            $("#partResultDivnewjob").hide(); 
                            document.getElementById("prtDetailInputnewjob").value = "";
                            lstSelectedPartNumber = [];
                            mapForQuantity = new Object();
                        }
                    }
                });
            } else {
                alert("Please select the store location.");
            }
            
        } 
        
    });
    
    function changeQuanityFromEditableMode(obj, jliId, divNum) {
        $('.popup').addClass('active');
        if(obj.value != "" && obj.value > 0) { 
            BOATBUILDING.WorkOrderControllerClone.updatePartFromEditableMode(jliId, obj.value, function(result, event) {
                $('.popup').removeClass('active'); 
                var tableHTML = '<input type="hidden" name="theValue" id="theValueDiv'+divNum+'" value="'+result.length+'">';
                var grandTotalBal = 0.00;
                if(result.length > 0) {
                    for(var i = 0; i < result.length; i++) {
                        
                        var WoPartFullName = '', WoPartname = '';
                        if(result[i].PartName != undefined){
                            WoPartFullName = result[i].PartName;
                            if(WoPartFullName.length > 5) {
                                WoPartname = WoPartFullName.substr(0, 5) + '...'; 
                            } else {
                                WoPartname = result[i].PartName;
                            }
                            
                        }
                        var prtIndex = i+1;
                        var total = parseFloat(result[i].Quantity) * parseFloat(result[i].MSRP);
                        grandTotalBal += total; 
                        objDivTotalPartAmt["DivNum"+divNum] = grandTotalBal;
                        tableHTML += '<table width="100%" border="0" cellspacing="2" cellpadding="2"><tr><td data-label="Part" width="43" >Parts</td><td width="65">'+result[i].PartNumber+'</td><td width="100"><span style=" display: none; position: absolute; top: -38%; left: -4%; border: 1px solid #a8b8c7; padding: 5px; border-radius: 1rem; background: #e1e6ee; z-index:999;" id="hiddnPrtName'+divNum+''+prtIndex+'">'+WoPartFullName+'</span><a onmouseover="viewFullName(\''+divNum+'\',\''+prtIndex+'\');" onmouseout="hideFullName(\''+divNum+'\',\''+prtIndex+'\');">'+WoPartname+'</a></td><td width="106">&nbsp;</td><td data-label="Quantity" width="144"><input onkeyPress="return isNumber(event);" onKeyUp="changeQuanityFromEditableMode(this, \''+result[i].Id+'\', \''+divNum+'\');"  type="text" value="'+result[i].Quantity+'" class="slds-input"/></td><td class="slds-text-align--right" width="90"><i class="fa fa-usd" aria-hidden="true"></i>'+parseFloat(result[i].MSRP).toFixed(2)+'</td><td width="60" class="slds-text-align--right"><i class="fa fa-usd" aria-hidden="true"></i>'+parseFloat(total).toFixed(2)+'</td><td style="text-align: right;"><a onclick="removePart(this, \''+result[i].Id+'\', \''+divNum+'\');">Remove</a></td></tr></table>'; 
                        
                    }
                    console.log("objDivTotalPartAmt");
                    console.log(objDivTotalPartAmt);
                    document.getElementById("existingjobdiv"+divNum).innerHTML = tableHTML;
                } else {
                    document.getElementById("existingjobdiv"+divNum).innerHTML = tableHTML;
                } 
                var grandTotalBal2 = parseFloat(grandTotalBal); 
                document.getElementById("grandtotal_parts").value = parseFloat(grandTotalBal2).toFixed();
                var grandtotal_total = (grandTotalBal2 + parseFloat($("#LabourTotalPriceDiv"+divNum).html()) + parseFloat($("#ShopSupliesTotalPriceDiv"+divNum).html())).toFixed(2);
                document.getElementById("TotalOfJobDiv"+divNum).innerHTML = parseFloat(grandtotal_total).toFixed(2);
                document.getElementById("grandtotal_total").value = parseFloat(grandtotal_total).toFixed(2);
                var totalDue = parseFloat(grandtotal_total) + parseFloat($("#grandtotal_tax").val());
                document.getElementById("grandtotal_amount_due").value = parseFloat(totalDue).toFixed(2);
                
                
                var disJob = 0.00;
                if($("#discountOnJob"+divNum).val() != "") {
                    disJob = parseFloat($("#discountOnJob"+divNum).val());
                }
                
                var shipCh = 0.00;
                if($("#shippingId"+divNum).val() != "") {
                    shipCh = parseFloat($("#shippingId"+divNum).val());
                }
                
                var totalforJob = (parseFloat(grandtotal_total) + parseFloat(shipCh)) - parseFloat(disJob);
                
                document.getElementById("gTotalAmt"+divNum).innerHTML = parseFloat(totalforJob).toFixed(2);
                
                var grandtotalDiscount = parseFloat($("#grandtotalDiscount").val());
                var grandtotal_payment = parseFloat($("#grandtotal_payment").val());
                var discountOnWO = 0.00;
                if($("#grandtotal_payment").val() != '') {
                    discountOnWO = parseFloat($("#grandtotal_payment").val());
                }
                document.getElementById("grandtotal_balance").value = parseFloat(totalDue - (grandtotal_payment + discountOnWO)).toFixed(2);
                var totalShippingChrge = document.getElementById("shippingGrndTtl").value;
                var total_salesamount = document.getElementById("grandtotal_tax").value;
                document.getElementById("grandTotalId").value = parseFloat(grandtotal_total + totalShippingChrge + total_salesamount).toFixed(2); 
                calculate_totalofallJobDiv1();
            });
        } else if(obj.value == "") {
            $('.popup').removeClass('active');
        } else {
            $('.popup').removeClass('active');
            alert("Please enter valid quantity");
        }
    }
    
    function removePart(obj, jliId, divNum) {
        $('.popup').addClass('active');
        var strLoc = document.getElementById('pge:frm:wrkOrdrCompCall:wrkOrdr:WostoreLocation').value;
        
        BOATBUILDING.WorkOrderControllerClone.removeExistingElement(jliId, strLoc, function(result, event) {
            $('.popup').removeClass('active'); 
            var tableHTML = ''; 
            var grandTotalBal = 0.00;
            if(result.length > 0) { 
                tableHTML = '<input type="hidden" name="theValue" id="theValueDiv'+divNum+'" value="'+result.length+'">';
                for(var i = 0; i < result.length; i++) {
                    var total = parseFloat(result[i].Quantity) * parseFloat(result[i].MSRP);
                    grandTotalBal += total; 
                    
                    var WoPartFullName = '', WoPartname = '';
                    if(result[i].PartName != undefined){
                        WoPartFullName = result[i].PartName;
                        if(WoPartFullName.length > 5) {
                            WoPartname = WoPartFullName.substr(0, 5) + '...';  
                        } else {
                            WoPartname = result[i].PartName;
                        }  
                    }
                    var prtIndex = i+1;
                    objDivTotalPartAmt["DivNum"+divNum] = grandTotalBal;
                    
                    tableHTML += '<table width="100%" border="0" cellspacing="2" cellpadding="2"><tr><td data-label="Part" width="43" >Parts</td><td width="65">'+result[i].PartNumber+'</td><td width="100"><span style=" display: none; position: absolute; top: -38%; left: -4%; border: 1px solid #a8b8c7; padding: 5px; border-radius: 1rem; background: #e1e6ee; z-index:999;" id="hiddnPrtName'+divNum+''+prtIndex+'">'+WoPartFullName+'</span><a onmouseover="viewFullName(\''+divNum+'\',\''+prtIndex+'\');" onmouseout="hideFullName(\''+divNum+'\',\''+prtIndex+'\');">'+WoPartname+'</a></td><td width="106">&nbsp;</td><td data-label="Quantity" width="144"><input onkeyPress="return isNumber(event);" onKeyUp="changeQuanityFromEditableMode(this, \''+result[i].Id+'\', \''+divNum+'\');"  type="text" value="'+result[i].Quantity+'" class="slds-input"/></td><td class="slds-text-align--right" width="90"><i class="fa fa-usd" aria-hidden="true"></i>'+parseFloat(result[i].MSRP).toFixed(2)+'</td><td width="60" class="slds-text-align--right"><i class="fa fa-usd" aria-hidden="true"></i>'+parseFloat(total).toFixed(2)+'</td><td style="text-align: right;"><a onclick="removePart(this, \''+result[i].Id+'\', \''+divNum+'\');">Remove</a></td></tr></table>'; 
                    
                }  
                console.log("objDivTotalPartAmt");
                console.log(objDivTotalPartAmt); 
                document.getElementById("existingjobdiv"+divNum).innerHTML = tableHTML;
                
            } else {
                tableHTML = '<input type="hidden" name="theValue" id="theValueDiv'+divNum+'" value="'+0+'">'; 
                document.getElementById("existingjobdiv"+divNum).innerHTML = tableHTML; 
                delete objDivTotalPartAmt["DivNum"+divNum];
            } 
            //objDivTotalPartAmt["DivNum"+divNum] = grandTotalBal; 
            //calculate_totalofallJobDiv(); 
            
            var grandTotalBal2 = parseFloat(grandTotalBal);
            document.getElementById("grandtotal_parts").value = parseFloat(grandTotalBal2).toFixed();
            var grandtotal_total = (grandTotalBal2 + parseFloat($("#grandtotal_labor").val()) + parseFloat($("#grandtotal_supplies").val())).toFixed(2);
            document.getElementById("grandtotal_total").value = parseFloat(grandtotal_total).toFixed(2);
            var totalDue = parseFloat(grandtotal_total) + parseFloat($("#grandtotal_tax").val());
            document.getElementById("grandtotal_amount_due").value = parseFloat(totalDue).toFixed(2);
            
            document.getElementById("TotalOfJobDiv"+divNum).innerHTML = parseFloat(grandtotal_total).toFixed(2);
            var disJob = 0.00;
            if($("#discountOnJob"+divNum).val() != "") {
                disJob = parseFloat($("#discountOnJob"+divNum).val());
            }
            
            var shipCh = 0.00; 
            if($("#shippingId"+divNum).val() != "") {
                shipCh = parseFloat($("#shippingId"+divNum).val());
            }
            
            var totalforJob = (parseFloat(grandtotal_total) + parseFloat(shipCh)) - parseFloat(disJob);
            
            document.getElementById("gTotalAmt"+divNum).innerHTML = parseFloat(totalforJob).toFixed(2);
            
            var grandtotalDiscount = parseFloat($("#grandtotalDiscount").val());
            var grandtotal_payment = parseFloat($("#grandtotal_payment").val());
            var discountOnWO = 0.00;
            if($("#grandtotal_payment").val() != '') {
                discountOnWO = parseFloat($("#grandtotal_payment").val());
            } 
            document.getElementById("grandtotal_balance").value = parseFloat(totalDue - (grandtotal_payment + discountOnWO)).toFixed(2);
            var totalShippingChrge = document.getElementById("shippingGrndTtl").value;
            var total_salesamount = document.getElementById("grandtotal_tax").value;
            document.getElementById("grandTotalId").value = parseFloat(grandtotal_total + totalShippingChrge + total_salesamount).toFixed(2);
            calculate_totalofallJobDiv1();
        });
    }
    
    function redirectToScedule(woId, woName) {
        openCity(event, 'schedule'); 
        addWOToEvent(woId, woName);
    }  
    
    function addCommentToJob(wwoDivNum, ty) {
        //console.log(wwoDivNum)
        //hiddenInpPopup, taCommnt, popupTextArea
        
        document.getElementById("tyForCmnt").value = ty;
        document.getElementById("hiddenInpPopup").value = wwoDivNum;
        var comments = document.getElementById("cmnt"+wwoDivNum).value;
        document.getElementById("taCommnt").value = comments;
        document.getElementById("popupTextArea").style.display = "block";
    }
    
    function addCustCommentToJob(wwoDivNum, ty) {
        //console.log(wwoDivNum)
        //hiddenInpPopup, taCommnt, popupTextArea
        document.getElementById("tyForCmnt").value = ty;
        document.getElementById("hiddenInpPopup").value = wwoDivNum;
        var comments = document.getElementById("Custcmnt"+wwoDivNum).value;
        document.getElementById("taCommnt").value = comments;
        document.getElementById("popupTextArea").style.display = "block";
    }
    
    function viewCustCommentFromJob(wwoDivNum, ty) {
        //console.log(wwoDivNum)
        //hiddenInpPopup, taCommnt, popupTextArea
        document.getElementById("tyForCmnt").value = ty;
        document.getElementById("hiddenInpPopup").value = wwoDivNum;
        var comments = document.getElementById("Custcmnt"+wwoDivNum).value;
        document.getElementById("taCommnt").value = comments;
        document.getElementById("popupTextArea").style.display = "block";
        document.getElementById("addCmntBttn").style.display = "none";
        
    }
    
    function viewCommentFromJob(wwoDivNum, ty) {
        //console.log(wwoDivNum)
        //hiddenInpPopup, taCommnt, popupTextArea
        document.getElementById("tyForCmnt").value = ty;
        document.getElementById("hiddenInpPopup").value = wwoDivNum;
        var comments = document.getElementById("cmnt"+wwoDivNum).value;
        document.getElementById("taCommnt").value = comments;
        document.getElementById("popupTextArea").style.display = "block";
        document.getElementById("addCmntBttn").style.display = "none";
        
    }
    
    $("#addCmntBttn").click(function() {
        ty = document.getElementById("tyForCmnt").value ;
        if(ty == 'CUST') {
            var cmntToAdd = $("#taCommnt").val();
            if(document.getElementById("taCommnt").value.includes('\n')) {
                cmntToAdd = $("#taCommnt").val().replace(/\n/g, " ~~ ");
            } 
            
            //var cmntToAdd = document.getElementById("taCommnt").value;
            var jobDivNum = document.getElementById("hiddenInpPopup").value;
            document.getElementById("Custcmnt"+jobDivNum).value = cmntToAdd;
            document.getElementById("popupTextArea").style.display = "none";
        } else if(ty == 'SER') {
            var cmntToAdd = $("#taCommnt").val();
            if(document.getElementById("taCommnt").value.includes('\n')) {
                cmntToAdd = $("#taCommnt").val().replace(/\n/g, " ~~ ");
            } 
            //var cmntToAdd = document.getElementById("taCommnt").value;
            var jobDivNum = document.getElementById("hiddenInpPopup").value;
            document.getElementById("cmnt"+jobDivNum).value = cmntToAdd;
            document.getElementById("popupTextArea").style.display = "none";
        }
        
    });
    
    </script> 
    
</apex:component>